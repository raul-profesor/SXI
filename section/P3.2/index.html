
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Pràctica 3.2 - Configuració de servidor DNS mestre i esclau - Servicis en xarxa i Internet</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-32-configuracio-de-servidor-dns-mestre-i-esclau" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Servicis en xarxa i Internet" class="md-header__button md-logo" aria-label="Servicis en xarxa i Internet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Servicis en xarxa i Internet
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pràctica 3.2 - Configuració de servidor DNS mestre i esclau
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent=""  aria-label="Cambiar a modo normal"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Cambiar a modo normal" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Pràctiques SXI
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Servicis en xarxa i Internet" class="md-nav__button md-logo" aria-label="Servicis en xarxa i Internet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Servicis en xarxa i Internet
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      <label class="md-nav__link" for="__nav_1">
        Pràctiques SXI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pràctiques SXI" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Pràctiques SXI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../P1/" class="md-nav__link">
        Pràctica 1 - Muntant l'arquitectura de xarxa
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../P2.1/" class="md-nav__link">
        Pràctica 2.1 - Instal·lació i configuració de servidor DHCP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../P2.2/" class="md-nav__link">
        Pràctica 2.2 - DHCP Relay
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../P3.1/" class="md-nav__link">
        Pràctica 3.1 - Configuració d'un servidor DNS
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Pràctica 3.2 - Configuració de servidor DNS mestre i esclau
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Pràctica 3.2 - Configuració de servidor DNS mestre i esclau
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#millora-de-la-configuracio-del-servidor" class="md-nav__link">
    Millora de la configuració del servidor
  </a>
  
    <nav class="md-nav" aria-label="Millora de la configuració del servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pas-1-afegir-subdomini-automaticament" class="md-nav__link">
    Pas 1 – Afegir subdomini automàticament
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-2-afegir-el-nostre-servidor-dns-com-a-unic-en-el-client" class="md-nav__link">
    Pas 2 – Afegir el nostre servidor DNS com a únic en el client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-3-afegir-forwarders" class="md-nav__link">
    Pas 3 – Afegir forwarders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-4-afegir-arxius-de-log" class="md-nav__link">
    Pas 4 - Afegir arxius de log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasques-a-realitzar" class="md-nav__link">
    Tasques a realitzar
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#millora-de-la-configuracio-del-servidor" class="md-nav__link">
    Millora de la configuració del servidor
  </a>
  
    <nav class="md-nav" aria-label="Millora de la configuració del servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pas-1-afegir-subdomini-automaticament" class="md-nav__link">
    Pas 1 – Afegir subdomini automàticament
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-2-afegir-el-nostre-servidor-dns-com-a-unic-en-el-client" class="md-nav__link">
    Pas 2 – Afegir el nostre servidor DNS com a únic en el client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-3-afegir-forwarders" class="md-nav__link">
    Pas 3 – Afegir forwarders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pas-4-afegir-arxius-de-log" class="md-nav__link">
    Pas 4 - Afegir arxius de log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasques-a-realitzar" class="md-nav__link">
    Tasques a realitzar
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="practica-32-configuracio-de-servidor-dns-mestre-i-esclau">Pràctica 3.2 - Configuració de servidor DNS mestre i esclau</h1>
<div class="admonition danger">
<p class="admonition-title">Atenció, molt important abans de començar!</p>
<p>✔ Heu de tenir un clon de l'Ubuntu Server, perquè faci de servidor DNS esclau</p>
<p>✔ Aquest servidor esclau tindrà una interfície a la nostra xarxa interna que rebrà la IP per DHCP així que:</p>
<ul>
<li>Aquesta interfície, estarà configurada per a la mateixa xarxa interna que el server original i haurà de tindre configurat en netplan que reba la IP per DHCP</li>
</ul>
<p>✔ Heu de tenir configurat el servidor DHCP perquè assigni una dirección IP fixa a l'Ubuntu Server.</p>
<div class="admonition info">
<p class="admonition-title">Avís</p>
<p>✔ Si ja havíeu clonat el servidor per fer les pràctiques de tema anterior,
podeu reutilitzar-la però recordeu:</p>
<ul>
<li>
<p>Aturar els serveis que tinguéssiu instal·lats (isc-dhcp-server, isc-dhcp-relay)</p>
</li>
<li>
<p>Cal desactivar-una de les interfícies en Virtualbox</p>
</li>
<li>
<p>La interfície de la xarxa interna estarà configurada per a la mateixa xarxa interna que el server original i haurà de tenir configurat en netplan que rebi la IP per DHCP</p>
</li>
<li>
<p>Instal·lar Bind i els paquets addicionals, tal com vam fer en la pràctica anterior al servidor original </p>
</li>
</ul>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Nota important</p>
<p>Si no ixen els resultats que deuen, pot passar que s'hagi quedat informació guardada en la caché del client o del server. Per esborrar-les en el client:</p>
<div class="highlight"><pre><span></span><code>sudo systemd-resolve --flush-caches
</code></pre></div>
<p>I en el servidor:</p>
<div class="highlight"><pre><span></span><code>sudo rndc flush
sudo rndc reload
</code></pre></div>
</div>
<h2 id="millora-de-la-configuracio-del-servidor">Millora de la configuració del servidor</h2>
<h3 id="pas-1-afegir-subdomini-automaticament">Pas 1 – Afegir subdomini automàticament</h3>
<p>Si proveu, amb la configuració de la pràctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui bé les direccions.</p>
<p>Així no funciona:</p>
<p><img alt="" src="../../img/3.2_1.png" /></p>
<p>Així hauria de funcionar:</p>
<p><img alt="" src="../../img/3.2_2.png" /></p>
<p>Podem solucionar això. Hem d'enviar la nostra direcció de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP.
Per això heu d'utilitzar, dins de la declaració de la vostra subnet a l'arxiu de configuració de l'DHCP, la directiva "option domain sre.es".</p>
<h3 id="pas-2-afegir-el-nostre-servidor-dns-com-a-unic-en-el-client">Pas 2 – Afegir el nostre servidor DNS com a únic en el client</h3>
<p>Si us heu fixat en la sortida de dig o de nslookup des del client, quan us diu que servidor DNS ha utilitzat per a la consulta, us posa que ha estat el 127.0.0.53</p>
<p><img alt="" src="../../img/3.2_3.png" /></p>
<p>Aquesta adreça és l'adreça local de la vostra màquina client. Això és així perquè systemd, el “nou” sistema de gestió de serveis de Linux, té una espècie de servidor DNS local que és el primer que es consulta i si no té la resposta, la reenvía al servidor DNS que hàgim configurat.</p>
<p>Això és una fallada coneguda de systemd i hi ha una espècie de “arranjament” per solucionar-ho i és crear un link simbòlic:</p>
<p><div class="highlight"><pre><span></span><code>$ sudo rm -f /etc/resolv.conf
$ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
</code></pre></div>
I heu de reaplicar la configuració de xarxa:</p>
<div class="highlight"><pre><span></span><code>sudo netplan apply
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Feu una nova consulta en dig i comproveu que ara sí ha utilitzat el servidor que deu, és a dir, l'Ubuntu Server que heu configurat vosaltres. Adjunteu captures de pantalla de la configuració i el resultat.</p>
</div>
<h3 id="pas-3-afegir-forwarders">Pas 3 – Afegir forwarders</h3>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Comproveu que si feu una consulta a una adreça de domini d'Internet (cisco.com, github.com…), el domini sí es resol perfectament. Com és això possible si només hem configurat les zones autoritativas del DNS i cap més?A quins servidors DNS creïs que consulta el nostre Bind?</p>
</div>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Descomenta en l'arxiu la secció de forwarders i afegeix les següents adreces.
<div class="highlight"><pre><span></span><code>  <span class="l l-Scalar l-Scalar-Plain">forwarders {</span>
            <span class="l l-Scalar l-Scalar-Plain">208.67.222.222; //Servidor DNS d&#39;Opendns</span>
            <span class="l l-Scalar l-Scalar-Plain">1.1.1.1; //Servidor DNS de  Cloudflare</span>  
     <span class="l l-Scalar l-Scalar-Plain">};</span>
</code></pre></div></p>
</div>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Fes un dig a una adreça d'Internet una vegada més. Què creus que hem fet afegint aquestes adreces?</p>
</div>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Si en l'arxiu “named.conf.options” canvieu la línia “recursion yes;” per “recursion no;”
* Segueix funcionant la resolució de subdominis externs d'Internet (comprova-ho amb dig o nslookup? 
* I els propis (comprova-ho amb dig i amb el nom de domini complet de les màquines .sre.es)?
* Per què passa això si tenim els forwarders configurats?</p>
</div>
<div class="admonition info">
<p class="admonition-title">Nota</p>
<p>Pot passar que no us funcionen de primeres. En aquest cas, i en el mateix arxiu, proveu a canviar la línia:</p>
<p><div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">dnssec-validation auto;</span>
</code></pre></div>
Per:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">dnssec-enable yes;</span>
<span class="l l-Scalar l-Scalar-Plain">dnssec-validation yes;</span>
</code></pre></div>
</div>
<h3 id="pas-4-afegir-arxius-de-log">Pas 4 - Afegir arxius de log</h3>
<p>Històricament tots els serveis de Linux han tingut el que es coneixen com a arxius de logs. Aquests arxius contenen text i registren tota l'activitat del servei, és a dir, tot el que ocorre amb ell. </p>
<p>Avui dia això ho controla systemd i podem veure l'estat i l'activitat del servei amb el comando “suo journalctl -o nom_de el_servei”.
No obstant això, anem a afegir els nostres propis arxius de logs per fer-ho més accessible i manejable.</p>
<p>Per a això, en l'arxiu “named.conf” li indiquem que ha de tenir en compte un nou arxiu de configuració que crearem després per especificar com guardar els logs:</p>
<p><div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">include &quot;/etc/bind/named.conf.logging&quot;;</span>
</code></pre></div>
Hem de crear, ara sí, l'arxiu “named.conf.logging” amb el següent contingut:</p>
<p><div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">logging {</span>
    <span class="l l-Scalar l-Scalar-Plain">channel errors_syslog {</span>
          <span class="l l-Scalar l-Scalar-Plain">syslog daemon;</span>
          <span class="l l-Scalar l-Scalar-Plain">severity warning;</span>
        <span class="l l-Scalar l-Scalar-Plain">};</span>
<span class="l l-Scalar l-Scalar-Plain">// Per loggear totes les consultes DNS al servidor</span>
     <span class="l l-Scalar l-Scalar-Plain">channel queries_log {</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">file &quot;/var/log/named/queries.log&quot; versions 600 size 20m;</span>
</span>          <span class="l l-Scalar l-Scalar-Plain">print-estafi yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">print-category yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">print-severity yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">severity dynamic;</span>
        <span class="l l-Scalar l-Scalar-Plain">};</span>
<span class="l l-Scalar l-Scalar-Plain">//Per loggear tots els errors en realitzar consultes al servidor</span>
     <span class="l l-Scalar l-Scalar-Plain">channel query-errors_log {</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">file &quot;/var/log/named/query-errors.log&quot; versions 5 size 20m;</span>
</span>          <span class="l l-Scalar l-Scalar-Plain">print-estafi yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">print-category yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">print-severity yes;</span>
          <span class="l l-Scalar l-Scalar-Plain">severity dynamic;</span>
        <span class="l l-Scalar l-Scalar-Plain">};</span>
<span class="l l-Scalar l-Scalar-Plain">//Definim les categories associades als channels</span>
        <span class="l l-Scalar l-Scalar-Plain">category llepa-servers { null; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category edns-disabled { null; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category resoldre { null; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category dnssec { errors_syslog; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category default { errors_syslog; default_debug; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category unmatched { null; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category queries { queries_log; };</span>
        <span class="l l-Scalar l-Scalar-Plain">category query-errors { query-errors_log; };</span>
<span class="l l-Scalar l-Scalar-Plain">};</span>
</code></pre></div>
Fixeu-vos en les parts destacades en groc. Li estem indicant que aquests van a ser els arxius de log on es bolcarà tota la informació corresponent. </p>
<p>No obstant això, comproveu que aquest directori i aquests fitxers no existeixen.</p>
<ul>
<li>Creeu aquest directori amb aquests fitxers</li>
<li>Després de fer-ho, heu de canviar la propietat de l'arxiu a l'usuari “bind”, que és el corresponent al servidor DNS:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo chown bind.bind nom_de_fitxer
</code></pre></div>
<p>Finalment, a la configuració de Bind cal dir-li que sigui capaç de registrar la informació relativa a les queries o consultes DNS. Per a això modifiquem l'arxiu d'opcions “named.conf.options” i afegim, dins de “options {...}” la línia:</p>
<p><div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">querylog yes;</span>
</code></pre></div>
I reiniciem el servei de bind (named).</p>
<div class="admonition question">
<p class="admonition-title">Tasca</p>
<p>Comprova que realitzant ara consultes des del client, queden registrades en aquest arxiu i fes una captura de pantalla.</p>
</div>
<h2 id="tasques-a-realitzar">Tasques a realitzar</h2>
<p>Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que també es resol bé el seu nom i és possible fer-li ping per nom.</p>
<div class="admonition caution">
<p class="admonition-title">Atenció per a l'informe</p>
<p>Documenta tota la pràctica amb les captures de pantalla corresponents de cada configuració i comprovació.</p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../P3.1/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Pràctica 3.1 - Configuració d&#39;un servidor DNS" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Pràctica 3.1 - Configuració d'un servidor DNS
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.expand", "navigation.top", "navigation.indexes"], "translations": {"clipboard.copy": "C\u00f2pia al porta-retalls", "clipboard.copied": "Copiat al porta-retalls", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Cerca", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>