{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"En aquesta web podreu consultar totes les pr\u00e0ctiques d'aquest m\u00f2dul.","title":"Home"},{"location":"section/P1/","text":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa Configuraci\u00f3 de les m\u00e0quines Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un. Ubuntu Server Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna: Xubuntu (client) Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama. Configuraci\u00f3 d'interfaces amb netplan Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quines s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa. Configuraci\u00f3 del enrutament o encaminament Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p Rutes est\u00e0tiques El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d . Toc final ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 de xarxa correcta amb netplan d'ambdues m\u00e0quines 4 punts Configuraci\u00f3 correcta de l'encaminament entre els dos alumnes en les dos direccions 5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt Configuraci\u00f3 extra d'un segon client +0,5 punts (extra)","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#practica-1-muntant-larquitectura-de-xarxa","text":"","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#configuracio-de-les-maquines","text":"Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un.","title":"Configuraci\u00f3 de les m\u00e0quines"},{"location":"section/P1/#ubuntu-server","text":"Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna:","title":"Ubuntu Server"},{"location":"section/P1/#xubuntu-client","text":"Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama.","title":"Xubuntu (client)"},{"location":"section/P1/#configuracio-dinterfaces-amb-netplan","text":"Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quines s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa.","title":"Configuraci\u00f3 d'interfaces amb netplan"},{"location":"section/P1/#configuracio-del-enrutament-o-encaminament","text":"Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p","title":"Configuraci\u00f3 del enrutament o encaminament"},{"location":"section/P1/#rutes-estatiques","text":"El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d .","title":"Rutes est\u00e0tiques"},{"location":"section/P1/#toc-final","text":"ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Toc final"},{"location":"section/P1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 de xarxa correcta amb netplan d'ambdues m\u00e0quines 4 punts Configuraci\u00f3 correcta de l'encaminament entre els dos alumnes en les dos direccions 5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt Configuraci\u00f3 extra d'un segon client +0,5 punts (extra)","title":"Avaluaci\u00f3"},{"location":"section/P2.1/","text":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP Instal\u00b7laci\u00f3 del servidor DHCP Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server Configuraci\u00f3 del client Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la. Configuraci\u00f3 del servidor DHCP Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.3 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servici DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1. Afegir un client DHCP amb IP reservada Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servici amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/hardware address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a Ultima comprovaci\u00f3 Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 del servidor DHCP 4 punts Afegir un client amb IP reservada 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#practica-21-installacio-i-configuracio-de-servidor-dhcp","text":"","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#installacio-del-servidor-dhcp","text":"Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server","title":"Instal\u00b7laci\u00f3 del servidor DHCP"},{"location":"section/P2.1/#configuracio-del-client","text":"Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.1/#configuracio-del-servidor-dhcp","text":"Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.3 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servici DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1.","title":"Configuraci\u00f3 del servidor DHCP"},{"location":"section/P2.1/#afegir-un-client-dhcp-amb-ip-reservada","text":"Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servici amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/hardware address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a","title":"Afegir un client DHCP amb IP reservada"},{"location":"section/P2.1/#ultima-comprovacio","text":"Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Ultima comprovaci\u00f3"},{"location":"section/P2.1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 del servidor DHCP 4 punts Afegir un client amb IP reservada 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P2.2/","text":"Pr\u00e0ctica 2.2 - DHCP Relay Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta. Introducci\u00f3 En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball. Configuraci\u00f3 del client Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir. Configuraci\u00f3 del servidor Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa. En aquest router/servidor, a l'arxiu /etc/default/isc-dhcp-server teniueu posat l'interfaz de la xarxa interna. Com hara rebreu les peticions DHCP del relay per l'interfaz LAN haureu d'afegir a l'apartat \"INTERFACESv4\" el nom d'eixa interfaz. Parada del servidor DHCP En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server Instal\u00b7laci\u00f3 del DHCP relay Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta an\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni. Configuraci\u00f3 DHCP Server Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server Comprovaci\u00f3 Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa). Nova comprobaci\u00f3 Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Questions finals Questi\u00f3 1 Si l' alumne 1 est\u00e0 fent de servidor DHCP i l' alumne 2 est\u00e0 fent de relay , imaginem que l'alumne 2 afegix al ser Ubuntu server (que, recordem, fa de relay) una interf\u00edcie que es crida enp0s15 . En aquesta interf\u00edcie, l'alumne 2 decidix crear la nova xarxa 10.10.10.0/24 amb un sol client Xubuntu, on la interf\u00edcie del router t\u00e9 la IP 10.10.10.1 i el client Xubuntu la IP 10.10.10.2 Explica detalladament tot el que haur\u00edem de configurar per tal de que el server DHCP de l'alumne 1 puga donar IP tamb\u00e9 en el rang d'eixa nova xarxa del company i, concretament, en el rang 10.10.10.50 - 10.10.10.150 Questi\u00f3 2 Imagineu que el comando dhcpd -t vos diu que teniu un error en l'arxiu dhcpd.conf , el detecteu i editeu l'arxiu solucionant l'error. No obstant aix\u00f2, el server dhcp continua donant error. \u00bfQu\u00e9 m\u00e9s fa falta, a m\u00e9s d'editar l'error de dhcpd.conf ? Questi\u00f3 3 En aquesta captura: A qui pertany la direcci\u00f3 MAC i qui pertany la IP 192.168.18.76 ? Questi\u00f3 4 Com puc saber o a on puc vore quines IP ha assignat ja el servidor DHCP? Questi\u00f3 5 Podr\u00eda assignar una IP fixa a la xarxa del meu company? Explica detalladament quina configuraci\u00f3 far\u00eda falta. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DHCP 2 punts Configuraci\u00f3 correcta del relay 2 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#practica-22-dhcp-relay","text":"Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta.","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#introduccio","text":"En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball.","title":"Introducci\u00f3"},{"location":"section/P2.2/#configuracio-del-client","text":"Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.2/#configuracio-del-servidor","text":"Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa. En aquest router/servidor, a l'arxiu /etc/default/isc-dhcp-server teniueu posat l'interfaz de la xarxa interna. Com hara rebreu les peticions DHCP del relay per l'interfaz LAN haureu d'afegir a l'apartat \"INTERFACESv4\" el nom d'eixa interfaz.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P2.2/#parada-del-servidor-dhcp","text":"En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server","title":"Parada del servidor DHCP"},{"location":"section/P2.2/#installacio-del-dhcp-relay","text":"Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta an\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni.","title":"Instal\u00b7laci\u00f3 del DHCP relay"},{"location":"section/P2.2/#configuracio-dhcp-server","text":"Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server","title":"Configuraci\u00f3 DHCP Server"},{"location":"section/P2.2/#comprovacio","text":"Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa).","title":"Comprovaci\u00f3"},{"location":"section/P2.2/#nova-comprobacio","text":"Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Nova comprobaci\u00f3"},{"location":"section/P2.2/#questions-finals","text":"Questi\u00f3 1 Si l' alumne 1 est\u00e0 fent de servidor DHCP i l' alumne 2 est\u00e0 fent de relay , imaginem que l'alumne 2 afegix al ser Ubuntu server (que, recordem, fa de relay) una interf\u00edcie que es crida enp0s15 . En aquesta interf\u00edcie, l'alumne 2 decidix crear la nova xarxa 10.10.10.0/24 amb un sol client Xubuntu, on la interf\u00edcie del router t\u00e9 la IP 10.10.10.1 i el client Xubuntu la IP 10.10.10.2 Explica detalladament tot el que haur\u00edem de configurar per tal de que el server DHCP de l'alumne 1 puga donar IP tamb\u00e9 en el rang d'eixa nova xarxa del company i, concretament, en el rang 10.10.10.50 - 10.10.10.150 Questi\u00f3 2 Imagineu que el comando dhcpd -t vos diu que teniu un error en l'arxiu dhcpd.conf , el detecteu i editeu l'arxiu solucionant l'error. No obstant aix\u00f2, el server dhcp continua donant error. \u00bfQu\u00e9 m\u00e9s fa falta, a m\u00e9s d'editar l'error de dhcpd.conf ? Questi\u00f3 3 En aquesta captura: A qui pertany la direcci\u00f3 MAC i qui pertany la IP 192.168.18.76 ? Questi\u00f3 4 Com puc saber o a on puc vore quines IP ha assignat ja el servidor DHCP? Questi\u00f3 5 Podr\u00eda assignar una IP fixa a la xarxa del meu company? Explica detalladament quina configuraci\u00f3 far\u00eda falta.","title":"Questions finals"},{"location":"section/P2.2/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DHCP 2 punts Configuraci\u00f3 correcta del relay 2 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.1/","text":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tindre el servidor, el client i a m\u00e9s un clon de el client. Tots dins de la mateixa xarxa interna. \u2714 Heu de tindre configurat el servidor DHCP per que assigne adreces IP fixes als dos clients. \u2714 IMPORTANT: A l'clonar la m\u00e0quina client, per poder assignar IPs fixes en el DHCP, necessiten tenir adreces MAC diferents: Instal\u00b7laci\u00f3 de servidor DNS Bind \u00e9s l'est\u00e0ndard de facto per a servidors DNS. \u00c9s una eina de programari lliure i es distribueix amb la majoria de plataformes Unix i Linux, on tamb\u00e9 se li coneix amb el sobrenom de named (name daemon). Bind9 \u00e9s la versi\u00f3 recomanada per a usar-se i \u00e9s la que utilitzarem. Per instal\u00b7lar el servidor DNS en Ubuntu Server, farem servir els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar com qualsevol paquet a Ubuntu: sudo apt-get install bind9 bind9utils bind9-doc Configuraci\u00f3 del servidor Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar l'aut\u00e8ntica configuraci\u00f3, ubicats en el mateix directori. Configuraci\u00f3 named.conf.options \u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0/24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client/s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat: Configuraci\u00f3 named.conf.local En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant: Creaci\u00f3 de l'arxiu de zona Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client. Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat. Comprovaci\u00f3 de les configuracions Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat: Atenci\u00f3! \u00c9s molt important que el client estiga configurat per utilitzar com a servidor DNS el que acabem d'instal\u00b7lar i configurar. Per\u00f2, com podem fer aix\u00f2? Cal recordar que e lclienteest\u00e0 configurat per DHCP i que DHCP permetia una completa configuraci\u00f3 de xarxa, a m\u00e9s de la IP.Consulteu al Tema 2 que \"option\" dins de la declaraci\u00f3 de la subnet a fitxer dhcpd.conf ens permet\u00eda enviar-li a el client la IP de servidor DNS. Comprovaci\u00f3 de les resolucions i de les consultes Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client Tasques a realitzar Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Questions finals Questi\u00f3 1 Qu\u00e9 passar\u00e0 si un client d'una xarxa diferent a la teua intenta fer \u00fas del teu DNS d'alguna manera, li funcionar\u00e0? Per qu\u00e9, en quina part de la configuraci\u00f3 es pot vore? Questi\u00f3 2 Per qu\u00e8 hem de permetre les consultes recursives en la configuraci\u00f3? Questi\u00f3 3 El servidor DNS que acabeu de muntar, es autoritatiu? Per qu\u00e8? Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DNS 2 punts Configuraci\u00f3 correcta de la zona DNS 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#practica-31-configuracio-dun-servidor-dns","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tindre el servidor, el client i a m\u00e9s un clon de el client. Tots dins de la mateixa xarxa interna. \u2714 Heu de tindre configurat el servidor DHCP per que assigne adreces IP fixes als dos clients. \u2714 IMPORTANT: A l'clonar la m\u00e0quina client, per poder assignar IPs fixes en el DHCP, necessiten tenir adreces MAC diferents:","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#installacio-de-servidor-dns","text":"Bind \u00e9s l'est\u00e0ndard de facto per a servidors DNS. \u00c9s una eina de programari lliure i es distribueix amb la majoria de plataformes Unix i Linux, on tamb\u00e9 se li coneix amb el sobrenom de named (name daemon). Bind9 \u00e9s la versi\u00f3 recomanada per a usar-se i \u00e9s la que utilitzarem. Per instal\u00b7lar el servidor DNS en Ubuntu Server, farem servir els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar com qualsevol paquet a Ubuntu: sudo apt-get install bind9 bind9utils bind9-doc","title":"Instal\u00b7laci\u00f3 de servidor DNS"},{"location":"section/P3.1/#configuracio-del-servidor","text":"Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar l'aut\u00e8ntica configuraci\u00f3, ubicats en el mateix directori.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P3.1/#configuracio-namedconfoptions","text":"\u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0/24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client/s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat:","title":"Configuraci\u00f3 named.conf.options"},{"location":"section/P3.1/#configuracio-namedconflocal","text":"En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant:","title":"Configuraci\u00f3 named.conf.local"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona","text":"Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client.","title":"Creaci\u00f3 de l'arxiu de zona"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona-pera-a-la-resolucio-inversa","text":"Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat.","title":"Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa"},{"location":"section/P3.1/#comprovacio-de-les-configuracions","text":"Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat: Atenci\u00f3! \u00c9s molt important que el client estiga configurat per utilitzar com a servidor DNS el que acabem d'instal\u00b7lar i configurar. Per\u00f2, com podem fer aix\u00f2? Cal recordar que e lclienteest\u00e0 configurat per DHCP i que DHCP permetia una completa configuraci\u00f3 de xarxa, a m\u00e9s de la IP.Consulteu al Tema 2 que \"option\" dins de la declaraci\u00f3 de la subnet a fitxer dhcpd.conf ens permet\u00eda enviar-li a el client la IP de servidor DNS.","title":"Comprovaci\u00f3 de les configuracions"},{"location":"section/P3.1/#comprovacio-de-les-resolucions-i-de-les-consultes","text":"Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client","title":"Comprovaci\u00f3 de les resolucions i de les consultes"},{"location":"section/P3.1/#tasques-a-realitzar","text":"Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Tasques a realitzar"},{"location":"section/P3.1/#questions-finals","text":"Questi\u00f3 1 Qu\u00e9 passar\u00e0 si un client d'una xarxa diferent a la teua intenta fer \u00fas del teu DNS d'alguna manera, li funcionar\u00e0? Per qu\u00e9, en quina part de la configuraci\u00f3 es pot vore? Questi\u00f3 2 Per qu\u00e8 hem de permetre les consultes recursives en la configuraci\u00f3? Questi\u00f3 3 El servidor DNS que acabeu de muntar, es autoritatiu? Per qu\u00e8?","title":"Questions finals"},{"location":"section/P3.1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DNS 2 punts Configuraci\u00f3 correcta de la zona DNS 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.2/","text":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3 Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tenir un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau tindr\u00e0 una interf\u00edcie a la nostra xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Aquesta interf\u00edcie, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tindre configurat en netplan que reba la IP per DHCP \u2714 Heu de tenir configurat el servidor DHCP perqu\u00e8 assigni una direcci\u00f3n IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els servicis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La interf\u00edcie de la xarxa interna estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original Nota important Si despr\u00e9s de configurar-ho tot en la pr\u00e0ctica, no ixen els resultats que deuen, pot passar que s'hagi quedat informaci\u00f3 guardada en la cach\u00e9 del client o del server. Per esborrar-les en el client: sudo systemd-resolve --flush-caches I en el servidor: sudo rndc flush sudo rndc reload Millora de la configuraci\u00f3 del servidor Pas 1 \u2013 Afegir subdomini autom\u00e0ticament Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: Aix\u00ed hauria de funcionar: Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\". Pas 2 \u2013 Afegir el nostre servidor DNS com a \u00fanic en el client Si us heu fixat en la sortida de dig o de nslookup des del client, quan us diu que servidor DNS ha utilitzat per a la consulta, us posa que ha estat el 127.0.0.53 Aquesta adre\u00e7a \u00e9s l'adre\u00e7a local de la vostra m\u00e0quina client. Aix\u00f2 \u00e9s aix\u00ed perqu\u00e8 systemd, el \u201cnou\u201d sistema de gesti\u00f3 de servicis de Linux, t\u00e9 una esp\u00e8cie de servidor DNS local que \u00e9s el primer que es consulta i si no t\u00e9 la resposta, la reenv\u00eda al servidor DNS que h\u00e0gim configurat. Aix\u00f2 \u00e9s una falla coneguda de systemd i n'hi ha una esp\u00e8cie de \u201carranjament\u201d per solucionar-ho i \u00e9s crear un link simb\u00f2lic: $ sudo rm -f /etc/resolv.conf $ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf I heu de reaplicar la configuraci\u00f3 de xarxa: sudo netplan apply Tasca Feu una nova consulta en dig i comproveu que ara s\u00ed ha utilitzat el servidor que deu, \u00e9s a dir, l'Ubuntu Server que heu configurat vosaltres. Adjunteu captures de pantalla de la configuraci\u00f3 i el resultat. Pas 3 \u2013 Afegir forwarders Tasca Comproveu que si feu una consulta a una adre\u00e7a de domini d'Internet (cisco.com, github.com\u2026), el domini s\u00ed es resol perfectament. Com \u00e9s aix\u00f2 possible si nom\u00e9s hem configurat les zones autoritatives del DNS i cap m\u00e9s? A quins servidors DNS creieu que consulta el nostre Bind? Tasca Descomenta en l'arxiu la secci\u00f3 de forwarders i afegeix les seg\u00fcents adreces. forwarders { 208.67.222.222; //Servidor DNS d'Opendns 1.1.1.1; //Servidor DNS de Cloudflare }; Tasca Fes un dig a una adre\u00e7a d'Internet una vegada m\u00e9s. Qu\u00e8 creus que hem fet afegint aquestes adreces? Tasca Si en l'arxiu \u201cnamed.conf.options\u201d canvieu la l\u00ednia \u201crecursion yes;\u201d per \u201crecursion no;\u201d Segueix funcionant la resoluci\u00f3 de subdominis externs d'Internet (comprova-ho amb dig o nslookup)? I els propis (comprova-ho amb dig i amb el nom de domini complet de les m\u00e0quines .sre.es)? Per qu\u00e8 passa aix\u00f2 si tenim els forwarders configurats? Nota Pot passar que no us funcionen de primeres. En aquest cas, i en el mateix arxiu, proveu a canviar la l\u00ednia: dnssec-validation auto; Per: dnssec-enable yes; dnssec-validation yes; Pas 4 - Afegir arxius de log Hist\u00f2ricament tots els servicis de Linux han tingut el que es coneixen com a arxius de logs. Aquests arxius contenen text i registren tota l'activitat del servici, \u00e9s a dir, tot el que ocorre amb ell. Hui dia aix\u00f2 ho controla systemd i podem veure l'estat i l'activitat del servici amb el comando sudo journalctl -u nom_de el_servici . No obstant aix\u00f2, anem a afegir els nostres propis arxius de logs per fer-ho m\u00e9s accessible i manejable. Per a aix\u00f2, en l'arxiu \u201cnamed.conf\u201d l'indiquem que ha de tenir en compte un nou arxiu de configuraci\u00f3 que crearem despr\u00e9s per especificar com guardar els logs: include \"/etc/bind/named.conf.logging\"; Hem de crear, ara s\u00ed, l'arxiu \u201cnamed.conf.logging\u201d amb el seg\u00fcent contingut: logging { channel errors_syslog { syslog daemon; severity warning; }; // Per loggear totes les consultes DNS al servidor channel queries_log { file \"/var/log/named/queries.log\" versions 600 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Per loggear tots els errors en realitzar consultes al servidor channel query-errors_log { file \"/var/log/named/query-errors.log\" versions 5 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Definim les categories associades als channels category lame-servers { null; }; category edns-disabled { null; }; category resolver { null; }; category dnssec { errors_syslog; }; category default { errors_syslog; default_debug; }; category unmatched { null; }; category queries { queries_log; }; category query-errors { query-errors_log; }; }; Fixeu-vos en les parts destacades en groc. Li estem indicant que aquests van a ser els arxius de log on es bolcar\u00e0 tota la informaci\u00f3 corresponent. No obstant aix\u00f2, comproveu que aquest directori i aquests fitxers no existeixen. Creeu aquest directori amb aquests fitxers Despr\u00e9s de fer-ho, heu de canviar la propietat de l'arxiu a l'usuari \u201cbind\u201d, que \u00e9s el corresponent al servidor DNS: sudo chown bind.bind nom_de_fitxer Finalment, a la configuraci\u00f3 de Bind cal dir-li que sigui capa\u00e7 de registrar la informaci\u00f3 relativa a les queries o consultes DNS. Per a aix\u00f2 modifiquem l'arxiu d'opcions \u201cnamed.conf.options\u201d i afegim, dins de \u201coptions {...}\u201d la l\u00ednia: querylog yes; I reiniciem el servici de bind (named). Tasca Comprova que realitzant ara consultes des del client, queden registrades en aquest arxiu i fes una captura de pantalla. Configuraci\u00f3 del servidor esclau Per configurar el servidor esclau, hem de tenir un clon de nostre servidor i realitzar els mateixos passos per instal\u00b7lar Bind. Aquest servidor esclau ser\u00e0 capa\u00e7 de resoldre les mateixes consultes que el principal, fins i tot ser\u00e0 capa\u00e7 de seguir resolent consultes si el principal deixa de funcionar. Aix\u00ed doncs, despr\u00e9s d'instal\u00b7lar Bind de la mateixa forma que hem fet en el principal, configurem l'arxiu \u201cnamed.conf.options\u201d exactament de la mateixa manera tamb\u00e9. Per indicar-li a l'esclau que zones va a rebre, hem d'indicar-li que les mateixes que el mestre per\u00f2 en manera esclava. Quedaria aix\u00ed: En la configuraci\u00f3 posa que es guardaran les zones transferides en el directori \u201cesclaus\u201d dins del directori /etc/bind , aix\u00ed que no oblideu crear aquest directori posat que no existeix. Si vos dona error per q\u00fcesti\u00f3 de permisos, canvieu la ruta per a guardar les zones a /var/cache/bind/nom_de_zona En el servidor DNS mestre, hem de, ara s\u00ed, indicar qu\u00e8 zones i a qui anem a tranferirlas. S'utilitzaran aquestes l\u00ednies de configuraci\u00f3: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Aquestes l\u00ednies teniu dues opcions, posar-les perqu\u00e8 actu\u00efn per a cada zona de forma gen\u00e8rica, en l'arxiu \u201cnamed.conf.options\u201d. O podeu posar-la dins de cada zona en qu\u00e8 vulguem transferir en el \u201cnamed.conf.local\u201d, tenint un major control sobre cadascuna d'elles. En lloc de les X.X.X.X, heu de posar la IP del vostre servidor DNS esclau, que \u00e9s a qui se li van a transferir les zones. Finalment reinicia el servici de Bind del mestre i de l'esclau. Comprovaci\u00f3 de la configuraci\u00f3 Tasca comprovaci\u00f3 1 Usant el comando per monitorizar servicis journalctlo -u nom_de_servici -f comprova que es produeix la transfer\u00e8ncia de zona en l'esclau. Hauries de veure alguna cosa com aix\u00f2: Aqu\u00ed podeu veure com es produeixen les transfer\u00e8ncies de la zona de resoluci\u00f3 directa i de la zona de resoluci\u00f3 inversa. Tasca comprovaci\u00f3 2 Comprova que el servidor esclau funciona correctament i resol els noms de dnsserver i cliXubuntu, aix\u00ed com els de Internet. Pots usar qualsevol d'aquests dos comandos: dig nombre.sre.es @X.X.X.X \u2192 IP del servidor esclau nslookup nom X.X.X.X \u2192 IP del servidor esclau Indica en la captura de pantalla on comprovem efectivament que \u00e9s el servidor esclau el que est\u00e0 resolent la consulta. Tasca comprovaci\u00f3 3 Comprova que tot funciona com ha de ser i apaga el servici \u201cnamed\u201d o \u201cbind9\u201d del servidor principal/mestre. El servidor esclau hauria de respondre sense problema a les consultes DNS. Adjunta captures de pantalla dels comandos que utilitzis per fer les consultes DNS i indica en elles on podem veure que \u00e9s el servidor esclau el que est\u00e0 resolent les consultes. Adjunta captura de pantalla dels logs, on es mostra que s'estan rebent consultes (queries). Atenci\u00f3, nota Recorda que perqu\u00e8 els clients usin un servidor DNS en cas de fallada d'un altre, aquesta informaci\u00f3 l'ha d'enviar el servidor DHCP. Aix\u00f2 \u00e9s, el servidor DHCP haur\u00e0 d'enviar-li les adreces IP de tots dos servidors DNS als clients. Questions finals Questi\u00f3 1 De quina altra forma, utilitzant un arxiu de configuraci\u00f3n de Bind9, podem fer que el subdomini \"sre.es\" s'afegisca autom\u00e0ticament als noms de la zona, aconseguint lo mateix que en el Pas 1 ? Questi\u00f3 2 Explica detalladament qu\u00e8 \u00e9s un servidor mestre o principal i qu\u00e8 \u00e9s un esclau o secundari, aix\u00ed com la rel\u00b7laci\u00f3 que tenen. Questi\u00f3 3 Explica per a qu\u00e8 serveixen aquestes l\u00ednies i per qu\u00e8 hem de posarles a l'arxiu de configuraci\u00f3 corresponent: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 4 Com saben els clients qu\u00e8 quan falla el server DNS principal, ha de comen\u00e7ar a utilitzar el secondari? Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta DHCP per a enviar subdomini i comprovaci\u00f3 1 punts Configuraci\u00f3 correcta del servidor DNS com a \u00fanic en el client i comprovaci\u00f3 0,5 punts Configuraci\u00f3 correcta dels forwarders i resposta a les questions 0,5 punts Configuraci\u00f3 correcta dels logs i comprovaci\u00f3 2 punts Configuraci\u00f3 correcta del servidor esclau i totes les comprovacions 3 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3"},{"location":"section/P3.2/#practica-32-configuracio-de-servidor-dns-mestreesclau-i-millora-de-la-configuracio","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tenir un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau tindr\u00e0 una interf\u00edcie a la nostra xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Aquesta interf\u00edcie, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tindre configurat en netplan que reba la IP per DHCP \u2714 Heu de tenir configurat el servidor DHCP perqu\u00e8 assigni una direcci\u00f3n IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els servicis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La interf\u00edcie de la xarxa interna estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original Nota important Si despr\u00e9s de configurar-ho tot en la pr\u00e0ctica, no ixen els resultats que deuen, pot passar que s'hagi quedat informaci\u00f3 guardada en la cach\u00e9 del client o del server. Per esborrar-les en el client: sudo systemd-resolve --flush-caches I en el servidor: sudo rndc flush sudo rndc reload","title":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3"},{"location":"section/P3.2/#millora-de-la-configuracio-del-servidor","text":"","title":"Millora de la configuraci\u00f3 del servidor"},{"location":"section/P3.2/#pas-1-afegir-subdomini-automaticament","text":"Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: Aix\u00ed hauria de funcionar: Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\".","title":"Pas 1 \u2013 Afegir subdomini autom\u00e0ticament"},{"location":"section/P3.2/#pas-2-afegir-el-nostre-servidor-dns-com-a-unic-en-el-client","text":"Si us heu fixat en la sortida de dig o de nslookup des del client, quan us diu que servidor DNS ha utilitzat per a la consulta, us posa que ha estat el 127.0.0.53 Aquesta adre\u00e7a \u00e9s l'adre\u00e7a local de la vostra m\u00e0quina client. Aix\u00f2 \u00e9s aix\u00ed perqu\u00e8 systemd, el \u201cnou\u201d sistema de gesti\u00f3 de servicis de Linux, t\u00e9 una esp\u00e8cie de servidor DNS local que \u00e9s el primer que es consulta i si no t\u00e9 la resposta, la reenv\u00eda al servidor DNS que h\u00e0gim configurat. Aix\u00f2 \u00e9s una falla coneguda de systemd i n'hi ha una esp\u00e8cie de \u201carranjament\u201d per solucionar-ho i \u00e9s crear un link simb\u00f2lic: $ sudo rm -f /etc/resolv.conf $ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf I heu de reaplicar la configuraci\u00f3 de xarxa: sudo netplan apply Tasca Feu una nova consulta en dig i comproveu que ara s\u00ed ha utilitzat el servidor que deu, \u00e9s a dir, l'Ubuntu Server que heu configurat vosaltres. Adjunteu captures de pantalla de la configuraci\u00f3 i el resultat.","title":"Pas 2 \u2013 Afegir el nostre servidor DNS com a \u00fanic en el client"},{"location":"section/P3.2/#pas-3-afegir-forwarders","text":"Tasca Comproveu que si feu una consulta a una adre\u00e7a de domini d'Internet (cisco.com, github.com\u2026), el domini s\u00ed es resol perfectament. Com \u00e9s aix\u00f2 possible si nom\u00e9s hem configurat les zones autoritatives del DNS i cap m\u00e9s? A quins servidors DNS creieu que consulta el nostre Bind? Tasca Descomenta en l'arxiu la secci\u00f3 de forwarders i afegeix les seg\u00fcents adreces. forwarders { 208.67.222.222; //Servidor DNS d'Opendns 1.1.1.1; //Servidor DNS de Cloudflare }; Tasca Fes un dig a una adre\u00e7a d'Internet una vegada m\u00e9s. Qu\u00e8 creus que hem fet afegint aquestes adreces? Tasca Si en l'arxiu \u201cnamed.conf.options\u201d canvieu la l\u00ednia \u201crecursion yes;\u201d per \u201crecursion no;\u201d Segueix funcionant la resoluci\u00f3 de subdominis externs d'Internet (comprova-ho amb dig o nslookup)? I els propis (comprova-ho amb dig i amb el nom de domini complet de les m\u00e0quines .sre.es)? Per qu\u00e8 passa aix\u00f2 si tenim els forwarders configurats? Nota Pot passar que no us funcionen de primeres. En aquest cas, i en el mateix arxiu, proveu a canviar la l\u00ednia: dnssec-validation auto; Per: dnssec-enable yes; dnssec-validation yes;","title":"Pas 3 \u2013 Afegir forwarders"},{"location":"section/P3.2/#pas-4-afegir-arxius-de-log","text":"Hist\u00f2ricament tots els servicis de Linux han tingut el que es coneixen com a arxius de logs. Aquests arxius contenen text i registren tota l'activitat del servici, \u00e9s a dir, tot el que ocorre amb ell. Hui dia aix\u00f2 ho controla systemd i podem veure l'estat i l'activitat del servici amb el comando sudo journalctl -u nom_de el_servici . No obstant aix\u00f2, anem a afegir els nostres propis arxius de logs per fer-ho m\u00e9s accessible i manejable. Per a aix\u00f2, en l'arxiu \u201cnamed.conf\u201d l'indiquem que ha de tenir en compte un nou arxiu de configuraci\u00f3 que crearem despr\u00e9s per especificar com guardar els logs: include \"/etc/bind/named.conf.logging\"; Hem de crear, ara s\u00ed, l'arxiu \u201cnamed.conf.logging\u201d amb el seg\u00fcent contingut: logging { channel errors_syslog { syslog daemon; severity warning; }; // Per loggear totes les consultes DNS al servidor channel queries_log { file \"/var/log/named/queries.log\" versions 600 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Per loggear tots els errors en realitzar consultes al servidor channel query-errors_log { file \"/var/log/named/query-errors.log\" versions 5 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Definim les categories associades als channels category lame-servers { null; }; category edns-disabled { null; }; category resolver { null; }; category dnssec { errors_syslog; }; category default { errors_syslog; default_debug; }; category unmatched { null; }; category queries { queries_log; }; category query-errors { query-errors_log; }; }; Fixeu-vos en les parts destacades en groc. Li estem indicant que aquests van a ser els arxius de log on es bolcar\u00e0 tota la informaci\u00f3 corresponent. No obstant aix\u00f2, comproveu que aquest directori i aquests fitxers no existeixen. Creeu aquest directori amb aquests fitxers Despr\u00e9s de fer-ho, heu de canviar la propietat de l'arxiu a l'usuari \u201cbind\u201d, que \u00e9s el corresponent al servidor DNS: sudo chown bind.bind nom_de_fitxer Finalment, a la configuraci\u00f3 de Bind cal dir-li que sigui capa\u00e7 de registrar la informaci\u00f3 relativa a les queries o consultes DNS. Per a aix\u00f2 modifiquem l'arxiu d'opcions \u201cnamed.conf.options\u201d i afegim, dins de \u201coptions {...}\u201d la l\u00ednia: querylog yes; I reiniciem el servici de bind (named). Tasca Comprova que realitzant ara consultes des del client, queden registrades en aquest arxiu i fes una captura de pantalla.","title":"Pas 4 - Afegir arxius de log"},{"location":"section/P3.2/#configuracio-del-servidor-esclau","text":"Per configurar el servidor esclau, hem de tenir un clon de nostre servidor i realitzar els mateixos passos per instal\u00b7lar Bind. Aquest servidor esclau ser\u00e0 capa\u00e7 de resoldre les mateixes consultes que el principal, fins i tot ser\u00e0 capa\u00e7 de seguir resolent consultes si el principal deixa de funcionar. Aix\u00ed doncs, despr\u00e9s d'instal\u00b7lar Bind de la mateixa forma que hem fet en el principal, configurem l'arxiu \u201cnamed.conf.options\u201d exactament de la mateixa manera tamb\u00e9. Per indicar-li a l'esclau que zones va a rebre, hem d'indicar-li que les mateixes que el mestre per\u00f2 en manera esclava. Quedaria aix\u00ed: En la configuraci\u00f3 posa que es guardaran les zones transferides en el directori \u201cesclaus\u201d dins del directori /etc/bind , aix\u00ed que no oblideu crear aquest directori posat que no existeix. Si vos dona error per q\u00fcesti\u00f3 de permisos, canvieu la ruta per a guardar les zones a /var/cache/bind/nom_de_zona En el servidor DNS mestre, hem de, ara s\u00ed, indicar qu\u00e8 zones i a qui anem a tranferirlas. S'utilitzaran aquestes l\u00ednies de configuraci\u00f3: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Aquestes l\u00ednies teniu dues opcions, posar-les perqu\u00e8 actu\u00efn per a cada zona de forma gen\u00e8rica, en l'arxiu \u201cnamed.conf.options\u201d. O podeu posar-la dins de cada zona en qu\u00e8 vulguem transferir en el \u201cnamed.conf.local\u201d, tenint un major control sobre cadascuna d'elles. En lloc de les X.X.X.X, heu de posar la IP del vostre servidor DNS esclau, que \u00e9s a qui se li van a transferir les zones. Finalment reinicia el servici de Bind del mestre i de l'esclau.","title":"Configuraci\u00f3 del servidor esclau"},{"location":"section/P3.2/#comprovacio-de-la-configuracio","text":"Tasca comprovaci\u00f3 1 Usant el comando per monitorizar servicis journalctlo -u nom_de_servici -f comprova que es produeix la transfer\u00e8ncia de zona en l'esclau. Hauries de veure alguna cosa com aix\u00f2: Aqu\u00ed podeu veure com es produeixen les transfer\u00e8ncies de la zona de resoluci\u00f3 directa i de la zona de resoluci\u00f3 inversa. Tasca comprovaci\u00f3 2 Comprova que el servidor esclau funciona correctament i resol els noms de dnsserver i cliXubuntu, aix\u00ed com els de Internet. Pots usar qualsevol d'aquests dos comandos: dig nombre.sre.es @X.X.X.X \u2192 IP del servidor esclau nslookup nom X.X.X.X \u2192 IP del servidor esclau Indica en la captura de pantalla on comprovem efectivament que \u00e9s el servidor esclau el que est\u00e0 resolent la consulta. Tasca comprovaci\u00f3 3 Comprova que tot funciona com ha de ser i apaga el servici \u201cnamed\u201d o \u201cbind9\u201d del servidor principal/mestre. El servidor esclau hauria de respondre sense problema a les consultes DNS. Adjunta captures de pantalla dels comandos que utilitzis per fer les consultes DNS i indica en elles on podem veure que \u00e9s el servidor esclau el que est\u00e0 resolent les consultes. Adjunta captura de pantalla dels logs, on es mostra que s'estan rebent consultes (queries). Atenci\u00f3, nota Recorda que perqu\u00e8 els clients usin un servidor DNS en cas de fallada d'un altre, aquesta informaci\u00f3 l'ha d'enviar el servidor DHCP. Aix\u00f2 \u00e9s, el servidor DHCP haur\u00e0 d'enviar-li les adreces IP de tots dos servidors DNS als clients.","title":"Comprovaci\u00f3 de la configuraci\u00f3"},{"location":"section/P3.2/#questions-finals","text":"Questi\u00f3 1 De quina altra forma, utilitzant un arxiu de configuraci\u00f3n de Bind9, podem fer que el subdomini \"sre.es\" s'afegisca autom\u00e0ticament als noms de la zona, aconseguint lo mateix que en el Pas 1 ? Questi\u00f3 2 Explica detalladament qu\u00e8 \u00e9s un servidor mestre o principal i qu\u00e8 \u00e9s un esclau o secundari, aix\u00ed com la rel\u00b7laci\u00f3 que tenen. Questi\u00f3 3 Explica per a qu\u00e8 serveixen aquestes l\u00ednies i per qu\u00e8 hem de posarles a l'arxiu de configuraci\u00f3 corresponent: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 4 Com saben els clients qu\u00e8 quan falla el server DNS principal, ha de comen\u00e7ar a utilitzar el secondari?","title":"Questions finals"},{"location":"section/P3.2/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta DHCP per a enviar subdomini i comprovaci\u00f3 1 punts Configuraci\u00f3 correcta del servidor DNS com a \u00fanic en el client i comprovaci\u00f3 0,5 punts Configuraci\u00f3 correcta dels forwarders i resposta a les questions 0,5 punts Configuraci\u00f3 correcta dels logs i comprovaci\u00f3 2 punts Configuraci\u00f3 correcta del servidor esclau i totes les comprovacions 3 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.3/","text":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidors mestre i esclau en diferents xarxes Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 \u00c9s imprescindible que tingueu funcionant correctament totes les pr\u00e0ctiques anteriors \u2714 Comproveu que les pr\u00e0ctiques anteriors funcionen correctament abans de comen\u00e7ar aquesta pr\u00e0ctica. Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor mestre 172.1.X.X Servidor esclau 172.1.X.X Client 1 172.1.X.X Client2 172.1.X.X Escenari En aquesta pr\u00e0ctica anem a muntar, igual que vam fer en l'anterior, un escenari de servidors mestre/esclau. El mestre ser\u00e0 el vostre servidor i l'esclau el servidor d'un altre company. Si transferim les zones des del servidor fins a l'esclau amb aquesta configuraci\u00f3 de xarxa, l'alumne 2 ser\u00e0 capa\u00e7 de fer ping al nostre nom de domini d'alumne 1 (recordeu que, de la pr\u00e0ctica 1, ja es pod\u00eda fer ping per IP). \u00c9s a dir, la m\u00e0quina 171.1.a.2 podria fer ping a clixubuntu.sre.es . Configuraci\u00f3 dels dominis En primer lloc, anem a canviar el nom dels dominis. Canviarem el nom del subdomini a utilitzar de .sre.es. a nom_alumne.es. Aix\u00ed doncs, el meu domini per exemple quedaria com raul.es. . D'aquesta forma, cada alumne tindr\u00e0 un subdomini diferent. Aix\u00f2 implica que haureu de canviar en tots els arxius, en totes les l\u00ednies on aparega, sre.es pel vostre domini: Arxius de configuraci\u00f3 de zones named.conf.local Configuraci\u00f3 DHCP Configuraci\u00f3 del mestre Mireu el diagrama de xarxa o imatge de m\u00e9s amunt. Adoneu-vos que ara el servidor DNS ha d'escoltar per les dues interf\u00edcies: La interf\u00edcie de la xarxa interna \u2192 per resoldre les consultes del client La interf\u00edcie de la LAN \u2192 per poder transferir/rebre les zones Aix\u00f2 implica que haureu de modificar l'arxiu \u201cnamed.conf.options\u201d de forma concorde. Recordem l'arxiu de configuraci\u00f3 \u201cnamed.conf.options\u201d : Llista d'acc\u00e9s per permetre \u00fanicament els hosts que decidim acl confiables{ 172.1.1.0/24; }; options { directory \"/var/cache/bind\"; querylog yes; // If there is a firewall between you and nameservers you want // to talk to, you may need to fix the firewall to allow multiple // ports to talk. See http://www.kb.cert.org/vuls/id/800113 // If your ISP provided one or habiti IP addresses for stable // nameservers, you probably want to usi them as forwarders. // Uncomment the following block, and insert the addresses replacing // the all-0's placeholder. forwarders { 208.67.222.222; 1.1.1.1; }; allow-recursion {confiables;}; allow-transfer { X.X.X.X; }; also-notify { X.X.X.X; }; listen-on port 53 { 172.1.1.1; }; recursion yes; //======================================================================== // If BIND logs error messages about the root key being expired, // you will need to update your keys. See https://www.isc.org/bind-keys //dnssec-validation acte; dnssec-enable yes; dnssec-validation yes; //llistin-on-v6 { none; }; }; Recordem qu\u00e8 fa cada opci\u00f3: allow-recursion \u2192 de qui es permeten les consultes recursives en aquest servidor DNS allow-transfer \u2192 cap a qui es permet transfer\u00e8ncia de zones also-notify \u2192 cap a qui s'envia un av\u00eds o notificaci\u00f3 quan el mestre recarrega els seus arxius de zona listen-on port 53 \u2192 la IP de la interf\u00edcie on el servidor escolta consultes DNS recursion yes; \u2192 es permeten les consultes recursives, amb allow-recursion li indiquem de qui exactament, utilitzant la ACL (llista d'acc\u00e9s) confiables. Nota En la pr\u00e0ctica anterior vos vaig dir que les l\u00ednies allow-transfer i also-notify les pod\u00edeu tenir en \u201cnamed.conf.options\u201d o dins de cada zona en \u201cnamed.conf.local\u201d. Poseu-les nom\u00e9s en un dels dos llocs perqu\u00e8 si les teniu en els dos llocs i no estan iguals, podeu tenir problemes. Aix\u00ed les coses, hem de configurar el servidor mestre de tal forma que consideri al servidor esclau com confiable, que permita les consultes recursivas dels confiables, que permeti les transfer\u00e8ncies de zona cap a la IP de l'esclau, que tamb\u00e9 li notifiqui i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna i la de la LAN). Recordeu a l'hora de posar les IPs corresponents, mirant una vegada m\u00e9s el diagrama de xarxa, que ara les zones es transfereixen per la LAN. Configuraci\u00f3 de l'esclau En l'esclau tamb\u00e9 s'han de canviar els mateixos arxius per posar-li el nou domini (recordeu que cada alumne tindr\u00e0 un subdomini amb el seu nom). Hem de configurar el servidor esclau de tal forma que consideri al servidor mestre com confiable, que permita les consultes recursivas, i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna per als clients i la de la LAN per al mestre). Recordeu de la pr\u00e0ctica 3.2 com es configuraven les zones en \u201cnamed.conf.local\u201d, depenent de si era mestre o esclau el servidor. Comprovaci\u00f3 Comproveu amb \u201cjournalctl -u named -f\u201d que es produeixen les transfer\u00e8ncies de zona. Si tot ha anat b\u00e9, podr\u00e9 resoldre (amb nslookup) i fer ping als meus noms de domini (dnsserver i cliXubuntu) i als de l'esclau (dnsserver.nomalumno.es i cliXubuntu.nom_alumne.es). Recordeu que per resoldre els subdominis de l'esclau haig d'afegir-li el subdomini ja que \u00e9s un de diferent al meu i en el DHCP nom\u00e9s li estic enviant el meu. Configuraci\u00f3 servidor mestre/esclau Ara haureu de configurar tots dos servidors perqu\u00e8 siguin mestre/esclau. Ser\u00e0 mestre de les zones del vostre subdomini (raul.es. en el meu cas) i esclau de les del vostre company (nombrealumne.es.). Aix\u00f2 vol dir que l'arxiu \u201cnamed.conf.local\u201d tindr\u00e0 zones de tipus mestre i esclau. Una vegada configurat, comproveu que tots dos des dels vostres clients podeu resoldre els noms de domini del company (recordeu afegir el subdomini del company en els noms de les consultes).","title":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidor DNS mestre i esclau en diferents xarxes"},{"location":"section/P3.3/#practica-33-configuracio-de-servidors-mestre-i-esclau-en-diferents-xarxes","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 \u00c9s imprescindible que tingueu funcionant correctament totes les pr\u00e0ctiques anteriors \u2714 Comproveu que les pr\u00e0ctiques anteriors funcionen correctament abans de comen\u00e7ar aquesta pr\u00e0ctica. Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor mestre 172.1.X.X Servidor esclau 172.1.X.X Client 1 172.1.X.X Client2 172.1.X.X","title":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidors mestre i esclau en diferents xarxes"},{"location":"section/P3.3/#escenari","text":"En aquesta pr\u00e0ctica anem a muntar, igual que vam fer en l'anterior, un escenari de servidors mestre/esclau. El mestre ser\u00e0 el vostre servidor i l'esclau el servidor d'un altre company. Si transferim les zones des del servidor fins a l'esclau amb aquesta configuraci\u00f3 de xarxa, l'alumne 2 ser\u00e0 capa\u00e7 de fer ping al nostre nom de domini d'alumne 1 (recordeu que, de la pr\u00e0ctica 1, ja es pod\u00eda fer ping per IP). \u00c9s a dir, la m\u00e0quina 171.1.a.2 podria fer ping a clixubuntu.sre.es .","title":"Escenari"},{"location":"section/P3.3/#configuracio-dels-dominis","text":"En primer lloc, anem a canviar el nom dels dominis. Canviarem el nom del subdomini a utilitzar de .sre.es. a nom_alumne.es. Aix\u00ed doncs, el meu domini per exemple quedaria com raul.es. . D'aquesta forma, cada alumne tindr\u00e0 un subdomini diferent. Aix\u00f2 implica que haureu de canviar en tots els arxius, en totes les l\u00ednies on aparega, sre.es pel vostre domini: Arxius de configuraci\u00f3 de zones named.conf.local Configuraci\u00f3 DHCP","title":"Configuraci\u00f3 dels dominis"},{"location":"section/P3.3/#configuracio-del-mestre","text":"Mireu el diagrama de xarxa o imatge de m\u00e9s amunt. Adoneu-vos que ara el servidor DNS ha d'escoltar per les dues interf\u00edcies: La interf\u00edcie de la xarxa interna \u2192 per resoldre les consultes del client La interf\u00edcie de la LAN \u2192 per poder transferir/rebre les zones Aix\u00f2 implica que haureu de modificar l'arxiu \u201cnamed.conf.options\u201d de forma concorde. Recordem l'arxiu de configuraci\u00f3 \u201cnamed.conf.options\u201d : Llista d'acc\u00e9s per permetre \u00fanicament els hosts que decidim acl confiables{ 172.1.1.0/24; }; options { directory \"/var/cache/bind\"; querylog yes; // If there is a firewall between you and nameservers you want // to talk to, you may need to fix the firewall to allow multiple // ports to talk. See http://www.kb.cert.org/vuls/id/800113 // If your ISP provided one or habiti IP addresses for stable // nameservers, you probably want to usi them as forwarders. // Uncomment the following block, and insert the addresses replacing // the all-0's placeholder. forwarders { 208.67.222.222; 1.1.1.1; }; allow-recursion {confiables;}; allow-transfer { X.X.X.X; }; also-notify { X.X.X.X; }; listen-on port 53 { 172.1.1.1; }; recursion yes; //======================================================================== // If BIND logs error messages about the root key being expired, // you will need to update your keys. See https://www.isc.org/bind-keys //dnssec-validation acte; dnssec-enable yes; dnssec-validation yes; //llistin-on-v6 { none; }; }; Recordem qu\u00e8 fa cada opci\u00f3: allow-recursion \u2192 de qui es permeten les consultes recursives en aquest servidor DNS allow-transfer \u2192 cap a qui es permet transfer\u00e8ncia de zones also-notify \u2192 cap a qui s'envia un av\u00eds o notificaci\u00f3 quan el mestre recarrega els seus arxius de zona listen-on port 53 \u2192 la IP de la interf\u00edcie on el servidor escolta consultes DNS recursion yes; \u2192 es permeten les consultes recursives, amb allow-recursion li indiquem de qui exactament, utilitzant la ACL (llista d'acc\u00e9s) confiables. Nota En la pr\u00e0ctica anterior vos vaig dir que les l\u00ednies allow-transfer i also-notify les pod\u00edeu tenir en \u201cnamed.conf.options\u201d o dins de cada zona en \u201cnamed.conf.local\u201d. Poseu-les nom\u00e9s en un dels dos llocs perqu\u00e8 si les teniu en els dos llocs i no estan iguals, podeu tenir problemes. Aix\u00ed les coses, hem de configurar el servidor mestre de tal forma que consideri al servidor esclau com confiable, que permita les consultes recursivas dels confiables, que permeti les transfer\u00e8ncies de zona cap a la IP de l'esclau, que tamb\u00e9 li notifiqui i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna i la de la LAN). Recordeu a l'hora de posar les IPs corresponents, mirant una vegada m\u00e9s el diagrama de xarxa, que ara les zones es transfereixen per la LAN.","title":"Configuraci\u00f3 del mestre"},{"location":"section/P3.3/#configuracio-de-lesclau","text":"En l'esclau tamb\u00e9 s'han de canviar els mateixos arxius per posar-li el nou domini (recordeu que cada alumne tindr\u00e0 un subdomini amb el seu nom). Hem de configurar el servidor esclau de tal forma que consideri al servidor mestre com confiable, que permita les consultes recursivas, i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna per als clients i la de la LAN per al mestre). Recordeu de la pr\u00e0ctica 3.2 com es configuraven les zones en \u201cnamed.conf.local\u201d, depenent de si era mestre o esclau el servidor.","title":"Configuraci\u00f3 de l'esclau"},{"location":"section/P3.3/#comprovacio","text":"Comproveu amb \u201cjournalctl -u named -f\u201d que es produeixen les transfer\u00e8ncies de zona. Si tot ha anat b\u00e9, podr\u00e9 resoldre (amb nslookup) i fer ping als meus noms de domini (dnsserver i cliXubuntu) i als de l'esclau (dnsserver.nomalumno.es i cliXubuntu.nom_alumne.es). Recordeu que per resoldre els subdominis de l'esclau haig d'afegir-li el subdomini ja que \u00e9s un de diferent al meu i en el DHCP nom\u00e9s li estic enviant el meu.","title":"Comprovaci\u00f3"},{"location":"section/P3.3/#configuracio-servidor-mestreesclau","text":"Ara haureu de configurar tots dos servidors perqu\u00e8 siguin mestre/esclau. Ser\u00e0 mestre de les zones del vostre subdomini (raul.es. en el meu cas) i esclau de les del vostre company (nombrealumne.es.). Aix\u00f2 vol dir que l'arxiu \u201cnamed.conf.local\u201d tindr\u00e0 zones de tipus mestre i esclau. Una vegada configurat, comproveu que tots dos des dels vostres clients podeu resoldre els noms de domini del company (recordeu afegir el subdomini del company en els noms de les consultes).","title":"Configuraci\u00f3 servidor mestre/esclau"}]}