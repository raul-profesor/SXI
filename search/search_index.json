{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"En aquesta web podreu consultar totes les pr\u00e0ctiques d'aquest m\u00f2dul.","title":"Home"},{"location":"section/P1/","text":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa Configuraci\u00f3 de les m\u00e0quines Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un. Ubuntu Server Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna: Xubuntu (client) Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama. Configuraci\u00f3 d'interfaces amb netplan Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quines s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa. Configuraci\u00f3 del enrutament o encaminament Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p Rutes est\u00e0tiques El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d . Toc final ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 de xarxa correcta amb netplan d'ambdues m\u00e0quines 4 punts Configuraci\u00f3 correcta de l'encaminament entre els dos alumnes en les dos direccions 5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt Configuraci\u00f3 extra d'un segon client +0,5 punts (extra)","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#practica-1-muntant-larquitectura-de-xarxa","text":"","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#configuracio-de-les-maquines","text":"Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un.","title":"Configuraci\u00f3 de les m\u00e0quines"},{"location":"section/P1/#ubuntu-server","text":"Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna:","title":"Ubuntu Server"},{"location":"section/P1/#xubuntu-client","text":"Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama.","title":"Xubuntu (client)"},{"location":"section/P1/#configuracio-dinterfaces-amb-netplan","text":"Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quines s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa.","title":"Configuraci\u00f3 d'interfaces amb netplan"},{"location":"section/P1/#configuracio-del-enrutament-o-encaminament","text":"Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p","title":"Configuraci\u00f3 del enrutament o encaminament"},{"location":"section/P1/#rutes-estatiques","text":"El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d .","title":"Rutes est\u00e0tiques"},{"location":"section/P1/#toc-final","text":"ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Toc final"},{"location":"section/P1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 de xarxa correcta amb netplan d'ambdues m\u00e0quines 4 punts Configuraci\u00f3 correcta de l'encaminament entre els dos alumnes en les dos direccions 5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt Configuraci\u00f3 extra d'un segon client +0,5 punts (extra)","title":"Avaluaci\u00f3"},{"location":"section/P2.1/","text":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP Instal\u00b7laci\u00f3 del servidor DHCP Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server Configuraci\u00f3 del client Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la. Configuraci\u00f3 del servidor DHCP Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.3 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servici DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1. Afegir un client DHCP amb IP reservada Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servici amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/hardware address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a Ultima comprovaci\u00f3 Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 del servidor DHCP 4 punts Afegir un client amb IP reservada 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#practica-21-installacio-i-configuracio-de-servidor-dhcp","text":"","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#installacio-del-servidor-dhcp","text":"Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server","title":"Instal\u00b7laci\u00f3 del servidor DHCP"},{"location":"section/P2.1/#configuracio-del-client","text":"Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.1/#configuracio-del-servidor-dhcp","text":"Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.3 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servici DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1.","title":"Configuraci\u00f3 del servidor DHCP"},{"location":"section/P2.1/#afegir-un-client-dhcp-amb-ip-reservada","text":"Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servici amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/hardware address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a","title":"Afegir un client DHCP amb IP reservada"},{"location":"section/P2.1/#ultima-comprovacio","text":"Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Ultima comprovaci\u00f3"},{"location":"section/P2.1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 del servidor DHCP 4 punts Afegir un client amb IP reservada 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P2.2/","text":"Pr\u00e0ctica 2.2 - DHCP Relay Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta. Introducci\u00f3 En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball. Configuraci\u00f3 del client Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir. Configuraci\u00f3 del servidor Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa. En aquest router/servidor, a l'arxiu /etc/default/isc-dhcp-server teniueu posat l'interfaz de la xarxa interna. Com hara rebreu les peticions DHCP del relay per l'interfaz LAN haureu d'afegir a l'apartat \"INTERFACESv4\" el nom d'eixa interfaz. Parada del servidor DHCP En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server Instal\u00b7laci\u00f3 del DHCP relay Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta sigu\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni. Configuraci\u00f3 DHCP Server Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server Comprovaci\u00f3 Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa). Nova comprobaci\u00f3 Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Questions finals Questi\u00f3 1 Si l' alumne 1 est\u00e0 fent de servidor DHCP i l' alumne 2 est\u00e0 fent de relay , imaginem que l'alumne 2 afegix al seu Ubuntu server (que, recordem, fa de relay) una interf\u00edcie que es crida enp0s15 . En aquesta interf\u00edcie, l'alumne 2 decidix crear la nova xarxa 10.10.10.0/24 amb un sol client Xubuntu, on la interf\u00edcie del router t\u00e9 la IP 10.10.10.1 i el client Xubuntu la IP 10.10.10.2 Explica detalladament tot el que haur\u00edem de configurar per tal de que el server DHCP de l'alumne 1 puga donar IP tamb\u00e9 en el rang d'eixa nova xarxa del company i, concretament, en el rang 10.10.10.50 - 10.10.10.150 Questi\u00f3 2 Imagineu que el comando dhcpd -t vos diu que teniu un error en l'arxiu dhcpd.conf , el detecteu i editeu l'arxiu solucionant l'error. No obstant aix\u00f2, el server dhcp continua donant error. \u00bfQu\u00e9 m\u00e9s fa falta, a m\u00e9s d'editar l'error de dhcpd.conf ? Questi\u00f3 3 En aquesta captura: A qui pertany la direcci\u00f3 MAC i qui pertany la IP 192.168.18.76 ? Questi\u00f3 4 Com puc saber o a on puc vore quines IP ha assignat ja el servidor DHCP? Questi\u00f3 5 Podr\u00eda assignar una IP fixa a la xarxa del meu company? Explica detalladament quina configuraci\u00f3 far\u00eda falta. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DHCP 2 punts Configuraci\u00f3 correcta del relay 2 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#practica-22-dhcp-relay","text":"Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta.","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#introduccio","text":"En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball.","title":"Introducci\u00f3"},{"location":"section/P2.2/#configuracio-del-client","text":"Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.2/#configuracio-del-servidor","text":"Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa. En aquest router/servidor, a l'arxiu /etc/default/isc-dhcp-server teniueu posat l'interfaz de la xarxa interna. Com hara rebreu les peticions DHCP del relay per l'interfaz LAN haureu d'afegir a l'apartat \"INTERFACESv4\" el nom d'eixa interfaz.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P2.2/#parada-del-servidor-dhcp","text":"En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server","title":"Parada del servidor DHCP"},{"location":"section/P2.2/#installacio-del-dhcp-relay","text":"Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta sigu\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni.","title":"Instal\u00b7laci\u00f3 del DHCP relay"},{"location":"section/P2.2/#configuracio-dhcp-server","text":"Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server","title":"Configuraci\u00f3 DHCP Server"},{"location":"section/P2.2/#comprovacio","text":"Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa).","title":"Comprovaci\u00f3"},{"location":"section/P2.2/#nova-comprobacio","text":"Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Nova comprobaci\u00f3"},{"location":"section/P2.2/#questions-finals","text":"Questi\u00f3 1 Si l' alumne 1 est\u00e0 fent de servidor DHCP i l' alumne 2 est\u00e0 fent de relay , imaginem que l'alumne 2 afegix al seu Ubuntu server (que, recordem, fa de relay) una interf\u00edcie que es crida enp0s15 . En aquesta interf\u00edcie, l'alumne 2 decidix crear la nova xarxa 10.10.10.0/24 amb un sol client Xubuntu, on la interf\u00edcie del router t\u00e9 la IP 10.10.10.1 i el client Xubuntu la IP 10.10.10.2 Explica detalladament tot el que haur\u00edem de configurar per tal de que el server DHCP de l'alumne 1 puga donar IP tamb\u00e9 en el rang d'eixa nova xarxa del company i, concretament, en el rang 10.10.10.50 - 10.10.10.150 Questi\u00f3 2 Imagineu que el comando dhcpd -t vos diu que teniu un error en l'arxiu dhcpd.conf , el detecteu i editeu l'arxiu solucionant l'error. No obstant aix\u00f2, el server dhcp continua donant error. \u00bfQu\u00e9 m\u00e9s fa falta, a m\u00e9s d'editar l'error de dhcpd.conf ? Questi\u00f3 3 En aquesta captura: A qui pertany la direcci\u00f3 MAC i qui pertany la IP 192.168.18.76 ? Questi\u00f3 4 Com puc saber o a on puc vore quines IP ha assignat ja el servidor DHCP? Questi\u00f3 5 Podr\u00eda assignar una IP fixa a la xarxa del meu company? Explica detalladament quina configuraci\u00f3 far\u00eda falta.","title":"Questions finals"},{"location":"section/P2.2/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DHCP 2 punts Configuraci\u00f3 correcta del relay 2 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.1/","text":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tindre el servidor, el client i a m\u00e9s un clon de el client. Tots dins de la mateixa xarxa interna. \u2714 Heu de tindre configurat el servidor DHCP per que assigne adreces IP fixes als dos clients. \u2714 IMPORTANT: A l'clonar la m\u00e0quina client, per poder assignar IPs fixes en el DHCP, necessiten tenir adreces MAC diferents: Instal\u00b7laci\u00f3 de servidor DNS Bind \u00e9s l'est\u00e0ndard de facto per a servidors DNS. \u00c9s una eina de programari lliure i es distribueix amb la majoria de plataformes Unix i Linux, on tamb\u00e9 se li coneix amb el sobrenom de named (name daemon). Bind9 \u00e9s la versi\u00f3 recomanada per a usar-se i \u00e9s la que utilitzarem. Per instal\u00b7lar el servidor DNS en Ubuntu Server, farem servir els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar com qualsevol paquet a Ubuntu: sudo apt-get install bind9 bind9utils bind9-doc Configuraci\u00f3 del servidor Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar l'aut\u00e8ntica configuraci\u00f3, ubicats en el mateix directori. Configuraci\u00f3 named.conf.options \u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0/24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client/s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat: Configuraci\u00f3 named.conf.local En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant: Creaci\u00f3 de l'arxiu de zona Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client. Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat. Comprovaci\u00f3 de les configuracions Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: m Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat: Atenci\u00f3! \u00c9s molt important que el client estiga configurat per utilitzar com a servidor DNS el que acabem d'instal\u00b7lar i configurar. Per\u00f2, com podem fer aix\u00f2? Cal recordar que el client est\u00e0 configurat per DHCP i que DHCP permetia una completa configuraci\u00f3 de xarxa, a m\u00e9s de la IP. Consulteu al Tema 2 que \"option\" dins de la declaraci\u00f3 de la subnet a fitxer dhcpd.conf ens permet\u00eda enviar-li a el client la IP de servidor DNS. Comprovaci\u00f3 de les resolucions i de les consultes Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client Tasques a realitzar Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3. Questions finals Questi\u00f3 1 Qu\u00e9 passar\u00e0 si un client d'una xarxa diferent a la teua intenta fer \u00fas del teu DNS d'alguna manera, li funcionar\u00e0? Per qu\u00e9, en quina part de la configuraci\u00f3 es pot vore? Questi\u00f3 2 Per qu\u00e8 hem de permetre les consultes recursives en la configuraci\u00f3? Questi\u00f3 3 El servidor DNS que acabeu de muntar, es autoritatiu? Per qu\u00e8? Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DNS 2 punts Configuraci\u00f3 correcta de la zona DNS 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#practica-31-configuracio-dun-servidor-dns","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tindre el servidor, el client i a m\u00e9s un clon de el client. Tots dins de la mateixa xarxa interna. \u2714 Heu de tindre configurat el servidor DHCP per que assigne adreces IP fixes als dos clients. \u2714 IMPORTANT: A l'clonar la m\u00e0quina client, per poder assignar IPs fixes en el DHCP, necessiten tenir adreces MAC diferents:","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#installacio-de-servidor-dns","text":"Bind \u00e9s l'est\u00e0ndard de facto per a servidors DNS. \u00c9s una eina de programari lliure i es distribueix amb la majoria de plataformes Unix i Linux, on tamb\u00e9 se li coneix amb el sobrenom de named (name daemon). Bind9 \u00e9s la versi\u00f3 recomanada per a usar-se i \u00e9s la que utilitzarem. Per instal\u00b7lar el servidor DNS en Ubuntu Server, farem servir els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar com qualsevol paquet a Ubuntu: sudo apt-get install bind9 bind9utils bind9-doc","title":"Instal\u00b7laci\u00f3 de servidor DNS"},{"location":"section/P3.1/#configuracio-del-servidor","text":"Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar l'aut\u00e8ntica configuraci\u00f3, ubicats en el mateix directori.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P3.1/#configuracio-namedconfoptions","text":"\u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0/24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client/s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat:","title":"Configuraci\u00f3 named.conf.options"},{"location":"section/P3.1/#configuracio-namedconflocal","text":"En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant:","title":"Configuraci\u00f3 named.conf.local"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona","text":"Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client.","title":"Creaci\u00f3 de l'arxiu de zona"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona-pera-a-la-resolucio-inversa","text":"Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat.","title":"Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa"},{"location":"section/P3.1/#comprovacio-de-les-configuracions","text":"Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: m Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat: Atenci\u00f3! \u00c9s molt important que el client estiga configurat per utilitzar com a servidor DNS el que acabem d'instal\u00b7lar i configurar. Per\u00f2, com podem fer aix\u00f2? Cal recordar que el client est\u00e0 configurat per DHCP i que DHCP permetia una completa configuraci\u00f3 de xarxa, a m\u00e9s de la IP. Consulteu al Tema 2 que \"option\" dins de la declaraci\u00f3 de la subnet a fitxer dhcpd.conf ens permet\u00eda enviar-li a el client la IP de servidor DNS.","title":"Comprovaci\u00f3 de les configuracions"},{"location":"section/P3.1/#comprovacio-de-les-resolucions-i-de-les-consultes","text":"Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client","title":"Comprovaci\u00f3 de les resolucions i de les consultes"},{"location":"section/P3.1/#tasques-a-realitzar","text":"Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Tasques a realitzar"},{"location":"section/P3.1/#questions-finals","text":"Questi\u00f3 1 Qu\u00e9 passar\u00e0 si un client d'una xarxa diferent a la teua intenta fer \u00fas del teu DNS d'alguna manera, li funcionar\u00e0? Per qu\u00e9, en quina part de la configuraci\u00f3 es pot vore? Questi\u00f3 2 Per qu\u00e8 hem de permetre les consultes recursives en la configuraci\u00f3? Questi\u00f3 3 El servidor DNS que acabeu de muntar, es autoritatiu? Per qu\u00e8?","title":"Questions finals"},{"location":"section/P3.1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor DNS 2 punts Configuraci\u00f3 correcta de la zona DNS 3 punts Evid\u00e8ncies de les comprovacions del correcte funcionament 2 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.2/","text":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3 Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tenir un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau tindr\u00e0 una interf\u00edcie a la nostra xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Aquesta interf\u00edcie, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tindre configurat en netplan que reba la IP per DHCP \u2714 Heu de tenir configurat el servidor DHCP perqu\u00e8 assigni una direcci\u00f3n IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els servicis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La interf\u00edcie de la xarxa interna estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original Nota important Si despr\u00e9s de configurar-ho tot en la pr\u00e0ctica, no ixen els resultats que deuen, pot passar que s'hagi quedat informaci\u00f3 guardada en la cach\u00e9 del client o del server. Per esborrar-les en el client: sudo systemd-resolve --flush-caches I en el servidor: sudo rndc flush sudo rndc reload Millora de la configuraci\u00f3 del servidor Pas 1 \u2013 Afegir subdomini autom\u00e0ticament Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: Aix\u00ed hauria de funcionar: Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\". Pas 2 \u2013 Afegir el nostre servidor DNS com a \u00fanic en el client Si us heu fixat en la sortida de dig o de nslookup des del client, quan us diu que servidor DNS ha utilitzat per a la consulta, us posa que ha estat el 127.0.0.53 Aquesta adre\u00e7a \u00e9s l'adre\u00e7a local de la vostra m\u00e0quina client. Aix\u00f2 \u00e9s aix\u00ed perqu\u00e8 systemd, el \u201cnou\u201d sistema de gesti\u00f3 de servicis de Linux, t\u00e9 una esp\u00e8cie de servidor DNS local que \u00e9s el primer que es consulta i si no t\u00e9 la resposta, la reenv\u00eda al servidor DNS que h\u00e0gim configurat. Aix\u00f2 \u00e9s una falla coneguda de systemd i n'hi ha una esp\u00e8cie de \u201carranjament\u201d per solucionar-ho i \u00e9s crear un link simb\u00f2lic: $ sudo rm -f /etc/resolv.conf $ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf I heu de reaplicar la configuraci\u00f3 de xarxa: sudo netplan apply Tasca Feu una nova consulta en dig i comproveu que ara s\u00ed ha utilitzat el servidor que deu, \u00e9s a dir, l'Ubuntu Server que heu configurat vosaltres. Adjunteu captures de pantalla de la configuraci\u00f3 i el resultat. Pas 3 \u2013 Afegir forwarders Tasca Comproveu que si feu una consulta a una adre\u00e7a de domini d'Internet (cisco.com, github.com\u2026), el domini s\u00ed es resol perfectament. Com \u00e9s aix\u00f2 possible si nom\u00e9s hem configurat les zones autoritatives del DNS i cap m\u00e9s? A quins servidors DNS creieu que consulta el nostre Bind? Tasca Descomenta en l'arxiu la secci\u00f3 de forwarders i afegeix les seg\u00fcents adreces. forwarders { 208.67.222.222; //Servidor DNS d'Opendns 1.1.1.1; //Servidor DNS de Cloudflare }; Tasca Fes un dig a una adre\u00e7a d'Internet una vegada m\u00e9s. Qu\u00e8 creus que hem fet afegint aquestes adreces? Tasca Si en l'arxiu \u201cnamed.conf.options\u201d canvieu la l\u00ednia \u201crecursion yes;\u201d per \u201crecursion no;\u201d Segueix funcionant la resoluci\u00f3 de subdominis externs d'Internet (comprova-ho amb dig o nslookup)? I els propis (comprova-ho amb dig i amb el nom de domini complet de les m\u00e0quines .sre.es)? Per qu\u00e8 passa aix\u00f2 si tenim els forwarders configurats? Nota Pot passar que no us funcionen de primeres. En aquest cas, i en el mateix arxiu, proveu a canviar la l\u00ednia: dnssec-validation auto; Per: dnssec-enable yes; dnssec-validation yes; Pas 4 - Afegir arxius de log Hist\u00f2ricament tots els servicis de Linux han tingut el que es coneixen com a arxius de logs. Aquests arxius contenen text i registren tota l'activitat del servici, \u00e9s a dir, tot el que ocorre amb ell. Hui dia aix\u00f2 ho controla systemd i podem veure l'estat i l'activitat del servici amb el comando sudo journalctl -u nom_de el_servici . No obstant aix\u00f2, anem a afegir els nostres propis arxius de logs per fer-ho m\u00e9s accessible i manejable. Per a aix\u00f2, en l'arxiu \u201cnamed.conf\u201d l'indiquem que ha de tenir en compte un nou arxiu de configuraci\u00f3 que crearem despr\u00e9s per especificar com guardar els logs: include \"/etc/bind/named.conf.logging\"; Hem de crear, ara s\u00ed, l'arxiu \u201cnamed.conf.logging\u201d amb el seg\u00fcent contingut: ```yaml hl_lines=\"8 16\"f logging { channel errors_syslog { syslog daemon; severity warning; }; // Per loggear totes les consultes DNS al servidor channel queries_log { file \"/var/log/named/queries.log\" versions 600 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Per loggear tots els errors en realitzar consultes al servidor channel query-errors_log { file \"/var/log/named/query-errors.log\" versions 5 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Definim les categories associades als channels category lame-servers { null; }; category edns-disabled { null; }; category resolver { null; }; category dnssec { errors_syslog; }; category default { errors_syslog; default_debug; }; category unmatched { null; }; category queries { queries_log; }; category query-errors { query-errors_log; }; }; Fixeu-vos en les parts destacades en groc. Li estem indicant que aquests van a ser els arxius de log on es bolcar\u00e0 tota la informaci\u00f3 corresponent. No obstant aix\u00f2, comproveu que aquest directori i aquests fitxers no existeixen. * Creeu aquest directori amb aquests fitxers * Despr\u00e9s de fer-ho, heu de canviar la propietat de l'arxiu a l'usuari \u201cbind\u201d, que \u00e9s el corresponent al servidor DNS: ```shell sudo chown bind.bind nom_de_fitxer ``` Finalment, a la configuraci\u00f3 de Bind cal dir-li que sigui capa\u00e7 de registrar la informaci\u00f3 relativa a les queries o consultes DNS. Per a aix\u00f2 modifiquem l'arxiu d'opcions \u201cnamed.conf.options\u201d i afegim, dins de \u201coptions {...}\u201d la l\u00ednia: ```yaml querylog yes; I reiniciem el servici de bind (named). Tasca Comprova que realitzant ara consultes des del client, queden registrades en aquest arxiu i fes una captura de pantalla. Configuraci\u00f3 del servidor esclau Per configurar el servidor esclau, hem de tenir un clon de nostre servidor i realitzar els mateixos passos per instal\u00b7lar Bind. Aquest servidor esclau ser\u00e0 capa\u00e7 de resoldre les mateixes consultes que el principal, fins i tot ser\u00e0 capa\u00e7 de seguir resolent consultes si el principal deixa de funcionar. Aix\u00ed doncs, despr\u00e9s d'instal\u00b7lar Bind de la mateixa forma que hem fet en el principal, configurem l'arxiu \u201cnamed.conf.options\u201d exactament de la mateixa manera tamb\u00e9. Per indicar-li a l'esclau que zones va a rebre, hem d'indicar-li que les mateixes que el mestre per\u00f2 en manera esclava. Quedaria aix\u00ed: En la configuraci\u00f3 posa que es guardaran les zones transferides en el directori \u201cesclaus\u201d dins del directori /etc/bind , aix\u00ed que no oblideu crear aquest directori posat que no existeix. Si vos dona error per q\u00fcesti\u00f3 de permisos, canvieu la ruta per a guardar les zones a /var/cache/bind/nom_de_zona En el servidor DNS mestre, hem de, ara s\u00ed, indicar qu\u00e8 zones i a qui anem a tranferirlas. S'utilitzaran aquestes l\u00ednies de configuraci\u00f3: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Aquestes l\u00ednies teniu dues opcions, posar-les perqu\u00e8 actu\u00efn per a cada zona de forma gen\u00e8rica, en l'arxiu \u201cnamed.conf.options\u201d. O podeu posar-la dins de cada zona en qu\u00e8 vulguem transferir en el \u201cnamed.conf.local\u201d, tenint un major control sobre cadascuna d'elles. En lloc de les X.X.X.X, heu de posar la IP del vostre servidor DNS esclau, que \u00e9s a qui se li van a transferir les zones. Finalment reinicia el servici de Bind del mestre i de l'esclau. Comprovaci\u00f3 de la configuraci\u00f3 Tasca comprovaci\u00f3 1 Usant el comando per monitorizar servicis journalctl -u nom_de_servici -f comprova que es produeix la transfer\u00e8ncia de zona en l'esclau. Hauries de veure alguna cosa com aix\u00f2: Aqu\u00ed podeu veure com es produeixen les transfer\u00e8ncies de la zona de resoluci\u00f3 directa i de la zona de resoluci\u00f3 inversa. Tasca comprovaci\u00f3 2 Comprova que el servidor esclau funciona correctament i resol els noms de dnsserver i cliXubuntu, aix\u00ed com els de Internet. Pots usar qualsevol d'aquests dos comandos: dig nombre.sre.es @X.X.X.X \u2192 IP del servidor esclau nslookup nom X.X.X.X \u2192 IP del servidor esclau Indica en la captura de pantalla on comprovem efectivament que \u00e9s el servidor esclau el que est\u00e0 resolent la consulta. Tasca comprovaci\u00f3 3 Comprova que tot funciona com ha de ser i apaga el servici \u201cnamed\u201d o \u201cbind9\u201d del servidor principal/mestre. El servidor esclau hauria de respondre sense problema a les consultes DNS. Adjunta captures de pantalla dels comandos que utilitzis per fer les consultes DNS i indica en elles on podem veure que \u00e9s el servidor esclau el que est\u00e0 resolent les consultes. Adjunta captura de pantalla dels logs, on es mostra que s'estan rebent consultes (queries). Atenci\u00f3, nota Recorda que perqu\u00e8 els clients usin un servidor DNS en cas de fallada d'un altre, aquesta informaci\u00f3 l'ha d'enviar el servidor DHCP. Aix\u00f2 \u00e9s, el servidor DHCP haur\u00e0 d'enviar-li les adreces IP de tots dos servidors DNS als clients. Questions finals Questi\u00f3 1 De quina altra forma, utilitzant un arxiu de configuraci\u00f3 de Bind9, podem fer que el subdomini \"sre.es\" s'afegisca autom\u00e0ticament als noms de la zona, aconseguint lo mateix que en el Pas 1 ? Questi\u00f3 2 Explica detalladament qu\u00e8 \u00e9s un servidor mestre o principal i qu\u00e8 \u00e9s un esclau o secundari, aix\u00ed com la rel\u00b7laci\u00f3 que tenen. Questi\u00f3 3 Explica per a qu\u00e8 serveixen aquestes l\u00ednies i per qu\u00e8 hem de posarles a l'arxiu de configuraci\u00f3 corresponent: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 4 Com saben els clients qu\u00e8 quan falla el server DNS principal, ha de comen\u00e7ar a utilitzar el secondari? Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta DHCP per a enviar subdomini i comprovaci\u00f3 1 punts Configuraci\u00f3 correcta del servidor DNS com a \u00fanic en el client i comprovaci\u00f3 0,5 punts Configuraci\u00f3 correcta dels forwarders i resposta a les questions 0,5 punts Configuraci\u00f3 correcta dels logs i comprovaci\u00f3 2 punts Configuraci\u00f3 correcta del servidor esclau i totes les comprovacions 3 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3"},{"location":"section/P3.2/#practica-32-configuracio-de-servidor-dns-mestreesclau-i-millora-de-la-configuracio","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 Heu de tenir un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau tindr\u00e0 una interf\u00edcie a la nostra xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Aquesta interf\u00edcie, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tindre configurat en netplan que reba la IP per DHCP \u2714 Heu de tenir configurat el servidor DHCP perqu\u00e8 assigni una direcci\u00f3n IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els servicis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La interf\u00edcie de la xarxa interna estar\u00e0 configurada per a la mateixa xarxa interna que el server original i haur\u00e0 de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original Nota important Si despr\u00e9s de configurar-ho tot en la pr\u00e0ctica, no ixen els resultats que deuen, pot passar que s'hagi quedat informaci\u00f3 guardada en la cach\u00e9 del client o del server. Per esborrar-les en el client: sudo systemd-resolve --flush-caches I en el servidor: sudo rndc flush sudo rndc reload","title":"Pr\u00e0ctica 3.2 - Configuraci\u00f3 de servidor DNS mestre/esclau i millora de la configuraci\u00f3"},{"location":"section/P3.2/#millora-de-la-configuracio-del-servidor","text":"","title":"Millora de la configuraci\u00f3 del servidor"},{"location":"section/P3.2/#pas-1-afegir-subdomini-automaticament","text":"Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: Aix\u00ed hauria de funcionar: Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\".","title":"Pas 1 \u2013 Afegir subdomini autom\u00e0ticament"},{"location":"section/P3.2/#pas-2-afegir-el-nostre-servidor-dns-com-a-unic-en-el-client","text":"Si us heu fixat en la sortida de dig o de nslookup des del client, quan us diu que servidor DNS ha utilitzat per a la consulta, us posa que ha estat el 127.0.0.53 Aquesta adre\u00e7a \u00e9s l'adre\u00e7a local de la vostra m\u00e0quina client. Aix\u00f2 \u00e9s aix\u00ed perqu\u00e8 systemd, el \u201cnou\u201d sistema de gesti\u00f3 de servicis de Linux, t\u00e9 una esp\u00e8cie de servidor DNS local que \u00e9s el primer que es consulta i si no t\u00e9 la resposta, la reenv\u00eda al servidor DNS que h\u00e0gim configurat. Aix\u00f2 \u00e9s una falla coneguda de systemd i n'hi ha una esp\u00e8cie de \u201carranjament\u201d per solucionar-ho i \u00e9s crear un link simb\u00f2lic: $ sudo rm -f /etc/resolv.conf $ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf I heu de reaplicar la configuraci\u00f3 de xarxa: sudo netplan apply Tasca Feu una nova consulta en dig i comproveu que ara s\u00ed ha utilitzat el servidor que deu, \u00e9s a dir, l'Ubuntu Server que heu configurat vosaltres. Adjunteu captures de pantalla de la configuraci\u00f3 i el resultat.","title":"Pas 2 \u2013 Afegir el nostre servidor DNS com a \u00fanic en el client"},{"location":"section/P3.2/#pas-3-afegir-forwarders","text":"Tasca Comproveu que si feu una consulta a una adre\u00e7a de domini d'Internet (cisco.com, github.com\u2026), el domini s\u00ed es resol perfectament. Com \u00e9s aix\u00f2 possible si nom\u00e9s hem configurat les zones autoritatives del DNS i cap m\u00e9s? A quins servidors DNS creieu que consulta el nostre Bind? Tasca Descomenta en l'arxiu la secci\u00f3 de forwarders i afegeix les seg\u00fcents adreces. forwarders { 208.67.222.222; //Servidor DNS d'Opendns 1.1.1.1; //Servidor DNS de Cloudflare }; Tasca Fes un dig a una adre\u00e7a d'Internet una vegada m\u00e9s. Qu\u00e8 creus que hem fet afegint aquestes adreces? Tasca Si en l'arxiu \u201cnamed.conf.options\u201d canvieu la l\u00ednia \u201crecursion yes;\u201d per \u201crecursion no;\u201d Segueix funcionant la resoluci\u00f3 de subdominis externs d'Internet (comprova-ho amb dig o nslookup)? I els propis (comprova-ho amb dig i amb el nom de domini complet de les m\u00e0quines .sre.es)? Per qu\u00e8 passa aix\u00f2 si tenim els forwarders configurats? Nota Pot passar que no us funcionen de primeres. En aquest cas, i en el mateix arxiu, proveu a canviar la l\u00ednia: dnssec-validation auto; Per: dnssec-enable yes; dnssec-validation yes;","title":"Pas 3 \u2013 Afegir forwarders"},{"location":"section/P3.2/#pas-4-afegir-arxius-de-log","text":"Hist\u00f2ricament tots els servicis de Linux han tingut el que es coneixen com a arxius de logs. Aquests arxius contenen text i registren tota l'activitat del servici, \u00e9s a dir, tot el que ocorre amb ell. Hui dia aix\u00f2 ho controla systemd i podem veure l'estat i l'activitat del servici amb el comando sudo journalctl -u nom_de el_servici . No obstant aix\u00f2, anem a afegir els nostres propis arxius de logs per fer-ho m\u00e9s accessible i manejable. Per a aix\u00f2, en l'arxiu \u201cnamed.conf\u201d l'indiquem que ha de tenir en compte un nou arxiu de configuraci\u00f3 que crearem despr\u00e9s per especificar com guardar els logs: include \"/etc/bind/named.conf.logging\"; Hem de crear, ara s\u00ed, l'arxiu \u201cnamed.conf.logging\u201d amb el seg\u00fcent contingut: ```yaml hl_lines=\"8 16\"f logging { channel errors_syslog { syslog daemon; severity warning; }; // Per loggear totes les consultes DNS al servidor channel queries_log { file \"/var/log/named/queries.log\" versions 600 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Per loggear tots els errors en realitzar consultes al servidor channel query-errors_log { file \"/var/log/named/query-errors.log\" versions 5 size 20m; print-time yes; print-category yes; print-severity yes; severity dynamic; }; //Definim les categories associades als channels category lame-servers { null; }; category edns-disabled { null; }; category resolver { null; }; category dnssec { errors_syslog; }; category default { errors_syslog; default_debug; }; category unmatched { null; }; category queries { queries_log; }; category query-errors { query-errors_log; }; }; Fixeu-vos en les parts destacades en groc. Li estem indicant que aquests van a ser els arxius de log on es bolcar\u00e0 tota la informaci\u00f3 corresponent. No obstant aix\u00f2, comproveu que aquest directori i aquests fitxers no existeixen. * Creeu aquest directori amb aquests fitxers * Despr\u00e9s de fer-ho, heu de canviar la propietat de l'arxiu a l'usuari \u201cbind\u201d, que \u00e9s el corresponent al servidor DNS: ```shell sudo chown bind.bind nom_de_fitxer ``` Finalment, a la configuraci\u00f3 de Bind cal dir-li que sigui capa\u00e7 de registrar la informaci\u00f3 relativa a les queries o consultes DNS. Per a aix\u00f2 modifiquem l'arxiu d'opcions \u201cnamed.conf.options\u201d i afegim, dins de \u201coptions {...}\u201d la l\u00ednia: ```yaml querylog yes; I reiniciem el servici de bind (named). Tasca Comprova que realitzant ara consultes des del client, queden registrades en aquest arxiu i fes una captura de pantalla.","title":"Pas 4 - Afegir arxius de log"},{"location":"section/P3.2/#configuracio-del-servidor-esclau","text":"Per configurar el servidor esclau, hem de tenir un clon de nostre servidor i realitzar els mateixos passos per instal\u00b7lar Bind. Aquest servidor esclau ser\u00e0 capa\u00e7 de resoldre les mateixes consultes que el principal, fins i tot ser\u00e0 capa\u00e7 de seguir resolent consultes si el principal deixa de funcionar. Aix\u00ed doncs, despr\u00e9s d'instal\u00b7lar Bind de la mateixa forma que hem fet en el principal, configurem l'arxiu \u201cnamed.conf.options\u201d exactament de la mateixa manera tamb\u00e9. Per indicar-li a l'esclau que zones va a rebre, hem d'indicar-li que les mateixes que el mestre per\u00f2 en manera esclava. Quedaria aix\u00ed: En la configuraci\u00f3 posa que es guardaran les zones transferides en el directori \u201cesclaus\u201d dins del directori /etc/bind , aix\u00ed que no oblideu crear aquest directori posat que no existeix. Si vos dona error per q\u00fcesti\u00f3 de permisos, canvieu la ruta per a guardar les zones a /var/cache/bind/nom_de_zona En el servidor DNS mestre, hem de, ara s\u00ed, indicar qu\u00e8 zones i a qui anem a tranferirlas. S'utilitzaran aquestes l\u00ednies de configuraci\u00f3: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Aquestes l\u00ednies teniu dues opcions, posar-les perqu\u00e8 actu\u00efn per a cada zona de forma gen\u00e8rica, en l'arxiu \u201cnamed.conf.options\u201d. O podeu posar-la dins de cada zona en qu\u00e8 vulguem transferir en el \u201cnamed.conf.local\u201d, tenint un major control sobre cadascuna d'elles. En lloc de les X.X.X.X, heu de posar la IP del vostre servidor DNS esclau, que \u00e9s a qui se li van a transferir les zones. Finalment reinicia el servici de Bind del mestre i de l'esclau.","title":"Configuraci\u00f3 del servidor esclau"},{"location":"section/P3.2/#comprovacio-de-la-configuracio","text":"Tasca comprovaci\u00f3 1 Usant el comando per monitorizar servicis journalctl -u nom_de_servici -f comprova que es produeix la transfer\u00e8ncia de zona en l'esclau. Hauries de veure alguna cosa com aix\u00f2: Aqu\u00ed podeu veure com es produeixen les transfer\u00e8ncies de la zona de resoluci\u00f3 directa i de la zona de resoluci\u00f3 inversa. Tasca comprovaci\u00f3 2 Comprova que el servidor esclau funciona correctament i resol els noms de dnsserver i cliXubuntu, aix\u00ed com els de Internet. Pots usar qualsevol d'aquests dos comandos: dig nombre.sre.es @X.X.X.X \u2192 IP del servidor esclau nslookup nom X.X.X.X \u2192 IP del servidor esclau Indica en la captura de pantalla on comprovem efectivament que \u00e9s el servidor esclau el que est\u00e0 resolent la consulta. Tasca comprovaci\u00f3 3 Comprova que tot funciona com ha de ser i apaga el servici \u201cnamed\u201d o \u201cbind9\u201d del servidor principal/mestre. El servidor esclau hauria de respondre sense problema a les consultes DNS. Adjunta captures de pantalla dels comandos que utilitzis per fer les consultes DNS i indica en elles on podem veure que \u00e9s el servidor esclau el que est\u00e0 resolent les consultes. Adjunta captura de pantalla dels logs, on es mostra que s'estan rebent consultes (queries). Atenci\u00f3, nota Recorda que perqu\u00e8 els clients usin un servidor DNS en cas de fallada d'un altre, aquesta informaci\u00f3 l'ha d'enviar el servidor DHCP. Aix\u00f2 \u00e9s, el servidor DHCP haur\u00e0 d'enviar-li les adreces IP de tots dos servidors DNS als clients.","title":"Comprovaci\u00f3 de la configuraci\u00f3"},{"location":"section/P3.2/#questions-finals","text":"Questi\u00f3 1 De quina altra forma, utilitzant un arxiu de configuraci\u00f3 de Bind9, podem fer que el subdomini \"sre.es\" s'afegisca autom\u00e0ticament als noms de la zona, aconseguint lo mateix que en el Pas 1 ? Questi\u00f3 2 Explica detalladament qu\u00e8 \u00e9s un servidor mestre o principal i qu\u00e8 \u00e9s un esclau o secundari, aix\u00ed com la rel\u00b7laci\u00f3 que tenen. Questi\u00f3 3 Explica per a qu\u00e8 serveixen aquestes l\u00ednies i per qu\u00e8 hem de posarles a l'arxiu de configuraci\u00f3 corresponent: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 4 Com saben els clients qu\u00e8 quan falla el server DNS principal, ha de comen\u00e7ar a utilitzar el secondari?","title":"Questions finals"},{"location":"section/P3.2/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta DHCP per a enviar subdomini i comprovaci\u00f3 1 punts Configuraci\u00f3 correcta del servidor DNS com a \u00fanic en el client i comprovaci\u00f3 0,5 punts Configuraci\u00f3 correcta dels forwarders i resposta a les questions 0,5 punts Configuraci\u00f3 correcta dels logs i comprovaci\u00f3 2 punts Configuraci\u00f3 correcta del servidor esclau i totes les comprovacions 3 punts Questions finals 2 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P3.3/","text":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidors mestre i esclau en diferents xarxes Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 \u00c9s imprescindible que tingueu funcionant correctament totes les pr\u00e0ctiques anteriors \u2714 Comproveu que les pr\u00e0ctiques anteriors funcionen correctament abans de comen\u00e7ar aquesta pr\u00e0ctica. Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor mestre 172.1.X.X Servidor esclau 172.1.X.X Client 1 172.1.X.X Client2 172.1.X.X Escenari En aquesta pr\u00e0ctica anem a muntar, igual que vam fer en l'anterior, un escenari de servidors mestre/esclau. El mestre ser\u00e0 el vostre servidor i l'esclau el servidor d'un altre company. Si transferim les zones des del servidor fins a l'esclau amb aquesta configuraci\u00f3 de xarxa, l'alumne 2 ser\u00e0 capa\u00e7 de fer ping al nostre nom de domini d'alumne 1 (recordeu que, de la pr\u00e0ctica 1, ja es pod\u00eda fer ping per IP). \u00c9s a dir, la m\u00e0quina 171.1.a.2 podria fer ping a clixubuntu.sre.es . Configuraci\u00f3 dels dominis En primer lloc, anem a canviar el nom dels dominis. Canviarem el nom del subdomini a utilitzar de .sre.es. a nom_alumne.es. Aix\u00ed doncs, el meu domini per exemple quedaria com raul.es. . D'aquesta forma, cada alumne tindr\u00e0 un subdomini diferent. Aix\u00f2 implica que haureu de canviar en tots els arxius, en totes les l\u00ednies on aparega, sre.es pel vostre domini: Arxius de configuraci\u00f3 de zones named.conf.local Configuraci\u00f3 DHCP Configuraci\u00f3 del mestre Mireu el diagrama de xarxa o imatge de m\u00e9s amunt. Adoneu-vos que ara el servidor DNS ha d'escoltar per les dues interf\u00edcies: La interf\u00edcie de la xarxa interna \u2192 per resoldre les consultes del client La interf\u00edcie de la LAN \u2192 per poder transferir/rebre les zones Aix\u00f2 implica que haureu de modificar l'arxiu \u201cnamed.conf.options\u201d de forma concorde. Recordem l'arxiu de configuraci\u00f3 \u201cnamed.conf.options\u201d : Llista d'acc\u00e9s per permetre \u00fanicament els hosts que decidim acl confiables{ 172.1.1.0/24; }; options { directory \"/var/cache/bind\"; querylog yes; // If there is a firewall between you and nameservers you want // to talk to, you may need to fix the firewall to allow multiple // ports to talk. See http://www.kb.cert.org/vuls/id/800113 // If your ISP provided one or habiti IP addresses for stable // nameservers, you probably want to usi them as forwarders. // Uncomment the following block, and insert the addresses replacing // the all-0's placeholder. forwarders { 208.67.222.222; 1.1.1.1; }; allow-recursion {confiables;}; allow-transfer { X.X.X.X; }; also-notify { X.X.X.X; }; listen-on port 53 { 172.1.1.1; }; recursion yes; //======================================================================== // If BIND logs error messages about the root key being expired, // you will need to update your keys. See https://www.isc.org/bind-keys //dnssec-validation acte; dnssec-enable yes; dnssec-validation yes; //llistin-on-v6 { none; }; }; Recordem qu\u00e8 fa cada opci\u00f3: allow-recursion \u2192 de qui es permeten les consultes recursives en aquest servidor DNS allow-transfer \u2192 cap a qui es permet transfer\u00e8ncia de zones also-notify \u2192 cap a qui s'envia un av\u00eds o notificaci\u00f3 quan el mestre recarrega els seus arxius de zona listen-on port 53 \u2192 la IP de la interf\u00edcie on el servidor escolta consultes DNS recursion yes; \u2192 es permeten les consultes recursives, amb allow-recursion li indiquem de qui exactament, utilitzant la ACL (llista d'acc\u00e9s) confiables. Nota En la pr\u00e0ctica anterior vos vaig dir que les l\u00ednies allow-transfer i also-notify les pod\u00edeu tenir en \u201cnamed.conf.options\u201d o dins de cada zona en \u201cnamed.conf.local\u201d. Poseu-les nom\u00e9s en un dels dos llocs perqu\u00e8 si les teniu en els dos llocs i no estan iguals, podeu tenir problemes. Aix\u00ed les coses, hem de configurar el servidor mestre de tal forma que consideri al servidor esclau com confiable, que permita les consultes recursivas dels confiables, que permeti les transfer\u00e8ncies de zona cap a la IP de l'esclau, que tamb\u00e9 li notifiqui i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna i la de la LAN). Recordeu a l'hora de posar les IPs corresponents, mirant una vegada m\u00e9s el diagrama de xarxa, que ara les zones es transfereixen per la LAN. Configuraci\u00f3 de l'esclau En l'esclau tamb\u00e9 s'han de canviar els mateixos arxius per posar-li el nou domini (recordeu que cada alumne tindr\u00e0 un subdomini amb el seu nom). Hem de configurar el servidor esclau de tal forma que consideri al servidor mestre com confiable, que permita les consultes recursivas, i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna per als clients i la de la LAN per al mestre). Recordeu de la pr\u00e0ctica 3.2 com es configuraven les zones en \u201cnamed.conf.local\u201d, depenent de si era mestre o esclau el servidor. Comprovaci\u00f3 Comproveu amb \u201cjournalctl -u named -f\u201d que es produeixen les transfer\u00e8ncies de zona. Si tot ha anat b\u00e9, podr\u00e9 resoldre (amb nslookup) i fer ping als meus noms de domini (dnsserver i cliXubuntu) i als de l'esclau (dnsserver.nomalumno.es i cliXubuntu.nom_alumne.es). Recordeu que per resoldre els subdominis de l'esclau haig d'afegir-li el subdomini ja que \u00e9s un de diferent al meu i en el DHCP nom\u00e9s li estic enviant el meu. Configuraci\u00f3 servidor mestre/esclau Ara haureu de configurar tots dos servidors perqu\u00e8 siguin mestre/esclau. Ser\u00e0 mestre de les zones del vostre subdomini (raul.es. en el meu cas) i esclau de les del vostre company (nombrealumne.es.). Aix\u00f2 vol dir que l'arxiu \u201cnamed.conf.local\u201d tindr\u00e0 zones de tipus mestre i esclau. Una vegada configurat, comproveu que tots dos des dels vostres clients podeu resoldre els noms de domini del company (recordeu afegir el subdomini del company en els noms de les consultes). Questions finals Continuant amb l'escenari d'esta pr\u00e0ctica, imagineu que ara tamb\u00e9 activem el servidor clon. Aix\u00ed doncs, el servidor principal estar\u00e1 conectar per la interfaz de la seua xarxa interna al seu client i al servidor clon. I per la interfaz de la seua interfaz LAN, al servidor del vostre company. Ara volem que el servidor del company transferisca les seues zones al nostre servidor principal (\u00e9s lo que acabem de fer en esta pr\u00e0ctica) i, a m\u00e9s, al nostre servidor clon, dins de la xarxa interna. Questi\u00f3 1 En el servidor del company, indica quina IP haurem de posar dins del named.conf.options en les directives: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 2 Explica qu\u00e9 haurem de configurar dins el arxiu named.conf.local del clon i quina IP haurem de color dins de la directiva masters{...} Questi\u00f3 3 Recordem que el nostre server DNS principal/original \u00e9s esclau del servidor DNS del company. El nostre server clon tamb\u00e9 ho ser\u00e0 ara, tras configurar-lo adequadament. Si volem poder resoldre direccions del domini del nostre company quan el nostre servidor principal no estiga funcionant, com s'ho farem saber als clients de la nostra xarxa interna? Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta de la part del mestre/principal 1,5 punt Configuraci\u00f3 correcta de la part de l'esclau/secundari 1,5 punt Comprovaci\u00f3 de la transfer\u00e8ncia de zones i resolucions DNS correctes 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 1 punt","title":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidor DNS mestre i esclau en diferents xarxes"},{"location":"section/P3.3/#practica-33-configuracio-de-servidors-mestre-i-esclau-en-diferents-xarxes","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! \u2714 \u00c9s imprescindible que tingueu funcionant correctament totes les pr\u00e0ctiques anteriors \u2714 Comproveu que les pr\u00e0ctiques anteriors funcionen correctament abans de comen\u00e7ar aquesta pr\u00e0ctica. Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor mestre 172.1.X.X Servidor esclau 172.1.X.X Client 1 172.1.X.X Client2 172.1.X.X","title":"Pr\u00e0ctica 3.3 - Configuraci\u00f3 de servidors mestre i esclau en diferents xarxes"},{"location":"section/P3.3/#escenari","text":"En aquesta pr\u00e0ctica anem a muntar, igual que vam fer en l'anterior, un escenari de servidors mestre/esclau. El mestre ser\u00e0 el vostre servidor i l'esclau el servidor d'un altre company. Si transferim les zones des del servidor fins a l'esclau amb aquesta configuraci\u00f3 de xarxa, l'alumne 2 ser\u00e0 capa\u00e7 de fer ping al nostre nom de domini d'alumne 1 (recordeu que, de la pr\u00e0ctica 1, ja es pod\u00eda fer ping per IP). \u00c9s a dir, la m\u00e0quina 171.1.a.2 podria fer ping a clixubuntu.sre.es .","title":"Escenari"},{"location":"section/P3.3/#configuracio-dels-dominis","text":"En primer lloc, anem a canviar el nom dels dominis. Canviarem el nom del subdomini a utilitzar de .sre.es. a nom_alumne.es. Aix\u00ed doncs, el meu domini per exemple quedaria com raul.es. . D'aquesta forma, cada alumne tindr\u00e0 un subdomini diferent. Aix\u00f2 implica que haureu de canviar en tots els arxius, en totes les l\u00ednies on aparega, sre.es pel vostre domini: Arxius de configuraci\u00f3 de zones named.conf.local Configuraci\u00f3 DHCP","title":"Configuraci\u00f3 dels dominis"},{"location":"section/P3.3/#configuracio-del-mestre","text":"Mireu el diagrama de xarxa o imatge de m\u00e9s amunt. Adoneu-vos que ara el servidor DNS ha d'escoltar per les dues interf\u00edcies: La interf\u00edcie de la xarxa interna \u2192 per resoldre les consultes del client La interf\u00edcie de la LAN \u2192 per poder transferir/rebre les zones Aix\u00f2 implica que haureu de modificar l'arxiu \u201cnamed.conf.options\u201d de forma concorde. Recordem l'arxiu de configuraci\u00f3 \u201cnamed.conf.options\u201d : Llista d'acc\u00e9s per permetre \u00fanicament els hosts que decidim acl confiables{ 172.1.1.0/24; }; options { directory \"/var/cache/bind\"; querylog yes; // If there is a firewall between you and nameservers you want // to talk to, you may need to fix the firewall to allow multiple // ports to talk. See http://www.kb.cert.org/vuls/id/800113 // If your ISP provided one or habiti IP addresses for stable // nameservers, you probably want to usi them as forwarders. // Uncomment the following block, and insert the addresses replacing // the all-0's placeholder. forwarders { 208.67.222.222; 1.1.1.1; }; allow-recursion {confiables;}; allow-transfer { X.X.X.X; }; also-notify { X.X.X.X; }; listen-on port 53 { 172.1.1.1; }; recursion yes; //======================================================================== // If BIND logs error messages about the root key being expired, // you will need to update your keys. See https://www.isc.org/bind-keys //dnssec-validation acte; dnssec-enable yes; dnssec-validation yes; //llistin-on-v6 { none; }; }; Recordem qu\u00e8 fa cada opci\u00f3: allow-recursion \u2192 de qui es permeten les consultes recursives en aquest servidor DNS allow-transfer \u2192 cap a qui es permet transfer\u00e8ncia de zones also-notify \u2192 cap a qui s'envia un av\u00eds o notificaci\u00f3 quan el mestre recarrega els seus arxius de zona listen-on port 53 \u2192 la IP de la interf\u00edcie on el servidor escolta consultes DNS recursion yes; \u2192 es permeten les consultes recursives, amb allow-recursion li indiquem de qui exactament, utilitzant la ACL (llista d'acc\u00e9s) confiables. Nota En la pr\u00e0ctica anterior vos vaig dir que les l\u00ednies allow-transfer i also-notify les pod\u00edeu tenir en \u201cnamed.conf.options\u201d o dins de cada zona en \u201cnamed.conf.local\u201d. Poseu-les nom\u00e9s en un dels dos llocs perqu\u00e8 si les teniu en els dos llocs i no estan iguals, podeu tenir problemes. Aix\u00ed les coses, hem de configurar el servidor mestre de tal forma que consideri al servidor esclau com confiable, que permita les consultes recursivas dels confiables, que permeti les transfer\u00e8ncies de zona cap a la IP de l'esclau, que tamb\u00e9 li notifiqui i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna i la de la LAN). Recordeu a l'hora de posar les IPs corresponents, mirant una vegada m\u00e9s el diagrama de xarxa, que ara les zones es transfereixen per la LAN.","title":"Configuraci\u00f3 del mestre"},{"location":"section/P3.3/#configuracio-de-lesclau","text":"En l'esclau tamb\u00e9 s'han de canviar els mateixos arxius per posar-li el nou domini (recordeu que cada alumne tindr\u00e0 un subdomini amb el seu nom). Hem de configurar el servidor esclau de tal forma que consideri al servidor mestre com confiable, que permita les consultes recursivas, i a m\u00e9s, ha d'escoltar consultes DNS en totes les IP de les seves interf\u00edcies (la de la xarxa interna per als clients i la de la LAN per al mestre). Recordeu de la pr\u00e0ctica 3.2 com es configuraven les zones en \u201cnamed.conf.local\u201d, depenent de si era mestre o esclau el servidor.","title":"Configuraci\u00f3 de l'esclau"},{"location":"section/P3.3/#comprovacio","text":"Comproveu amb \u201cjournalctl -u named -f\u201d que es produeixen les transfer\u00e8ncies de zona. Si tot ha anat b\u00e9, podr\u00e9 resoldre (amb nslookup) i fer ping als meus noms de domini (dnsserver i cliXubuntu) i als de l'esclau (dnsserver.nomalumno.es i cliXubuntu.nom_alumne.es). Recordeu que per resoldre els subdominis de l'esclau haig d'afegir-li el subdomini ja que \u00e9s un de diferent al meu i en el DHCP nom\u00e9s li estic enviant el meu.","title":"Comprovaci\u00f3"},{"location":"section/P3.3/#configuracio-servidor-mestreesclau","text":"Ara haureu de configurar tots dos servidors perqu\u00e8 siguin mestre/esclau. Ser\u00e0 mestre de les zones del vostre subdomini (raul.es. en el meu cas) i esclau de les del vostre company (nombrealumne.es.). Aix\u00f2 vol dir que l'arxiu \u201cnamed.conf.local\u201d tindr\u00e0 zones de tipus mestre i esclau. Una vegada configurat, comproveu que tots dos des dels vostres clients podeu resoldre els noms de domini del company (recordeu afegir el subdomini del company en els noms de les consultes).","title":"Configuraci\u00f3 servidor mestre/esclau"},{"location":"section/P3.3/#questions-finals","text":"Continuant amb l'escenari d'esta pr\u00e0ctica, imagineu que ara tamb\u00e9 activem el servidor clon. Aix\u00ed doncs, el servidor principal estar\u00e1 conectar per la interfaz de la seua xarxa interna al seu client i al servidor clon. I per la interfaz de la seua interfaz LAN, al servidor del vostre company. Ara volem que el servidor del company transferisca les seues zones al nostre servidor principal (\u00e9s lo que acabem de fer en esta pr\u00e0ctica) i, a m\u00e9s, al nostre servidor clon, dins de la xarxa interna. Questi\u00f3 1 En el servidor del company, indica quina IP haurem de posar dins del named.conf.options en les directives: allow-transfer { X.X.X.X }; also-notify { X.X.X.X; }; Questi\u00f3 2 Explica qu\u00e9 haurem de configurar dins el arxiu named.conf.local del clon i quina IP haurem de color dins de la directiva masters{...} Questi\u00f3 3 Recordem que el nostre server DNS principal/original \u00e9s esclau del servidor DNS del company. El nostre server clon tamb\u00e9 ho ser\u00e0 ara, tras configurar-lo adequadament. Si volem poder resoldre direccions del domini del nostre company quan el nostre servidor principal no estiga funcionant, com s'ho farem saber als clients de la nostra xarxa interna?","title":"Questions finals"},{"location":"section/P3.3/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta de la part del mestre/principal 1,5 punt Configuraci\u00f3 correcta de la part de l'esclau/secundari 1,5 punt Comprovaci\u00f3 de la transfer\u00e8ncia de zones i resolucions DNS correctes 2 punts Questions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 1 punt","title":"Avaluaci\u00f3"},{"location":"section/P4.1/","text":"Pr\u00e0ctica 4.1 \u2013 Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor web NGINX Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! Heu de tenir funcionant sense errors el vostre servidor DNS. \u00c9s a dir, almenys la pr\u00e0ctica 3.1 ha de funcionar sense problemes. Comproveu-ho abans de comen\u00e7ar aquesta pr\u00e0ctica Instal\u00b7laci\u00f3 servidor web NGINX Per instal\u00b7lar el servidor nginx en el Ubuntu Server, primer actualitzem els repositoris i despr\u00e9s instal\u00b7lem el paquet corresponent: sudo apt update sudo apt install nginx Comprovem que nginx s'ha instal\u00b7lat i que est\u00e0 funcionant correctament: systemctl status nginx Creaci\u00f3 de les carpetes del lloc web Igual que ocorre en Apache, tots els arxius que formaran part d'un lloc web que servir\u00e0 nginx s'organitzaran en carpetes. Aquestes carpetes, t\u00edpicament estan dins de /var/www . Aix\u00ed doncs, crearem la carpeta de nostre lloc web o domini: sudo mkdir -p /var/www/vostre_domini/html On el nom de domini ser\u00e0 el nom del jugador que tinga el mateix n\u00famero que el vostre ordinador, de la seg\u00fcent plantilla: Com saber el meu nom de domini Exemple Si el meu ordinador \u00e9s el 12, el meu nom de domini ser\u00e0 unai-lopez , i si \u00e9s el 4, el domini ser\u00e0 msuarez (sense punts). Recordeu, no heu de posar punts ni espais en el nom de domini. Ac\u00ed, dins d'aquesta carpeta html, heu de descomprimir un dels zip amb tots els arxius per al lloc web d'exemple que us he proporcionat. Nota NO \u00e9s el mateix el vostre domini de zona de DNS, que el vostre domini per al vostre lloc web (b\u00e0sicament el nom que posem en la URL). Per descomprimir, instal\u00b7leu-vos el paquet unzip: apt get install unzip I per descomprimir en un directori concret els arxius: unzip nom_arxiu.zip -d nom_directori A m\u00e9s, farem que el propietari d'aquesta carpeta i tot el que hi hagi dins sigui l'usuari www-data , t\u00edpicament l'usuari del servici web. sudo chown -R www-data:www-data /var/www/vostre_domini/html I li donarem els permisos adequats perqu\u00e8 no ens de un error d'acc\u00e9s no autoritzat en entrar en el lloc web: sudo chmod -R 755 /var/www/vostre_domini Per comprovar que el servidor est\u00e0 funcionant i servint p\u00e0gines correctament, podeu accedir des del vostre client a: http://ip_vostre_servidor I us haur\u00e0 d'apar\u00e8ixer alguna cosa aix\u00ed: El que demostra que tot \u00e9s correcte fins ara. Configuraci\u00f3 de servidor web NGINX En Nginx hi ha dues rutes importants. La primera d'elles \u00e9s sites-available , que cont\u00e9 els arxius de configuraci\u00f3 dels hosts virtuals o blocs disponibles en el servidor. \u00c9s a dir, cadascun dels llocs webs que alberga el servit. L'altra \u00e9s sites-enabled , que cont\u00e9 els arxius de configuraci\u00f3 dels llocs habilitats, \u00e9s a dir, els que funcionen en aquest moment. Dins de sites-available hi ha un arxiu de configuraci\u00f3 per defecte (default), que \u00e9s la p\u00e0gina que es mostra si accedim al servidor sense indicar cap lloc web o quan el lloc web no \u00e9s trobat en el servidor (a causa d'una mala configuraci\u00f3 per exemple). Aquesta \u00e9s la p\u00e0gina que ens ha aparegut en l'apartat anterior. Per a que Nginx presente el contingut de la nostra web, \u00e9s necessari crear un bloc de servidor amb les directives correctes. En comptes de modificar l'arxiu de configuraci\u00f3 predeterminat directament, crearem un de nou en \"/etc/nginx/sites-available/ vostre_domini \": sudo nano /etc/nginx/sites-available/vostre_domini I el contingut d'aquest arxiu de configuraci\u00f3: server { listen 80; listen [::]:80; root /ruta/absoluta/arxiu/index; index index.html index.htm index.nginx-debian.html; server_name vostre_domini www.vostre_domini; location / { try_files $uri $uri/ =404; } } Ac\u00ed la directiva root ha d'anar seguida de la ruta absoluta absoluta on es trobi l'arxiu index.html de la nostra p\u00e0gina web, que es troba entre tots els que heu descomprimit. Ac\u00ed teniu un exemple de un lloc webs amb la seva ruta (directoris que hi ha) abans de l'arxiu index.html: Info Ruta \u2192 /var/www/exemple2/html/2016_soft_landing I crearem un arxiu simb\u00f2lic entre aquest arxiu i el de llocs que estan habilitats, perqu\u00e8 es doni d'alta autom\u00e0ticament. sudo ln -s /etc/nginx/sites-available/vostre_domain /etc/nginx/sites-enabled/ Configuraci\u00f3 del DNS Per a poder accedir a vostre lloc web, necessitareu afegir una entrada en l'arxiu de zona del vostre DNS. Necessiteu afegir un parell de registres del tipus CNAME, de tal forma que els dominis o noms de la vostra p\u00e0gina web ( vostre_domini i www.vostre_domini ), en realitat apuntin a dnsserver. vostre_nom .es. (recordeu que en l'\u00faltima pr\u00e0ctica del Tema 3 vau canviar el domini sre.es. Per vostre_nom.es.) Per a configurar un CNAME podeu buscar informaci\u00f3 de com fer-ho en algun d'aquests llocs: Lloc 1 Lloc 2 Lloc 3 I reiniciem el servidor per aplicar la configuraci\u00f3: sudo systemctl restart nginx Comprovacions Comprovaci\u00f3 de funcionament correcte Si tot ha anat b\u00e9, heu de poder accedir a vostre lloc web escrivint en la caixa de la URL del navegador: http://vostre_domini http://www.vostre_domini Comprovar registres del servidor Comproveu que les peticions s'estan registrant correctament en els arxius de logs, tant les correctes com les err\u00f2nies: /var/log/nginx/access.log : cada sol\u00b7licitud al seu servidor web es registra en aquest arxiu de registre, de no ser que Nginx estiga configurat per fer alguna cosa diferent. /var/log/nginx/error.log : qualsevol error de Nginx s'assentar\u00e0 en aquest registre. Tasca a realitzar Si volem tenir diversos dominis o llocs web en el mateix servidor nginx (\u00e9s a dir, que tindran la mateixa IP) hem de repetir tot el proc\u00e9s anterior amb el nou nom de domini. Configura un nou domini per a l'exemple de lloc web de l'altre .zip i documenta el proc\u00e9s. El nou nom de domini ser\u00e0 el cognom del jugador que tinga el dorsal amb el mateix n\u00famero que el vostre n\u00famero d'ordinador, de la seg\u00fcent plantilla: St. Pauli Q\u00fcestions finals Questi\u00f3 1 De quina altra forma alternativa podr\u00eda resoldre el nom del meu domini web amb el servici DNS sense fer \u00fas del register CNAME? Questi\u00f3 2 Qu\u00e8 passa si no faig el link simb\u00f2lic entre sites-available i sites-enabled del meu lloc web? Questi\u00f3 3 Qu\u00e9 passa si no li done els permisos adeq\u00fcats a /var/www/vostre_domini ? Questi\u00f3 4 Podeu accedir desde la LAN (el vostre Lliurex) a la vostra web? Tant si es afirmatiu com negatiu, explica el motiu. Questi\u00f3 5 Si no ficarem cap entrada DNS a l'arxiu de zona, podrieu accedir encara a les vostres webs? Tant si es afirmatiu com negatiu, explica el motiu. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor web 1 punts Configuraci\u00f3 correcta del DNS 2 punts Comprovaci\u00f3 del correcte funcionament 1 punts Configuraci\u00f3 correcta i comprovaci\u00f3 del funcionament de una segona web 2 punts Q\u00fcestions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 0,5 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0,5 punt","title":"Pr\u00e0ctica 4.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor web NGINX"},{"location":"section/P4.1/#practica-41-installacio-i-configuracio-de-servidor-web-nginx","text":"","title":"Pr\u00e0ctica 4.1 \u2013 Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor web NGINX"},{"location":"section/P4.1/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! Heu de tenir funcionant sense errors el vostre servidor DNS. \u00c9s a dir, almenys la pr\u00e0ctica 3.1 ha de funcionar sense problemes. Comproveu-ho abans de comen\u00e7ar aquesta pr\u00e0ctica","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P4.1/#installacio-servidor-web-nginx","text":"Per instal\u00b7lar el servidor nginx en el Ubuntu Server, primer actualitzem els repositoris i despr\u00e9s instal\u00b7lem el paquet corresponent: sudo apt update sudo apt install nginx Comprovem que nginx s'ha instal\u00b7lat i que est\u00e0 funcionant correctament: systemctl status nginx","title":"Instal\u00b7laci\u00f3 servidor web NGINX"},{"location":"section/P4.1/#creacio-de-les-carpetes-del-lloc-web","text":"Igual que ocorre en Apache, tots els arxius que formaran part d'un lloc web que servir\u00e0 nginx s'organitzaran en carpetes. Aquestes carpetes, t\u00edpicament estan dins de /var/www . Aix\u00ed doncs, crearem la carpeta de nostre lloc web o domini: sudo mkdir -p /var/www/vostre_domini/html On el nom de domini ser\u00e0 el nom del jugador que tinga el mateix n\u00famero que el vostre ordinador, de la seg\u00fcent plantilla: Com saber el meu nom de domini Exemple Si el meu ordinador \u00e9s el 12, el meu nom de domini ser\u00e0 unai-lopez , i si \u00e9s el 4, el domini ser\u00e0 msuarez (sense punts). Recordeu, no heu de posar punts ni espais en el nom de domini. Ac\u00ed, dins d'aquesta carpeta html, heu de descomprimir un dels zip amb tots els arxius per al lloc web d'exemple que us he proporcionat. Nota NO \u00e9s el mateix el vostre domini de zona de DNS, que el vostre domini per al vostre lloc web (b\u00e0sicament el nom que posem en la URL). Per descomprimir, instal\u00b7leu-vos el paquet unzip: apt get install unzip I per descomprimir en un directori concret els arxius: unzip nom_arxiu.zip -d nom_directori A m\u00e9s, farem que el propietari d'aquesta carpeta i tot el que hi hagi dins sigui l'usuari www-data , t\u00edpicament l'usuari del servici web. sudo chown -R www-data:www-data /var/www/vostre_domini/html I li donarem els permisos adequats perqu\u00e8 no ens de un error d'acc\u00e9s no autoritzat en entrar en el lloc web: sudo chmod -R 755 /var/www/vostre_domini Per comprovar que el servidor est\u00e0 funcionant i servint p\u00e0gines correctament, podeu accedir des del vostre client a: http://ip_vostre_servidor I us haur\u00e0 d'apar\u00e8ixer alguna cosa aix\u00ed: El que demostra que tot \u00e9s correcte fins ara.","title":"Creaci\u00f3 de les carpetes del lloc web"},{"location":"section/P4.1/#configuracio-de-servidor-web-nginx","text":"En Nginx hi ha dues rutes importants. La primera d'elles \u00e9s sites-available , que cont\u00e9 els arxius de configuraci\u00f3 dels hosts virtuals o blocs disponibles en el servidor. \u00c9s a dir, cadascun dels llocs webs que alberga el servit. L'altra \u00e9s sites-enabled , que cont\u00e9 els arxius de configuraci\u00f3 dels llocs habilitats, \u00e9s a dir, els que funcionen en aquest moment. Dins de sites-available hi ha un arxiu de configuraci\u00f3 per defecte (default), que \u00e9s la p\u00e0gina que es mostra si accedim al servidor sense indicar cap lloc web o quan el lloc web no \u00e9s trobat en el servidor (a causa d'una mala configuraci\u00f3 per exemple). Aquesta \u00e9s la p\u00e0gina que ens ha aparegut en l'apartat anterior. Per a que Nginx presente el contingut de la nostra web, \u00e9s necessari crear un bloc de servidor amb les directives correctes. En comptes de modificar l'arxiu de configuraci\u00f3 predeterminat directament, crearem un de nou en \"/etc/nginx/sites-available/ vostre_domini \": sudo nano /etc/nginx/sites-available/vostre_domini I el contingut d'aquest arxiu de configuraci\u00f3: server { listen 80; listen [::]:80; root /ruta/absoluta/arxiu/index; index index.html index.htm index.nginx-debian.html; server_name vostre_domini www.vostre_domini; location / { try_files $uri $uri/ =404; } } Ac\u00ed la directiva root ha d'anar seguida de la ruta absoluta absoluta on es trobi l'arxiu index.html de la nostra p\u00e0gina web, que es troba entre tots els que heu descomprimit. Ac\u00ed teniu un exemple de un lloc webs amb la seva ruta (directoris que hi ha) abans de l'arxiu index.html: Info Ruta \u2192 /var/www/exemple2/html/2016_soft_landing I crearem un arxiu simb\u00f2lic entre aquest arxiu i el de llocs que estan habilitats, perqu\u00e8 es doni d'alta autom\u00e0ticament. sudo ln -s /etc/nginx/sites-available/vostre_domain /etc/nginx/sites-enabled/","title":"Configuraci\u00f3 de servidor web NGINX"},{"location":"section/P4.1/#configuracio-del-dns","text":"Per a poder accedir a vostre lloc web, necessitareu afegir una entrada en l'arxiu de zona del vostre DNS. Necessiteu afegir un parell de registres del tipus CNAME, de tal forma que els dominis o noms de la vostra p\u00e0gina web ( vostre_domini i www.vostre_domini ), en realitat apuntin a dnsserver. vostre_nom .es. (recordeu que en l'\u00faltima pr\u00e0ctica del Tema 3 vau canviar el domini sre.es. Per vostre_nom.es.) Per a configurar un CNAME podeu buscar informaci\u00f3 de com fer-ho en algun d'aquests llocs: Lloc 1 Lloc 2 Lloc 3 I reiniciem el servidor per aplicar la configuraci\u00f3: sudo systemctl restart nginx","title":"Configuraci\u00f3 del DNS"},{"location":"section/P4.1/#comprovacions","text":"","title":"Comprovacions"},{"location":"section/P4.1/#comprovacio-de-funcionament-correcte","text":"Si tot ha anat b\u00e9, heu de poder accedir a vostre lloc web escrivint en la caixa de la URL del navegador: http://vostre_domini http://www.vostre_domini","title":"Comprovaci\u00f3 de funcionament correcte"},{"location":"section/P4.1/#comprovar-registres-del-servidor","text":"Comproveu que les peticions s'estan registrant correctament en els arxius de logs, tant les correctes com les err\u00f2nies: /var/log/nginx/access.log : cada sol\u00b7licitud al seu servidor web es registra en aquest arxiu de registre, de no ser que Nginx estiga configurat per fer alguna cosa diferent. /var/log/nginx/error.log : qualsevol error de Nginx s'assentar\u00e0 en aquest registre.","title":"Comprovar registres del servidor"},{"location":"section/P4.1/#tasca-a-realitzar","text":"Si volem tenir diversos dominis o llocs web en el mateix servidor nginx (\u00e9s a dir, que tindran la mateixa IP) hem de repetir tot el proc\u00e9s anterior amb el nou nom de domini. Configura un nou domini per a l'exemple de lloc web de l'altre .zip i documenta el proc\u00e9s. El nou nom de domini ser\u00e0 el cognom del jugador que tinga el dorsal amb el mateix n\u00famero que el vostre n\u00famero d'ordinador, de la seg\u00fcent plantilla: St. Pauli","title":"Tasca a realitzar"},{"location":"section/P4.1/#questions-finals","text":"Questi\u00f3 1 De quina altra forma alternativa podr\u00eda resoldre el nom del meu domini web amb el servici DNS sense fer \u00fas del register CNAME? Questi\u00f3 2 Qu\u00e8 passa si no faig el link simb\u00f2lic entre sites-available i sites-enabled del meu lloc web? Questi\u00f3 3 Qu\u00e9 passa si no li done els permisos adeq\u00fcats a /var/www/vostre_domini ? Questi\u00f3 4 Podeu accedir desde la LAN (el vostre Lliurex) a la vostra web? Tant si es afirmatiu com negatiu, explica el motiu. Questi\u00f3 5 Si no ficarem cap entrada DNS a l'arxiu de zona, podrieu accedir encara a les vostres webs? Tant si es afirmatiu com negatiu, explica el motiu.","title":"Q\u00fcestions finals"},{"location":"section/P4.1/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta del servidor web 1 punts Configuraci\u00f3 correcta del DNS 2 punts Comprovaci\u00f3 del correcte funcionament 1 punts Configuraci\u00f3 correcta i comprovaci\u00f3 del funcionament de una segona web 2 punts Q\u00fcestions finals 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 0,5 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0,5 punt","title":"Avaluaci\u00f3"},{"location":"section/P4.2/","text":"Pr\u00e0ctica 4.2 \u2013 Autenticaci\u00f3 en Nginx Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.1 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.1 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Client 172.1.X.X ... ... Introducci\u00f3 En el context d'una transacci\u00f3 HTTP, l'autenticaci\u00f3 d'acc\u00e9s b\u00e0sica \u00e9s un m\u00e8tode dissenyat per a permetre a un navegador web, o un altre programa client, proveir credencials en la forma d'usuari i contrasenya quan se les sol\u00b7licita una p\u00e0gina al servidor. L'autenticaci\u00f3 b\u00e0sica, com el seu nom ho indica, \u00e9s la forma m\u00e9s b\u00e0sica d'autenticaci\u00f3 disponible per a les aplicacions Web. Va ser definida per primera vegada en l'especificaci\u00f3 HTTP en si i no \u00e9s de cap manera elegant, per\u00f2 compleix la seua funci\u00f3. Aquest tipus d'autenticaci\u00f3 \u00e9s el tipus m\u00e9s simple disponible per\u00f2 emmalalteix d'importants problemes de seguretat que no la fan recomanable en moltes situacions. No requereix l'\u00fas ni de cookies, ni d'identificadors de sessi\u00f3, ni de p\u00e0gina d'ingr\u00e9s. Paquets necessaris Per a aquesta pr\u00e0ctica podem utilitzar l'eina openssl per crear les contrasenyes. En primer lloc hem de comprovar si el paquet est\u00e0 instal\u00b7lat: dpkg -l | grep openssl I si no ho estigu\u00e9s, instal\u00b7lar-lo. Creaci\u00f3 d'usuaris i contrasenyes per a l'acc\u00e9s web Crearem un arxiu ocult anomenat .htpasswd en el directori de configuraci\u00f3 /etc/nginx on guardar els nostres usuaris i contrasenyes (la -c \u00e9s per crear l'arxiu): sudo sh -c \"echo -n 'teu_nom:' >> /etc/nginx/.htpasswd\" Ara crearem un password xifrat per a l'usuari: sudo sh -c \"openssl passwd -apr1 >> /etc/nginx/.htpasswd\" Aquest proc\u00e9s es podr\u00e0 repetir per a tants usuaris com calgui. Crea dos usuaris, un amb el teu nom i un altre amb el teu primer cognom. Comprova que l'usuari i la contrasenya apareixen xifrats en el fitxer: cat /etc/nginx/.htpasswd Configurant el servidor Nginx per usar autenticaci\u00f3 b\u00e0sica Editarem la configuraci\u00f3 del server block sobre el qui volem aplicar la restricci\u00f3 d'acc\u00e9s. Utilitzarem per a aquesta autenticaci\u00f3 el lloc web de John Doe: Info Recorda que un server block \u00e9s cadascun dels dominis (( server {...} dins l'arxiu de configuraci\u00f3)) d'algun dels llocs webs que hi ha en el servidor sudo nano /etc/nginx/sites-enabled/vostre_domini Hem de decidir quins recursos estaran protegits. Nginx permet afegir restriccions a nivell de servidor o en un location (directori o arxiu) espec\u00edfic. Per al nostre exemple, protegirem el document root (l'arrel, la p\u00e0gina principal) del nostre lloc. Utilitzarem la directiva auth_basic dins del location i li posarem el text que ser\u00e0 mostrat a l'usuari en sol\u00b7licitar les credencials. Finalment, configurem Nginx perqu\u00e8 utilitze el fitxer que pr\u00e8viament hem creat amb la directiva auth_basic_user_file : server { listen 80; listen [::]:80; root /var/www/vostre_domini/html/retro-doe; index index.html index.htm index.nginx-debian.html; server_name vostre_domini www.vostre_domini; location / { auth_basic \"\u00c0rea restringida\"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } } Una vegada acabada la configuraci\u00f3, reiniciem el servei perqu\u00e8 apliqui la nostra pol\u00edtica d'acc\u00e9s. sudo systemctl restart nginx Provant la nova configuraci\u00f3 Comprovaci\u00f3 1 Comprova des del teu client Xubuntu que en accedir a http://vostre_domini o http://www.vostre_domini se't sol\u00b7licita una autenticaci\u00f3. Comprovaci\u00f3 2 Comprova que si decideixes cancel\u00b7lar l'autenticaci\u00f3, se't negar\u00e0 l'acc\u00e9s al lloc amb un error. Quin error \u00e9s? Tasques Tasca 1 Intenta entrar primer amb un usuari erroni i despr\u00e9s amb un altre correcte. Pots veure tots els successos i registres en els logs access.log i error.log. Adjunta una captura de pantalla dels logs on es vegi que intentes entrar primer amb un usuari inv\u00e0lid i amb un altre v\u00e0lid. Indica on podem veure els errors d'usuari inv\u00e0lid o no oposat, aix\u00ed com on podem veure el nombre d'error que us apareixia abans. Quan hem configurat el seg\u00fcent bloc: location / { auth_basic \"\u00c0rea restringida\"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } L'autenticaci\u00f3 s'aplica al directori/arxiu que li indiquem, en aquest cas l'arrel / , que \u00e9s: /var/www/exemple1/html/retro-doe/ I a tots els arxius que hi ha dins, ja que no hem especificat cap. Ara b\u00e9, anem a provar a aplicar autenticaci\u00f3 nom\u00e9s a una part de la web. Intentarem que nom\u00e9s es necessite autenticac\u00ed\u00f3 per a entrar a la part de portfolio: Aquesta secci\u00f3 es correspon amb l'arxiu \u201cportofolio.html\u201d dins del directori arrel. Tasca 2 Esborra les dues l\u00ednies que fan refer\u00e8ncia a l'autenticaci\u00f3 b\u00e0sica en el location del directori arrel. Despr\u00e9s d'aix\u00f2, afegeix un nou location sota amb l'autenticaci\u00f3 b\u00e0sica per a l'arxiu portofolio.html. Warning Fixeu-vos que heu d'anar amb compte perqu\u00e8 l'\u00faltima l\u00ednia de l'arxiu ha de ser la } que tanca la primera l\u00ednia server { de l'arxiu. Combinaci\u00f3 de l'Autenticaci\u00f3 B\u00e0sica amb la restricci\u00f3 d'acc\u00e9s per IP L'autenticaci\u00f3 b\u00e0sica HTTP pot ser combinada de forma efectiva amb la restricci\u00f3 d'acc\u00e9s per adre\u00e7a IP. Es poden implementar dos escenaris: Un usuari ha d'estar ambdues coses, autenticat i tenir una IP v\u00e0lida Un usuari deu o b\u00e9 estar autenticat, o b\u00e9 tenir una IP v\u00e0lida Vegem com ho far\u00edem: Com permetre o denegar acc\u00e9s sobre una IP concreta (directives allow i deny , respectivament). Dins del block server o arxiu de configuraci\u00f3 del domini web, que recordeu est\u00e0 en el directori sites-available: L'acc\u00e9s nom\u00e9s es garantir\u00e0 a la IP 192.168.1.1/24 , excloent a l'adre\u00e7a 192.168.1.2 . Cal tenir en compte que les directives allow i deny s'aniran aplicant en l'ordre en el qual apareixen l'arxiu. Ac\u00ed apliquem sobre la location /api (es nom\u00e9s un exemple), per\u00f2 podriem aplicar sobre qualsevol, incl\u00f2s tot el lloc web, la location arrel (/). L'\u00faltima directiva deny all vol dir que per defecte denegarem l'acc\u00e9s a tothom. Per aix\u00f2 cal posar els allow i deny m\u00e9s espec\u00edfics just abans d'aquesta, perqu\u00e8 en avaluar-se en ordre d'aparici\u00f3, si els pos\u00e0rem baix es denegaria l'acc\u00e9s a tothom, ja que deny all seria el primer que s'avaluaria. Combinar la restricci\u00f3 IP i l'autenticaci\u00f3 HTTP amb la directiva satisfy . Si establim el valor de la directiva a all , l'acc\u00e9s es permet si el client satisf\u00e0 ambdues condicions (IP i usuari v\u00e0lid). Si ho establim a any , l'acc\u00e9s es permet si se satisf\u00e0 almenys una de les dues condicions. Tasques Tasca 1 Col\u00b7loca una altra vegada dos clients a la teva xarxa interna i assegura't que la seua configuraci\u00f3 de xarxa \u00e9s correcta Tasca 2 Configura Nginx perqu\u00e8 no deixi accedir amb la IP del client1 al directori arrel de la mateixa web d'abans, la de John Doe\u2019s. Modifica el seu server block o arxiu de configuraci\u00f3. Comprova com es denega l'acc\u00e9s: Mostra la p\u00e0gina d'error en el navegador Mostra el missatge d'error d'error.log Tasca 3 Configura Nginx per a que el client2 hagi de tenir tant una IP v\u00e0lida com un usuari v\u00e0lid, ambdues coses alhora, i comprova que s\u00ed pot accedir sense problemes. Tasca 4 Configura Nginx ara per a que deixe accedir si es t\u00e9 una IP v\u00e0lida o tamb\u00e9 si l'usuari introdu\u00eft \u00e9s correcte. Comprova que ara s\u00ed poden accedir tots dos clients, per qu\u00e8? Q\u00fcestions finals Questi\u00f3 1 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, equivocant-me al posar usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; deny all; auth_basic \"Questi\u00f3 final 1\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 2 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, introdu\u00efnt correctament usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy all; deny all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; auth_basic \"Questi\u00f3 final 2 : The revenge\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 3 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, introdu\u00efnt correctament usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy any; deny 172.1.10.6; deny 172.1.10.15; allow 172.1.3.14; auth_basic \"Questi\u00f3 final 3 : The final combat\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 4 A lo millor no sabeu que tinc una web per a documentar totes les meues excursions a l\u2019espai amb Jeff Bezos, \u00e9s aquesta: Jeff Bezos i jo Suposem que vull restringir l\u2019acc\u00e9s al directori de projectes perqu\u00e8 es molt secret, aix\u00f2 vol dir afegir autenticaci\u00f3 b\u00e0sica a la URL: Projectes Completa la configuraci\u00f3 per a aconseguir-ho: server { listen 80; listen [::]:80; root /var/www/freewebsitetemplates.com/preview/space-science; index index.html index.htm index.nginx-debian.html; server_name freewebsitetemplates.com www.freewebsitetemplates.com; location { try_files $uri $uri/ =404; } } Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta de l'autoritzaci\u00f3 b\u00e0sica d'Nginx, comprovaci\u00f3 i identificaci\u00f3 de l'error 2 punts Captures correctes del log 1 punt Configuraci\u00f3 correcta de l'autoritzaci\u00f3 b\u00e0sica al \"portofolio\" 2.5 punts Correcta configuraci\u00f3 i comprovaci\u00f3 de les tasques d'autenticaci\u00f3 b\u00e0sica i restricci\u00f3 per IP 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0.5 punt","title":"Pr\u00e0ctica 4.2 - Autenticaci\u00f3 en Nginx"},{"location":"section/P4.2/#practica-42-autenticacio-en-nginx","text":"","title":"Pr\u00e0ctica 4.2 \u2013 Autenticaci\u00f3 en Nginx"},{"location":"section/P4.2/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.1 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.1 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Client 172.1.X.X ... ...","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P4.2/#introduccio","text":"En el context d'una transacci\u00f3 HTTP, l'autenticaci\u00f3 d'acc\u00e9s b\u00e0sica \u00e9s un m\u00e8tode dissenyat per a permetre a un navegador web, o un altre programa client, proveir credencials en la forma d'usuari i contrasenya quan se les sol\u00b7licita una p\u00e0gina al servidor. L'autenticaci\u00f3 b\u00e0sica, com el seu nom ho indica, \u00e9s la forma m\u00e9s b\u00e0sica d'autenticaci\u00f3 disponible per a les aplicacions Web. Va ser definida per primera vegada en l'especificaci\u00f3 HTTP en si i no \u00e9s de cap manera elegant, per\u00f2 compleix la seua funci\u00f3. Aquest tipus d'autenticaci\u00f3 \u00e9s el tipus m\u00e9s simple disponible per\u00f2 emmalalteix d'importants problemes de seguretat que no la fan recomanable en moltes situacions. No requereix l'\u00fas ni de cookies, ni d'identificadors de sessi\u00f3, ni de p\u00e0gina d'ingr\u00e9s.","title":"Introducci\u00f3"},{"location":"section/P4.2/#paquets-necessaris","text":"Per a aquesta pr\u00e0ctica podem utilitzar l'eina openssl per crear les contrasenyes. En primer lloc hem de comprovar si el paquet est\u00e0 instal\u00b7lat: dpkg -l | grep openssl I si no ho estigu\u00e9s, instal\u00b7lar-lo.","title":"Paquets necessaris"},{"location":"section/P4.2/#creacio-dusuaris-i-contrasenyes-per-a-lacces-web","text":"Crearem un arxiu ocult anomenat .htpasswd en el directori de configuraci\u00f3 /etc/nginx on guardar els nostres usuaris i contrasenyes (la -c \u00e9s per crear l'arxiu): sudo sh -c \"echo -n 'teu_nom:' >> /etc/nginx/.htpasswd\" Ara crearem un password xifrat per a l'usuari: sudo sh -c \"openssl passwd -apr1 >> /etc/nginx/.htpasswd\" Aquest proc\u00e9s es podr\u00e0 repetir per a tants usuaris com calgui. Crea dos usuaris, un amb el teu nom i un altre amb el teu primer cognom. Comprova que l'usuari i la contrasenya apareixen xifrats en el fitxer: cat /etc/nginx/.htpasswd","title":"Creaci\u00f3 d'usuaris i contrasenyes per a l'acc\u00e9s web"},{"location":"section/P4.2/#configurant-el-servidor-nginx-per-usar-autenticacio-basica","text":"Editarem la configuraci\u00f3 del server block sobre el qui volem aplicar la restricci\u00f3 d'acc\u00e9s. Utilitzarem per a aquesta autenticaci\u00f3 el lloc web de John Doe: Info Recorda que un server block \u00e9s cadascun dels dominis (( server {...} dins l'arxiu de configuraci\u00f3)) d'algun dels llocs webs que hi ha en el servidor sudo nano /etc/nginx/sites-enabled/vostre_domini Hem de decidir quins recursos estaran protegits. Nginx permet afegir restriccions a nivell de servidor o en un location (directori o arxiu) espec\u00edfic. Per al nostre exemple, protegirem el document root (l'arrel, la p\u00e0gina principal) del nostre lloc. Utilitzarem la directiva auth_basic dins del location i li posarem el text que ser\u00e0 mostrat a l'usuari en sol\u00b7licitar les credencials. Finalment, configurem Nginx perqu\u00e8 utilitze el fitxer que pr\u00e8viament hem creat amb la directiva auth_basic_user_file : server { listen 80; listen [::]:80; root /var/www/vostre_domini/html/retro-doe; index index.html index.htm index.nginx-debian.html; server_name vostre_domini www.vostre_domini; location / { auth_basic \"\u00c0rea restringida\"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } } Una vegada acabada la configuraci\u00f3, reiniciem el servei perqu\u00e8 apliqui la nostra pol\u00edtica d'acc\u00e9s. sudo systemctl restart nginx","title":"Configurant el servidor Nginx per usar autenticaci\u00f3 b\u00e0sica"},{"location":"section/P4.2/#provant-la-nova-configuracio","text":"Comprovaci\u00f3 1 Comprova des del teu client Xubuntu que en accedir a http://vostre_domini o http://www.vostre_domini se't sol\u00b7licita una autenticaci\u00f3. Comprovaci\u00f3 2 Comprova que si decideixes cancel\u00b7lar l'autenticaci\u00f3, se't negar\u00e0 l'acc\u00e9s al lloc amb un error. Quin error \u00e9s?","title":"Provant la nova configuraci\u00f3"},{"location":"section/P4.2/#tasques","text":"Tasca 1 Intenta entrar primer amb un usuari erroni i despr\u00e9s amb un altre correcte. Pots veure tots els successos i registres en els logs access.log i error.log. Adjunta una captura de pantalla dels logs on es vegi que intentes entrar primer amb un usuari inv\u00e0lid i amb un altre v\u00e0lid. Indica on podem veure els errors d'usuari inv\u00e0lid o no oposat, aix\u00ed com on podem veure el nombre d'error que us apareixia abans. Quan hem configurat el seg\u00fcent bloc: location / { auth_basic \"\u00c0rea restringida\"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } L'autenticaci\u00f3 s'aplica al directori/arxiu que li indiquem, en aquest cas l'arrel / , que \u00e9s: /var/www/exemple1/html/retro-doe/ I a tots els arxius que hi ha dins, ja que no hem especificat cap. Ara b\u00e9, anem a provar a aplicar autenticaci\u00f3 nom\u00e9s a una part de la web. Intentarem que nom\u00e9s es necessite autenticac\u00ed\u00f3 per a entrar a la part de portfolio: Aquesta secci\u00f3 es correspon amb l'arxiu \u201cportofolio.html\u201d dins del directori arrel. Tasca 2 Esborra les dues l\u00ednies que fan refer\u00e8ncia a l'autenticaci\u00f3 b\u00e0sica en el location del directori arrel. Despr\u00e9s d'aix\u00f2, afegeix un nou location sota amb l'autenticaci\u00f3 b\u00e0sica per a l'arxiu portofolio.html. Warning Fixeu-vos que heu d'anar amb compte perqu\u00e8 l'\u00faltima l\u00ednia de l'arxiu ha de ser la } que tanca la primera l\u00ednia server { de l'arxiu.","title":"Tasques"},{"location":"section/P4.2/#combinacio-de-lautenticacio-basica-amb-la-restriccio-dacces-per-ip","text":"L'autenticaci\u00f3 b\u00e0sica HTTP pot ser combinada de forma efectiva amb la restricci\u00f3 d'acc\u00e9s per adre\u00e7a IP. Es poden implementar dos escenaris: Un usuari ha d'estar ambdues coses, autenticat i tenir una IP v\u00e0lida Un usuari deu o b\u00e9 estar autenticat, o b\u00e9 tenir una IP v\u00e0lida Vegem com ho far\u00edem: Com permetre o denegar acc\u00e9s sobre una IP concreta (directives allow i deny , respectivament). Dins del block server o arxiu de configuraci\u00f3 del domini web, que recordeu est\u00e0 en el directori sites-available: L'acc\u00e9s nom\u00e9s es garantir\u00e0 a la IP 192.168.1.1/24 , excloent a l'adre\u00e7a 192.168.1.2 . Cal tenir en compte que les directives allow i deny s'aniran aplicant en l'ordre en el qual apareixen l'arxiu. Ac\u00ed apliquem sobre la location /api (es nom\u00e9s un exemple), per\u00f2 podriem aplicar sobre qualsevol, incl\u00f2s tot el lloc web, la location arrel (/). L'\u00faltima directiva deny all vol dir que per defecte denegarem l'acc\u00e9s a tothom. Per aix\u00f2 cal posar els allow i deny m\u00e9s espec\u00edfics just abans d'aquesta, perqu\u00e8 en avaluar-se en ordre d'aparici\u00f3, si els pos\u00e0rem baix es denegaria l'acc\u00e9s a tothom, ja que deny all seria el primer que s'avaluaria. Combinar la restricci\u00f3 IP i l'autenticaci\u00f3 HTTP amb la directiva satisfy . Si establim el valor de la directiva a all , l'acc\u00e9s es permet si el client satisf\u00e0 ambdues condicions (IP i usuari v\u00e0lid). Si ho establim a any , l'acc\u00e9s es permet si se satisf\u00e0 almenys una de les dues condicions.","title":"Combinaci\u00f3 de l'Autenticaci\u00f3 B\u00e0sica amb la restricci\u00f3 d'acc\u00e9s per IP"},{"location":"section/P4.2/#tasques_1","text":"Tasca 1 Col\u00b7loca una altra vegada dos clients a la teva xarxa interna i assegura't que la seua configuraci\u00f3 de xarxa \u00e9s correcta Tasca 2 Configura Nginx perqu\u00e8 no deixi accedir amb la IP del client1 al directori arrel de la mateixa web d'abans, la de John Doe\u2019s. Modifica el seu server block o arxiu de configuraci\u00f3. Comprova com es denega l'acc\u00e9s: Mostra la p\u00e0gina d'error en el navegador Mostra el missatge d'error d'error.log Tasca 3 Configura Nginx per a que el client2 hagi de tenir tant una IP v\u00e0lida com un usuari v\u00e0lid, ambdues coses alhora, i comprova que s\u00ed pot accedir sense problemes. Tasca 4 Configura Nginx ara per a que deixe accedir si es t\u00e9 una IP v\u00e0lida o tamb\u00e9 si l'usuari introdu\u00eft \u00e9s correcte. Comprova que ara s\u00ed poden accedir tots dos clients, per qu\u00e8?","title":"Tasques"},{"location":"section/P4.2/#questions-finals","text":"Questi\u00f3 1 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, equivocant-me al posar usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; deny all; auth_basic \"Questi\u00f3 final 1\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 2 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, introdu\u00efnt correctament usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy all; deny all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; auth_basic \"Questi\u00f3 final 2 : The revenge\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 3 Suposem que jo s\u00f3c el client amb la IP 172.1.10.15 i e intente accedir al directori \u201c/web_molt_guay\u201d del meu lloc web, introdu\u00efnt correctament usuari i contrasenya. Podr\u00e9 accedir? location /web_molt_guay { #... satisfy any; deny 172.1.10.6; deny 172.1.10.15; allow 172.1.3.14; auth_basic \"Questi\u00f3 final 3 : The final combat\"; auth_basic_user_file conf/htpasswd; } Questi\u00f3 4 A lo millor no sabeu que tinc una web per a documentar totes les meues excursions a l\u2019espai amb Jeff Bezos, \u00e9s aquesta: Jeff Bezos i jo Suposem que vull restringir l\u2019acc\u00e9s al directori de projectes perqu\u00e8 es molt secret, aix\u00f2 vol dir afegir autenticaci\u00f3 b\u00e0sica a la URL: Projectes Completa la configuraci\u00f3 per a aconseguir-ho: server { listen 80; listen [::]:80; root /var/www/freewebsitetemplates.com/preview/space-science; index index.html index.htm index.nginx-debian.html; server_name freewebsitetemplates.com www.freewebsitetemplates.com; location { try_files $uri $uri/ =404; } }","title":"Q\u00fcestions finals"},{"location":"section/P4.2/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta de l'autoritzaci\u00f3 b\u00e0sica d'Nginx, comprovaci\u00f3 i identificaci\u00f3 de l'error 2 punts Captures correctes del log 1 punt Configuraci\u00f3 correcta de l'autoritzaci\u00f3 b\u00e0sica al \"portofolio\" 2.5 punts Correcta configuraci\u00f3 i comprovaci\u00f3 de les tasques d'autenticaci\u00f3 b\u00e0sica i restricci\u00f3 per IP 3 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0.5 punt","title":"Avaluaci\u00f3"},{"location":"section/P4.3/","text":"Pr\u00e0ctica 4.3 \u2013 Proxy invers amb Nginx Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.1 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.1 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Proxy invers 172.1.X.X Client 172.1.X.X ... ... Introducci\u00f3 Qu\u00e8 \u00e9s un servidor proxy? Un proxy de reexpedici\u00f3, sovint anomenat proxy, servidor proxy o proxy web, \u00e9s un servidor que es troba enfront d'un grup de m\u00e0quines client. Quan aquestes m\u00e0quines realitzen sol\u00b7licituds a llocs i servicis en Internet, el servidor proxy intercepta aquestes sol\u00b7licituds i despr\u00e9s es comunica amb els servidors web en nom d'aquests clients, com un intermediari. Per exemple, prenguem com a exemple 3 m\u00e0quines involucrades en una comunicaci\u00f3 t\u00edpica de proxy de reenviament: A: Aquesta \u00e9s la m\u00e0quina de la casa d'un usuari. B: Este \u00e9s un servidor proxy de reenviament C: Este \u00e9s el servidor d'origen d'un lloc web (on s'emmagatzemen les dades de l'lloc web) En una comunicaci\u00f3 est\u00e0ndard per Internet, la m\u00e0quina A se comunicaria directament amb la m\u00e0quina C, amb el client enviant sol\u00b7licituds al servidor d'origen i el servidor d'origen responent al client. Quan n'hi ha un proxy de reenviament, A enviar\u00e0 sol\u00b7licituds a B, que despr\u00e9s reexpedir\u00e0 la sol\u00b7licitud a C. C enviar\u00e0 una resposta a B, que reexpedir\u00e0 la resposta a A. Per qu\u00e8 agregar aquest intermediari addicional a la nostra activitat en Internet? Hi ha algunes raons per les quals un podria voler usar un proxy de reenviament: Per evitar restriccions de navegaci\u00f3 estatals o institucionals: alguns governs, escoles i altres organitzacions usen firewalls per donar als seus usuaris acc\u00e9s a una versi\u00f3 limitada d'Internet. Es pot usar un proxy de reenviament per sortejar aquestes restriccions, ja que permeten que l'usuari es connecti al proxy en lloc de directament als llocs que est\u00e0 visitant. Per bloquejar l'acc\u00e9s a cert contingut: al rev\u00e9s, els proxies tamb\u00e9 es poden configurar per bloquejar l'acc\u00e9s d'un grup d'usuaris a certs llocs. Per exemple, una xarxa escolar pot estar configurada per connectar-se a la web a trav\u00e9s d'un proxy que habilita regles de filtrat de contingut, negant-se a reexpedir respostes de Facebook i altres llocs de xarxes socials. Per protegir la seva identitat en l\u00ednia: en alguns casos, els usuaris habituals d'Internet simplement desitgen un major anonimat en l\u00ednia, per\u00f2 en altres casos, els usuaris d'Internet viuen en llocs on el govern pot imposar greus conseq\u00fc\u00e8ncies als dissidents pol\u00edtics. Criticar al govern en un f\u00f2rum web o a les xarxes socials pot donar lloc a multes o empresonament per a aquests usuaris. Si un d'aquests dissidents usa un proxy de reenviament per connectar-se a un lloc web on publica comentaris pol\u00edticament sensibles, l'adre\u00e7a IP utilitzada per publicar els comentaris ser\u00e0 m\u00e9s dif\u00edcil de rastrejar fins al dissident. Solament estar\u00e0 visible l'adre\u00e7a IP del servidor proxy. En qu\u00e8 es diferencia un proxy invers? Estar\u00edem parlant del cas oposat a l'anterior. Un proxy invers \u00e9s un servidor que es troba enfront d'un o m\u00e9s servidors web, interceptant les sol\u00b7licituds dels clients. Aix\u00f2 \u00e9s diferent d'un proxy de reenviament, on el proxy es troba enfront dels clients. Amb un proxy invers, quan els clients envien sol\u00b7licituds al servidor d'un lloc web, aquestes sol\u00b7licituds s\u00f3n interceptades a la frontera de la xarxa pel servidor proxy invers. El servidor proxy invers enviar\u00e0 sol\u00b7licituds i rebr\u00e0 respostes del servidor de lloc web. La difer\u00e8ncia entre un proxy directe i invers \u00e9s subtil per\u00f2 important. Una forma simplificada de resumir seria dir que un proxy de reenviament es troba enfront d'un client i garanteix que cap servidor d'origen es comuniqui mai directament amb aquest client espec\u00edfic. D'altra banda, un proxy invers es troba enfront d'un servidor d'origen i garanteix que cap client es comuniqui mai directament amb aquest servidor d'origen. Una vegada m\u00e9s, il\u00b7lustrem nomenant les m\u00e0quines involucrades: D: qualsevol nombre d'ordinadors dom\u00e8stics dels usuaris I: est \u00e9s un servidor proxy invers F: un o m\u00e9s servidors d'origen Normalment, totes les sol\u00b7licituds de D anirien directament a F, i F enviaria respostes directament a D. Amb un proxy invers, totes les sol\u00b7licituds de D aniran directament a I, i I enviar\u00e0 les seves sol\u00b7licituds ai rebr\u00e0 respostes de F. I despr\u00e9s transmeti les respostes apropiades a D. A continuaci\u00f3 es descriuen alguns dels beneficis d'un proxy invers: Balanceig de c\u00e0rrega: \u00e9s possible que un lloc web popular que rep milions d'usuaris tots els dies no pugui manejar tot el tr\u00e0fic entrant del lloc amb un sol servidor d'origen. En canvi, el lloc es pot distribuir entre un grup de servidors diferents, tots manejant sol\u00b7licituds per al mateix lloc. En aquest cas, un proxy invers pot proporcionar una soluci\u00f3 de balanceig de c\u00e0rrega que distribuir\u00e0 el tr\u00e0fic entrant de manera uniforme entre els diferents servidors per evitar que un sol servidor se sobrecarregui. En el cas que un servidor falli per complet, altres servidors poden intensificar per manejar el tr\u00e0fic. Protecci\u00f3 contra atacs: amb un proxy invers en el seu lloc, un lloc web o servici mai necessita revelar l'adre\u00e7a IP de la seva (s) servidor (\u00e9s) d'origen. Aix\u00f2 fa que sigui molt m\u00e9s dif\u00edcil per als atacants aprofitar un atac dirigit contra ells, com un atac DdoS. Emmagatzematge en cach\u00e9 : un proxy invers tamb\u00e9 pot emmagatzemar contingut en cach\u00e9 , la qual cosa resulta en un rendiment m\u00e9s r\u00e0pid. Per exemple, si un usuari a Par\u00eds visita un lloc web amb proxy invers amb servidors web a Los Angeles, l'usuari podria connectar-se a un servidor proxy invers local a Par\u00eds, que despr\u00e9s haur\u00e0 de comunicar-se amb un servidor d'origen a Los Angeles. El servidor proxy despr\u00e9s pot emmagatzemar en cach\u00e9 (o guardar temporalment) les dades de resposta. Els usuaris parisencs posteriors que naveguin pel lloc obtindran la versi\u00f3 en cach\u00e9 local del servidor proxy invers parisenc, la qual cosa donar\u00e0 com resultat un rendiment molt m\u00e9s r\u00e0pid. Xifrat SSL - Xifrat i desxifrat SSL (o TLS comunicacions) per a cada client poden ser computacionalment car per a un servidor d'origen. Es pot configurar un proxy invers per desxifrar totes les sol\u00b7licituds entrants i xifrar totes les respostes sortints, alliberant valuosos recursos en el servidor d'origen. Tasca Anem a configurar dos Ubuntu Server amb sengles servidors Nginx: Un servir\u00e0 les p\u00e0gines web que ja hem configurat, aix\u00ed doncs utilitzarem el servidor que ja tenim configurat de la Pr\u00e0ctica 4.1. Un altre servidor clon Ubuntu Server amb tots els servicis parats a excepci\u00f3 de Nginx configurat com proxy invers \u2192 Ha de tenir IP fixa en el DHCP Realitzarem les peticions HTTP des del navegador web del nostre Xubuntu. El diagrama de xarxa quedaria aix\u00ed: Les tres m\u00e0quines estaran a la nostra xarxa interna. Farem les peticions web al servidor proxy, que les redirigir\u00e0 al nostre servidor web Nginx original. Aquest \u00faltim respondr\u00e0 al proxy invers, que ens redirigir\u00e0 la resposta al nostre client Xubuntu. Hem dit que un proxy invers \u00e9s un servidor intermediari que hauria de ser invisible en la mesura del possible. Anem a veure qu\u00e8 configuracions necessitem fer per aconseguir-ho. Configuracions Nginx servidor web Per a que tot quede m\u00e9s diferenciat i vos quede m\u00e9s clar que la petici\u00f3 est\u00e0 passant pel proxy invers i arriba al servidor web dest\u00ed, anem a fer que cadascun dels servidors escolti les peticions en un port diferent. En primer lloc, heu de canviar el nom que tingu\u00e9s vostra web pel de \u201cwebserver\u201d: Canviar el nom de l'arxiu de configuraci\u00f3 Canviar el nom de l'lloc web dins d'aquest arxiu de configuraci\u00f3 on faci mancada No us oblideu d'eliminar el link simb\u00f2lic antic amb el comando \u201cunlink nom_de el_link\u201d i crear el nou per al nou nom d'arxiu. En l'arxiu de configuraci\u00f3 de l'lloc web, en lloc de fer que el servidor escolti en el port 80, canvieu-ho al 8080. Canviar el registre CNAME del DNS (ara l'\u00e0lies no ser\u00e0 el nom antic de la vostra web, sin\u00f3 el nou nom que hem posat, \u201cwebserver\u201d) Reiniciar Nginx Nginx proxy invers Ara, quan intentem accedir a http://exemple1 (o el nom que tingau de la vostra web), en realitat estarem accedint al proxy, que ens redirigir\u00e0 a http://webserver:8080, el servidor web que acabem de configurar perqu\u00e8 escolti amb aquest nom en el port 8080. Per a aix\u00f2: Crear un arxiu de configuraci\u00f3 en sites-available amb el nom exemple1 (o el que tingu\u00e9reu vosaltres) Aquest arxiu de configuraci\u00f3 ser\u00e0 m\u00e9s simple, tindr\u00e0 la seg\u00fcent forma server { listen __; server_name ____________; location / { proxy_pass http://_________:____; } } On, mirant el diagrama de xarxa i tenint en compte la configuraci\u00f3 feta fins ara , heu de completar: El port on est\u00e0 escoltant el proxy invers El nom de domini o lloc web al que accedim en el proxy La directiva \u201cproxy_pass\u201d indica a on es van a redirigir les peticions, aix\u00f2 \u00e9s, al servidor web. Per tant, heu de posar el nou nom i nombre de port adequats de vostre lloc web configurat en l'apartat anterior. Crear el link simb\u00f2lic pertinent Heu de crear dos registres nous en el DNS: Un de tipus A , el nom del qual ser\u00e0 proxy-server.nom_alumne.es. i que apunta a la IP d'aquest segon servidor proxy invers Un altre registre tipus CNAME , de tal forma que exemple1 (o el nom de vostre lloc web) anotaci\u00f3 al registre tipus A creat en el punt anterior. Aix\u00f2 \u00e9s per simular la situaci\u00f3 en la qual nosaltres, com a clients, quan accedim a nostre lloc web, no necessitem saber com est\u00e0 tot configurat, nom\u00e9s necessitem saber el nom de la web. No obstant aix\u00f2, per identificar les m\u00e0quines internament, nosaltres com a administradors les tindrem identificades amb altres noms (proxy-server i webserver/dnsserver). Comprovacions Si accediu a vostre lloc web, heu de poder seguir accedint sense problemes. Comproveu en els access.log dels dos servidors que arriba la petici\u00f3 Comproveu a m\u00e9s la petici\u00f3 i resposta amb les eines de desenvolupador de Firefox en Xubuntu. Prement F12 en el navegador us apareixeran aquestes eines: En la primera petici\u00f3 (marcada en vermell), utilitzant l'apartat \u201cXarxa\u201d (tamb\u00e9 marcat en vermell) i tamb\u00e9 en vermell est\u00e0 assenyalat on es pot veure la resposta de la petici\u00f3 GET HTTP (200 OK). Tamb\u00e9 veiem les cap\u00e7aleres que s'inclouen en la petici\u00f3 (m\u00e8tode GET) i en la resposta a aquesta petici\u00f3. Afegint cap\u00e7aleres A m\u00e9s d'haver mirat els logs, anem a demostrar encara de forma m\u00e9s clara que la petici\u00f3 est\u00e0 passant pel proxy invers i que est\u00e0 arribant al servidor web i que torna pel mateix cam\u00ed. Si recordeu de teoria, el servidor web \u00e9s capa\u00e7 d'afegir cap\u00e7aleres en les respostes a les peticions. Aix\u00ed doncs, anem a configurar tant el proxy invers com el servidor web perqu\u00e8 afegeixin cadascun la cap\u00e7alera \u201cHost\u201d que tamb\u00e9 vam veure en teoria. Per afegir cap\u00e7aleres, en l'arxiu de configuraci\u00f3 de l'lloc web hem d'afegir dins del bloc location / { \u2026 } hem d'afegir la directiva: add_header Host \u201cnom_del_host\u201d Afegirem primer aquesta cap\u00e7alera \u00fanicament en l'arxiu de configuraci\u00f3 de l'lloc web del proxy invers. El Nom_del_host ser\u00e0 Proxy_invers_vostrenom. Reiniciem Nginx Comprovem que podem accedir a l'lloc web sense problemes Amb les eines de desenvolupador comprovem que la petici\u00f3 ha passat pel proxy invers que ha afegit la cap\u00e7alera en la resposta: Fem el propi amb el servidor web. Aquesta vegada el nom_del_host ser\u00e0 servidor_web_vostrenom . Si tot est\u00e0 configurat correctament, en examinar les peticions i respostes, us apareixeran les dues cap\u00e7aleres que han incl\u00f2s en la resposta tant el proxy invers com el servidor web. \u00c9s molt important que per realitzar aquestes comprovacions tingueu marcat el checkbox \u201cDesactivar cach\u00e9\u201d. Si no marqueu aix\u00f2, la p\u00e0gina es guardar\u00e0 en la mem\u00f2ria cach\u00e9 del navegador i no estareu rebent la resposta del servidor sin\u00f3 de la cach\u00e9 del navegador, la qual cosa pot donar lloc a resultats erronis. Avaluaci\u00f3 Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta i completa del servidor web 3.5 punts Configuraci\u00f3 correcta i completa del proxy invers 3.5 punts Comprovaci\u00f3 del correcte funcionament, incloent les cap\u00e7aleres 1.5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0.5 punt","title":"Pr\u00e0ctica 4.3 - Proxy invers amb Nginx"},{"location":"section/P4.3/#practica-43-proxy-invers-amb-nginx","text":"","title":"Pr\u00e0ctica 4.3 \u2013 Proxy invers amb Nginx"},{"location":"section/P4.3/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.1 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.1 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Proxy invers 172.1.X.X Client 172.1.X.X ... ...","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P4.3/#introduccio","text":"","title":"Introducci\u00f3"},{"location":"section/P4.3/#que-es-un-servidor-proxy","text":"Un proxy de reexpedici\u00f3, sovint anomenat proxy, servidor proxy o proxy web, \u00e9s un servidor que es troba enfront d'un grup de m\u00e0quines client. Quan aquestes m\u00e0quines realitzen sol\u00b7licituds a llocs i servicis en Internet, el servidor proxy intercepta aquestes sol\u00b7licituds i despr\u00e9s es comunica amb els servidors web en nom d'aquests clients, com un intermediari. Per exemple, prenguem com a exemple 3 m\u00e0quines involucrades en una comunicaci\u00f3 t\u00edpica de proxy de reenviament: A: Aquesta \u00e9s la m\u00e0quina de la casa d'un usuari. B: Este \u00e9s un servidor proxy de reenviament C: Este \u00e9s el servidor d'origen d'un lloc web (on s'emmagatzemen les dades de l'lloc web) En una comunicaci\u00f3 est\u00e0ndard per Internet, la m\u00e0quina A se comunicaria directament amb la m\u00e0quina C, amb el client enviant sol\u00b7licituds al servidor d'origen i el servidor d'origen responent al client. Quan n'hi ha un proxy de reenviament, A enviar\u00e0 sol\u00b7licituds a B, que despr\u00e9s reexpedir\u00e0 la sol\u00b7licitud a C. C enviar\u00e0 una resposta a B, que reexpedir\u00e0 la resposta a A. Per qu\u00e8 agregar aquest intermediari addicional a la nostra activitat en Internet? Hi ha algunes raons per les quals un podria voler usar un proxy de reenviament: Per evitar restriccions de navegaci\u00f3 estatals o institucionals: alguns governs, escoles i altres organitzacions usen firewalls per donar als seus usuaris acc\u00e9s a una versi\u00f3 limitada d'Internet. Es pot usar un proxy de reenviament per sortejar aquestes restriccions, ja que permeten que l'usuari es connecti al proxy en lloc de directament als llocs que est\u00e0 visitant. Per bloquejar l'acc\u00e9s a cert contingut: al rev\u00e9s, els proxies tamb\u00e9 es poden configurar per bloquejar l'acc\u00e9s d'un grup d'usuaris a certs llocs. Per exemple, una xarxa escolar pot estar configurada per connectar-se a la web a trav\u00e9s d'un proxy que habilita regles de filtrat de contingut, negant-se a reexpedir respostes de Facebook i altres llocs de xarxes socials. Per protegir la seva identitat en l\u00ednia: en alguns casos, els usuaris habituals d'Internet simplement desitgen un major anonimat en l\u00ednia, per\u00f2 en altres casos, els usuaris d'Internet viuen en llocs on el govern pot imposar greus conseq\u00fc\u00e8ncies als dissidents pol\u00edtics. Criticar al govern en un f\u00f2rum web o a les xarxes socials pot donar lloc a multes o empresonament per a aquests usuaris. Si un d'aquests dissidents usa un proxy de reenviament per connectar-se a un lloc web on publica comentaris pol\u00edticament sensibles, l'adre\u00e7a IP utilitzada per publicar els comentaris ser\u00e0 m\u00e9s dif\u00edcil de rastrejar fins al dissident. Solament estar\u00e0 visible l'adre\u00e7a IP del servidor proxy.","title":"Qu\u00e8 \u00e9s un servidor proxy?"},{"location":"section/P4.3/#en-que-es-diferencia-un-proxy-invers","text":"Estar\u00edem parlant del cas oposat a l'anterior. Un proxy invers \u00e9s un servidor que es troba enfront d'un o m\u00e9s servidors web, interceptant les sol\u00b7licituds dels clients. Aix\u00f2 \u00e9s diferent d'un proxy de reenviament, on el proxy es troba enfront dels clients. Amb un proxy invers, quan els clients envien sol\u00b7licituds al servidor d'un lloc web, aquestes sol\u00b7licituds s\u00f3n interceptades a la frontera de la xarxa pel servidor proxy invers. El servidor proxy invers enviar\u00e0 sol\u00b7licituds i rebr\u00e0 respostes del servidor de lloc web. La difer\u00e8ncia entre un proxy directe i invers \u00e9s subtil per\u00f2 important. Una forma simplificada de resumir seria dir que un proxy de reenviament es troba enfront d'un client i garanteix que cap servidor d'origen es comuniqui mai directament amb aquest client espec\u00edfic. D'altra banda, un proxy invers es troba enfront d'un servidor d'origen i garanteix que cap client es comuniqui mai directament amb aquest servidor d'origen. Una vegada m\u00e9s, il\u00b7lustrem nomenant les m\u00e0quines involucrades: D: qualsevol nombre d'ordinadors dom\u00e8stics dels usuaris I: est \u00e9s un servidor proxy invers F: un o m\u00e9s servidors d'origen Normalment, totes les sol\u00b7licituds de D anirien directament a F, i F enviaria respostes directament a D. Amb un proxy invers, totes les sol\u00b7licituds de D aniran directament a I, i I enviar\u00e0 les seves sol\u00b7licituds ai rebr\u00e0 respostes de F. I despr\u00e9s transmeti les respostes apropiades a D. A continuaci\u00f3 es descriuen alguns dels beneficis d'un proxy invers: Balanceig de c\u00e0rrega: \u00e9s possible que un lloc web popular que rep milions d'usuaris tots els dies no pugui manejar tot el tr\u00e0fic entrant del lloc amb un sol servidor d'origen. En canvi, el lloc es pot distribuir entre un grup de servidors diferents, tots manejant sol\u00b7licituds per al mateix lloc. En aquest cas, un proxy invers pot proporcionar una soluci\u00f3 de balanceig de c\u00e0rrega que distribuir\u00e0 el tr\u00e0fic entrant de manera uniforme entre els diferents servidors per evitar que un sol servidor se sobrecarregui. En el cas que un servidor falli per complet, altres servidors poden intensificar per manejar el tr\u00e0fic. Protecci\u00f3 contra atacs: amb un proxy invers en el seu lloc, un lloc web o servici mai necessita revelar l'adre\u00e7a IP de la seva (s) servidor (\u00e9s) d'origen. Aix\u00f2 fa que sigui molt m\u00e9s dif\u00edcil per als atacants aprofitar un atac dirigit contra ells, com un atac DdoS. Emmagatzematge en cach\u00e9 : un proxy invers tamb\u00e9 pot emmagatzemar contingut en cach\u00e9 , la qual cosa resulta en un rendiment m\u00e9s r\u00e0pid. Per exemple, si un usuari a Par\u00eds visita un lloc web amb proxy invers amb servidors web a Los Angeles, l'usuari podria connectar-se a un servidor proxy invers local a Par\u00eds, que despr\u00e9s haur\u00e0 de comunicar-se amb un servidor d'origen a Los Angeles. El servidor proxy despr\u00e9s pot emmagatzemar en cach\u00e9 (o guardar temporalment) les dades de resposta. Els usuaris parisencs posteriors que naveguin pel lloc obtindran la versi\u00f3 en cach\u00e9 local del servidor proxy invers parisenc, la qual cosa donar\u00e0 com resultat un rendiment molt m\u00e9s r\u00e0pid. Xifrat SSL - Xifrat i desxifrat SSL (o TLS comunicacions) per a cada client poden ser computacionalment car per a un servidor d'origen. Es pot configurar un proxy invers per desxifrar totes les sol\u00b7licituds entrants i xifrar totes les respostes sortints, alliberant valuosos recursos en el servidor d'origen.","title":"En qu\u00e8 es diferencia un proxy invers?"},{"location":"section/P4.3/#tasca","text":"Anem a configurar dos Ubuntu Server amb sengles servidors Nginx: Un servir\u00e0 les p\u00e0gines web que ja hem configurat, aix\u00ed doncs utilitzarem el servidor que ja tenim configurat de la Pr\u00e0ctica 4.1. Un altre servidor clon Ubuntu Server amb tots els servicis parats a excepci\u00f3 de Nginx configurat com proxy invers \u2192 Ha de tenir IP fixa en el DHCP Realitzarem les peticions HTTP des del navegador web del nostre Xubuntu. El diagrama de xarxa quedaria aix\u00ed: Les tres m\u00e0quines estaran a la nostra xarxa interna. Farem les peticions web al servidor proxy, que les redirigir\u00e0 al nostre servidor web Nginx original. Aquest \u00faltim respondr\u00e0 al proxy invers, que ens redirigir\u00e0 la resposta al nostre client Xubuntu. Hem dit que un proxy invers \u00e9s un servidor intermediari que hauria de ser invisible en la mesura del possible. Anem a veure qu\u00e8 configuracions necessitem fer per aconseguir-ho.","title":"Tasca"},{"location":"section/P4.3/#configuracions","text":"","title":"Configuracions"},{"location":"section/P4.3/#nginx-servidor-web","text":"Per a que tot quede m\u00e9s diferenciat i vos quede m\u00e9s clar que la petici\u00f3 est\u00e0 passant pel proxy invers i arriba al servidor web dest\u00ed, anem a fer que cadascun dels servidors escolti les peticions en un port diferent. En primer lloc, heu de canviar el nom que tingu\u00e9s vostra web pel de \u201cwebserver\u201d: Canviar el nom de l'arxiu de configuraci\u00f3 Canviar el nom de l'lloc web dins d'aquest arxiu de configuraci\u00f3 on faci mancada No us oblideu d'eliminar el link simb\u00f2lic antic amb el comando \u201cunlink nom_de el_link\u201d i crear el nou per al nou nom d'arxiu. En l'arxiu de configuraci\u00f3 de l'lloc web, en lloc de fer que el servidor escolti en el port 80, canvieu-ho al 8080. Canviar el registre CNAME del DNS (ara l'\u00e0lies no ser\u00e0 el nom antic de la vostra web, sin\u00f3 el nou nom que hem posat, \u201cwebserver\u201d) Reiniciar Nginx","title":"Nginx servidor web"},{"location":"section/P4.3/#nginx-proxy-invers","text":"Ara, quan intentem accedir a http://exemple1 (o el nom que tingau de la vostra web), en realitat estarem accedint al proxy, que ens redirigir\u00e0 a http://webserver:8080, el servidor web que acabem de configurar perqu\u00e8 escolti amb aquest nom en el port 8080. Per a aix\u00f2: Crear un arxiu de configuraci\u00f3 en sites-available amb el nom exemple1 (o el que tingu\u00e9reu vosaltres) Aquest arxiu de configuraci\u00f3 ser\u00e0 m\u00e9s simple, tindr\u00e0 la seg\u00fcent forma server { listen __; server_name ____________; location / { proxy_pass http://_________:____; } } On, mirant el diagrama de xarxa i tenint en compte la configuraci\u00f3 feta fins ara , heu de completar: El port on est\u00e0 escoltant el proxy invers El nom de domini o lloc web al que accedim en el proxy La directiva \u201cproxy_pass\u201d indica a on es van a redirigir les peticions, aix\u00f2 \u00e9s, al servidor web. Per tant, heu de posar el nou nom i nombre de port adequats de vostre lloc web configurat en l'apartat anterior. Crear el link simb\u00f2lic pertinent Heu de crear dos registres nous en el DNS: Un de tipus A , el nom del qual ser\u00e0 proxy-server.nom_alumne.es. i que apunta a la IP d'aquest segon servidor proxy invers Un altre registre tipus CNAME , de tal forma que exemple1 (o el nom de vostre lloc web) anotaci\u00f3 al registre tipus A creat en el punt anterior. Aix\u00f2 \u00e9s per simular la situaci\u00f3 en la qual nosaltres, com a clients, quan accedim a nostre lloc web, no necessitem saber com est\u00e0 tot configurat, nom\u00e9s necessitem saber el nom de la web. No obstant aix\u00f2, per identificar les m\u00e0quines internament, nosaltres com a administradors les tindrem identificades amb altres noms (proxy-server i webserver/dnsserver).","title":"Nginx proxy invers"},{"location":"section/P4.3/#comprovacions","text":"Si accediu a vostre lloc web, heu de poder seguir accedint sense problemes. Comproveu en els access.log dels dos servidors que arriba la petici\u00f3 Comproveu a m\u00e9s la petici\u00f3 i resposta amb les eines de desenvolupador de Firefox en Xubuntu. Prement F12 en el navegador us apareixeran aquestes eines: En la primera petici\u00f3 (marcada en vermell), utilitzant l'apartat \u201cXarxa\u201d (tamb\u00e9 marcat en vermell) i tamb\u00e9 en vermell est\u00e0 assenyalat on es pot veure la resposta de la petici\u00f3 GET HTTP (200 OK). Tamb\u00e9 veiem les cap\u00e7aleres que s'inclouen en la petici\u00f3 (m\u00e8tode GET) i en la resposta a aquesta petici\u00f3.","title":"Comprovacions"},{"location":"section/P4.3/#afegint-capcaleres","text":"A m\u00e9s d'haver mirat els logs, anem a demostrar encara de forma m\u00e9s clara que la petici\u00f3 est\u00e0 passant pel proxy invers i que est\u00e0 arribant al servidor web i que torna pel mateix cam\u00ed. Si recordeu de teoria, el servidor web \u00e9s capa\u00e7 d'afegir cap\u00e7aleres en les respostes a les peticions. Aix\u00ed doncs, anem a configurar tant el proxy invers com el servidor web perqu\u00e8 afegeixin cadascun la cap\u00e7alera \u201cHost\u201d que tamb\u00e9 vam veure en teoria. Per afegir cap\u00e7aleres, en l'arxiu de configuraci\u00f3 de l'lloc web hem d'afegir dins del bloc location / { \u2026 } hem d'afegir la directiva: add_header Host \u201cnom_del_host\u201d Afegirem primer aquesta cap\u00e7alera \u00fanicament en l'arxiu de configuraci\u00f3 de l'lloc web del proxy invers. El Nom_del_host ser\u00e0 Proxy_invers_vostrenom. Reiniciem Nginx Comprovem que podem accedir a l'lloc web sense problemes Amb les eines de desenvolupador comprovem que la petici\u00f3 ha passat pel proxy invers que ha afegit la cap\u00e7alera en la resposta: Fem el propi amb el servidor web. Aquesta vegada el nom_del_host ser\u00e0 servidor_web_vostrenom . Si tot est\u00e0 configurat correctament, en examinar les peticions i respostes, us apareixeran les dues cap\u00e7aleres que han incl\u00f2s en la resposta tant el proxy invers com el servidor web. \u00c9s molt important que per realitzar aquestes comprovacions tingueu marcat el checkbox \u201cDesactivar cach\u00e9\u201d. Si no marqueu aix\u00f2, la p\u00e0gina es guardar\u00e0 en la mem\u00f2ria cach\u00e9 del navegador i no estareu rebent la resposta del servidor sin\u00f3 de la cach\u00e9 del navegador, la qual cosa pot donar lloc a resultats erronis.","title":"Afegint cap\u00e7aleres"},{"location":"section/P4.3/#avaluacio","text":"Criteri Puntuaci\u00f3 Configuraci\u00f3 correcta i completa del servidor web 3.5 punts Configuraci\u00f3 correcta i completa del proxy invers 3.5 punts Comprovaci\u00f3 del correcte funcionament, incloent les cap\u00e7aleres 1.5 punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic 1 punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana 0.5 punt","title":"Avaluaci\u00f3"},{"location":"section/P4.4/","text":"Pr\u00e0ctica 4.4 \u2013 Balanceig de c\u00e0rrega amb proxy invers en Nginx Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.3 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.3 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Servidor web 2 172.1.X.X Proxy invers 172.1.X.X ... ... Introducci\u00f3 Els servidors proxy inversos i els balancejadores de c\u00e0rrega s\u00f3n components d'una arquitectura inform\u00e0tica client-servidor. Tots dos actuen com a intermediaris en la comunicaci\u00f3 entre els clients i els servidors, realitzant funcions que milloren l'efici\u00e8ncia. Les definicions b\u00e0siques s\u00f3n simples: Un proxy invers accepta una sol\u00b7licitud d'un client, la reenv\u00eda a un servidor que pot complir-la i retorna la resposta del servidor al client. Un balancejador de c\u00e0rrega distribueix les sol\u00b7licituds entrants del client entre un grup de servidors, en cada cas retornant la resposta del servidor seleccionat al client apropiat. Suenan bastant similars, veritat? Tots dos tipus d'aplicacions se situen entre clients i servidors, acceptant sol\u00b7licituds del primer i lliurant respostes del segon. No \u00e9s d'estranyar que hi hagi confusi\u00f3 sobre qu\u00e8 \u00e9s un proxy invers i un balancejador de c\u00e0rrega. Per ajudar a diferenciar-los, explorem quan i per qu\u00e8 normalment s'implementen en un lloc web. Proxy invers Ja coneixem aquest concepte de la pr\u00e0ctica anterior. Mentre que implementar un balancejador de c\u00e0rrega solament t\u00e9 sentit quan es t\u00e9n diversos servidors, sovint t\u00e9 sentit implementar un proxy invers fins i tot amb un sol servidor web o servidor d'aplicacions. Es pot pensar en el proxy invers com la \"cara p\u00fablica\" d'un lloc web. La seva adre\u00e7a \u00e9s la que s'anuncia per al lloc web i es troba a la frontera de la xarxa del lloc per acceptar sol\u00b7licituds de navegadors web i aplicacions m\u00f2bils per al contingut allotjat en el lloc web. Balancejadors de c\u00e0rrega Els balancejadores de c\u00e0rrega s'implementen amb major freq\u00fc\u00e8ncia quan un lloc necessita diversos servidors perqu\u00e8 el volum de sol\u00b7licituds \u00e9s massa perqu\u00e8 un sol servidor ho manegi de manera eficient. La implementaci\u00f3 de diversos servidors tamb\u00e9 elimina un sol punt de falla, la qual cosa fa que el lloc web sigui m\u00e9s confiable. En general, tots els servidors allotgen el mateix contingut, i el treball del balancejador de c\u00e0rrega \u00e9s distribuir la c\u00e0rrega de treball de manera que es faci el millor \u00fas de la capacitat de cada servidor, eviti la sobrec\u00e0rrega en qualsevola de ells i doni com resultat la resposta m\u00e9s r\u00e0pida possible al client. Un balancejador de c\u00e0rrega tamb\u00e9 pot millorar l'experi\u00e8ncia de l'usuari en reduir la quantitat de respostes d'error que veu el client. Ho fa detectant quan els servidors cauen i desviant les sol\u00b7licituds d'ells als altres servidors del grup . En la implementaci\u00f3 m\u00e9s simple, el balancejador de c\u00e0rrega detecta l'estat del servidor en interceptar les respostes d'error a les sol\u00b7licituds regulars. Info En aquesta pr\u00e0ctica tindrem l'escenari on Nginx far\u00e0 tant de proxy invers com de balancejador de c\u00e0rrega al mateix temps. Tasca Anem a configurar dos servidors web Nginx amb dues m\u00e0quines Ubuntu Server, a m\u00e9s de reutilitzar el proxy invers Nginx configurat en la pr\u00e0ctica anterior. Partirem per tant de la configuraci\u00f3 de la pr\u00e0ctica anterior, afegint el necessari: Cada servidor web presentar\u00e0 un lloc web espec\u00edfic per a aquesta pr\u00e0ctica El webserver2 ha de tenir la IP assignada de forma fixa mitjan\u00e7ant la configuraci\u00f3 DHCP. Il proxy invers que ja ten\u00edem configurat, hi haur\u00e0 ara que configurar-ho perqu\u00e8 realitzi el balanceig de c\u00e0rrega que desitgem Realitzarem les peticions HTTP des del navegador web del nostre Xubuntu. El diagrama de xarxa quedaria aix\u00ed: Les tres m\u00e0quines estaran a la nostra xarxa interna. Farem les peticions web des del navegador al proxy invers, que les repartir\u00e0 entre els dos servidors web que tenim. Accedirem a http://balanceig i hem d'observar que les peticions, efectivament, es van repartint entre el servidor 1 i el 2. Configuracions Nginx Servidor Web 1 El primer servidor web ser\u00e0 el servidor principal que hem vingut utilitzant fins ara durant el curs, on tenim instal\u00b7lats ja els servicis DNS, DHCP i Web. Hem de configurar aquest servidor web perqu\u00e8 servicixi el seg\u00fcent index.html que heu de crear dins de la carpeta /var/www/webserver1/html : El nom de l'lloc web que heu d'utilitzar en els arxius corresponents (sites-available\u2026) que heu de crear per Nginx \u00e9s webserver1 , aix\u00ed com en les seues configuracions. Fixeu-vos en les configuracions que vau fer en pr\u00e0ctiques anteriors a manera de refer\u00e8ncia. El lloc web ha d'escoltar en el port 8080. Heu d'afegir una cap\u00e7alera que es crida Serv_Web1_vostrenom . Nginx Servidor Web 2 Ha de ser una m\u00e0quina Ubuntu Server amb tots els servicis parats excepte Nginx. En aquest servidor web hem de realitzar una configuraci\u00f3 id\u00e8ntica al servidor web 1 per\u00f2 canviant webserver1 per webserver2 (tamb\u00e9 en el index.html), aix\u00ed com el nom de la cap\u00e7alera afegida, que ser\u00e0 Serv_Web2_vostrenom Warning \u00c9s important que no quede cap refer\u00e8ncia a webserver1 per cap arxiu, d'una altra forma vos donar\u00e0 resultats erronis i vos dificultar\u00e0 molt trobar l'error. Configuraci\u00f3 DNS Hem d'afegir dos nous registres a la nostra zona: De pr\u00e0ctiques anteriors existeix un registre en el DNS de tipus CNAME (que fa refer\u00e8ncia al servidor que venim utilitzant des de principi de curs amb tots els servicis) per al nom webserver . Heu de canviar-ho a webserver1 que \u00e9s com es dir\u00e0 ara. Un registre CNAME perqu\u00e8 balancejo sigui un \u00e0lies de proxy-server.dominio.es. , tal com vau fer en la pr\u00e0ctica anterior. Aix\u00f2 permetr\u00e0 que quan accedim via navegador a http://balanceig , el DNS resolgui que la IP d'aquest domini \u00e9s la del proxy invers. ja que webserver2 \u00e9s una m\u00e0quina nova i independent, no podem afegir cap \u00e0lies per a ella. En aquest cas hem d'afegir un registre de tipus A perqu\u00e8 aquest nom apunti a la IP que tingui la m\u00e0quina. Nginx Proxy Invers Ja disposem dels dos servidors web entre els quals es van a repartir les peticions que realitzi el client des del navegador. Anem, per tant, a configurar el proxy invers perqu\u00e8 realitzi aquest repartiment de peticions: En sites-available heu de crear l'arxiu de configuraci\u00f3 amb el nom balanceig Aquest arxiu tindr\u00e0 el seg\u00fcent format: upstream backend_hosts { random; server ________:____; server ________:____; } server { llistin 80; server_name ________; location / { proxy_pass http://backend_hosts; } On: El bloc upstream \u2192 s\u00f3n els servidors entre els quals es va a repartir la c\u00e0rrega, que s\u00f3n els dos que hem configurat anteriorment. Si mireu el diagrama i teniu en compte la configuraci\u00f3 que heu fet fins ara, aqu\u00ed haureu de col\u00b7locar el nom de cada servidor, aix\u00ed com el port on est\u00e0 escoltant les peticions web. A aquest grup de servidors li posem un nom, que \u00e9s backend_hosts Aclaraci\u00f3 En un lloc web, el backend s'encarrega de tots els processos necessaris perqu\u00e8 la web funcioni de forma correcta. Aquests processos o funcions no s\u00f3n visibles, per\u00f2 tenen molta import\u00e0ncia en el bon funcionament d'un lloc web El par\u00e0metre random el que fa \u00e9s repartir les peticions HTTP que arriben al proxy invers de forma completament aleat\u00f2ria entre el grup de servidors que s'hagi definit en el bloc upstream (en el nostre cas nom\u00e9s hi ha dos). Posarem random perqu\u00e8 \u00e9s el m\u00e9s f\u00e0cil per comprovar que tot funciona b\u00e9 en la pr\u00e0ctica, per\u00f2 hi ha diferents formes de repartir la c\u00e0rrega (les peticions HTTP). Ull! \u00c9s importan que nom\u00e9s webserver1 (antic dnsserver) tinga tots els servicis habilitats Webserver2 i proxy-invers nom\u00e9s han de tindre nginx habilitat. Comprovacions Si accediu a vostre lloc web, heu de poder seguir accedint sense problemes. Comproveu donant-li repetidament a F5, que accediu cada vegada a un dels servidors. Se us mostrar\u00e0 el contingut del index.html del servidor corresponent cada vegada. Per a una doble comprovaci\u00f3, utilitzant les eines de desenvolupador, mostreu que la web que se us mostra coincideix amb la cap\u00e7alera que ha afegit el servidor web en la resposta HTTP. Recordatori Recordeu que \u00e9s molt important que per realitzar aquestes comprovacions tingueu marcat el checkbox \u201cDesactivar cach\u00e9\u201d. Si no marqueu aix\u00f2, la p\u00e0gina es guardar\u00e0 en la mem\u00f2ria cach\u00e9 del navegador i no estareu rebent la resposta del servidor sin\u00f3 de la cach\u00e9 del navegador, la qual cosa pot donar lloc a resultats erronis. Comprovaci\u00f3 del balanceig de c\u00e0rrega quan cau un servidor El nostre balancejador de c\u00e0rrega est\u00e0 constantment monitorizando \u201cla salut\u201d dels servidors web. D'aquesta forma, si un deixa de funcionar per qualsevol ra\u00f3, sempre enviar\u00e0 les sol\u00b7licituds als quals quedin \u201cvius\u201d. Anem a comprovar-ho: Per al servici Nginx en el servidor web 1 i comprova, de la mateixa forma que en l'apartat anterior, que totes les sol\u00b7licituds s'envien ara al servidor web 2 Despr\u00e9s d'iniciar de nou Nginx en el servidor web 1, repeteix el proc\u00e9s amb el servidor web 2. Q\u00fcestions finals Avaluaci\u00f3 Criteri Puntuaci\u00f3 punts punts Comprovaci\u00f3 del correcte funcionament punts Comprovaci\u00f3 del registres del servidor punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Pr\u00e0ctica 4.4 - Balanceig de c\u00e0rrega amb proxy invers en Nginx"},{"location":"section/P4.4/#practica-44-balanceig-de-carrega-amb-proxy-invers-en-nginx","text":"","title":"Pr\u00e0ctica 4.4 \u2013 Balanceig de c\u00e0rrega amb proxy invers en Nginx"},{"location":"section/P4.4/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.3 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.3 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Servidor web 2 172.1.X.X Proxy invers 172.1.X.X ... ...","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P4.4/#introduccio","text":"Els servidors proxy inversos i els balancejadores de c\u00e0rrega s\u00f3n components d'una arquitectura inform\u00e0tica client-servidor. Tots dos actuen com a intermediaris en la comunicaci\u00f3 entre els clients i els servidors, realitzant funcions que milloren l'efici\u00e8ncia. Les definicions b\u00e0siques s\u00f3n simples: Un proxy invers accepta una sol\u00b7licitud d'un client, la reenv\u00eda a un servidor que pot complir-la i retorna la resposta del servidor al client. Un balancejador de c\u00e0rrega distribueix les sol\u00b7licituds entrants del client entre un grup de servidors, en cada cas retornant la resposta del servidor seleccionat al client apropiat. Suenan bastant similars, veritat? Tots dos tipus d'aplicacions se situen entre clients i servidors, acceptant sol\u00b7licituds del primer i lliurant respostes del segon. No \u00e9s d'estranyar que hi hagi confusi\u00f3 sobre qu\u00e8 \u00e9s un proxy invers i un balancejador de c\u00e0rrega. Per ajudar a diferenciar-los, explorem quan i per qu\u00e8 normalment s'implementen en un lloc web.","title":"Introducci\u00f3"},{"location":"section/P4.4/#proxy-invers","text":"Ja coneixem aquest concepte de la pr\u00e0ctica anterior. Mentre que implementar un balancejador de c\u00e0rrega solament t\u00e9 sentit quan es t\u00e9n diversos servidors, sovint t\u00e9 sentit implementar un proxy invers fins i tot amb un sol servidor web o servidor d'aplicacions. Es pot pensar en el proxy invers com la \"cara p\u00fablica\" d'un lloc web. La seva adre\u00e7a \u00e9s la que s'anuncia per al lloc web i es troba a la frontera de la xarxa del lloc per acceptar sol\u00b7licituds de navegadors web i aplicacions m\u00f2bils per al contingut allotjat en el lloc web.","title":"Proxy invers"},{"location":"section/P4.4/#balancejadors-de-carrega","text":"Els balancejadores de c\u00e0rrega s'implementen amb major freq\u00fc\u00e8ncia quan un lloc necessita diversos servidors perqu\u00e8 el volum de sol\u00b7licituds \u00e9s massa perqu\u00e8 un sol servidor ho manegi de manera eficient. La implementaci\u00f3 de diversos servidors tamb\u00e9 elimina un sol punt de falla, la qual cosa fa que el lloc web sigui m\u00e9s confiable. En general, tots els servidors allotgen el mateix contingut, i el treball del balancejador de c\u00e0rrega \u00e9s distribuir la c\u00e0rrega de treball de manera que es faci el millor \u00fas de la capacitat de cada servidor, eviti la sobrec\u00e0rrega en qualsevola de ells i doni com resultat la resposta m\u00e9s r\u00e0pida possible al client. Un balancejador de c\u00e0rrega tamb\u00e9 pot millorar l'experi\u00e8ncia de l'usuari en reduir la quantitat de respostes d'error que veu el client. Ho fa detectant quan els servidors cauen i desviant les sol\u00b7licituds d'ells als altres servidors del grup . En la implementaci\u00f3 m\u00e9s simple, el balancejador de c\u00e0rrega detecta l'estat del servidor en interceptar les respostes d'error a les sol\u00b7licituds regulars. Info En aquesta pr\u00e0ctica tindrem l'escenari on Nginx far\u00e0 tant de proxy invers com de balancejador de c\u00e0rrega al mateix temps.","title":"Balancejadors de c\u00e0rrega"},{"location":"section/P4.4/#tasca","text":"Anem a configurar dos servidors web Nginx amb dues m\u00e0quines Ubuntu Server, a m\u00e9s de reutilitzar el proxy invers Nginx configurat en la pr\u00e0ctica anterior. Partirem per tant de la configuraci\u00f3 de la pr\u00e0ctica anterior, afegint el necessari: Cada servidor web presentar\u00e0 un lloc web espec\u00edfic per a aquesta pr\u00e0ctica El webserver2 ha de tenir la IP assignada de forma fixa mitjan\u00e7ant la configuraci\u00f3 DHCP. Il proxy invers que ja ten\u00edem configurat, hi haur\u00e0 ara que configurar-ho perqu\u00e8 realitzi el balanceig de c\u00e0rrega que desitgem Realitzarem les peticions HTTP des del navegador web del nostre Xubuntu. El diagrama de xarxa quedaria aix\u00ed: Les tres m\u00e0quines estaran a la nostra xarxa interna. Farem les peticions web des del navegador al proxy invers, que les repartir\u00e0 entre els dos servidors web que tenim. Accedirem a http://balanceig i hem d'observar que les peticions, efectivament, es van repartint entre el servidor 1 i el 2.","title":"Tasca"},{"location":"section/P4.4/#configuracions","text":"","title":"Configuracions"},{"location":"section/P4.4/#nginx-servidor-web-1","text":"El primer servidor web ser\u00e0 el servidor principal que hem vingut utilitzant fins ara durant el curs, on tenim instal\u00b7lats ja els servicis DNS, DHCP i Web. Hem de configurar aquest servidor web perqu\u00e8 servicixi el seg\u00fcent index.html que heu de crear dins de la carpeta /var/www/webserver1/html : El nom de l'lloc web que heu d'utilitzar en els arxius corresponents (sites-available\u2026) que heu de crear per Nginx \u00e9s webserver1 , aix\u00ed com en les seues configuracions. Fixeu-vos en les configuracions que vau fer en pr\u00e0ctiques anteriors a manera de refer\u00e8ncia. El lloc web ha d'escoltar en el port 8080. Heu d'afegir una cap\u00e7alera que es crida Serv_Web1_vostrenom .","title":"Nginx Servidor Web 1"},{"location":"section/P4.4/#nginx-servidor-web-2","text":"Ha de ser una m\u00e0quina Ubuntu Server amb tots els servicis parats excepte Nginx. En aquest servidor web hem de realitzar una configuraci\u00f3 id\u00e8ntica al servidor web 1 per\u00f2 canviant webserver1 per webserver2 (tamb\u00e9 en el index.html), aix\u00ed com el nom de la cap\u00e7alera afegida, que ser\u00e0 Serv_Web2_vostrenom Warning \u00c9s important que no quede cap refer\u00e8ncia a webserver1 per cap arxiu, d'una altra forma vos donar\u00e0 resultats erronis i vos dificultar\u00e0 molt trobar l'error.","title":"Nginx Servidor Web 2"},{"location":"section/P4.4/#configuracio-dns","text":"Hem d'afegir dos nous registres a la nostra zona: De pr\u00e0ctiques anteriors existeix un registre en el DNS de tipus CNAME (que fa refer\u00e8ncia al servidor que venim utilitzant des de principi de curs amb tots els servicis) per al nom webserver . Heu de canviar-ho a webserver1 que \u00e9s com es dir\u00e0 ara. Un registre CNAME perqu\u00e8 balancejo sigui un \u00e0lies de proxy-server.dominio.es. , tal com vau fer en la pr\u00e0ctica anterior. Aix\u00f2 permetr\u00e0 que quan accedim via navegador a http://balanceig , el DNS resolgui que la IP d'aquest domini \u00e9s la del proxy invers. ja que webserver2 \u00e9s una m\u00e0quina nova i independent, no podem afegir cap \u00e0lies per a ella. En aquest cas hem d'afegir un registre de tipus A perqu\u00e8 aquest nom apunti a la IP que tingui la m\u00e0quina.","title":"Configuraci\u00f3 DNS"},{"location":"section/P4.4/#nginx-proxy-invers","text":"Ja disposem dels dos servidors web entre els quals es van a repartir les peticions que realitzi el client des del navegador. Anem, per tant, a configurar el proxy invers perqu\u00e8 realitzi aquest repartiment de peticions: En sites-available heu de crear l'arxiu de configuraci\u00f3 amb el nom balanceig Aquest arxiu tindr\u00e0 el seg\u00fcent format: upstream backend_hosts { random; server ________:____; server ________:____; } server { llistin 80; server_name ________; location / { proxy_pass http://backend_hosts; } On: El bloc upstream \u2192 s\u00f3n els servidors entre els quals es va a repartir la c\u00e0rrega, que s\u00f3n els dos que hem configurat anteriorment. Si mireu el diagrama i teniu en compte la configuraci\u00f3 que heu fet fins ara, aqu\u00ed haureu de col\u00b7locar el nom de cada servidor, aix\u00ed com el port on est\u00e0 escoltant les peticions web. A aquest grup de servidors li posem un nom, que \u00e9s backend_hosts Aclaraci\u00f3 En un lloc web, el backend s'encarrega de tots els processos necessaris perqu\u00e8 la web funcioni de forma correcta. Aquests processos o funcions no s\u00f3n visibles, per\u00f2 tenen molta import\u00e0ncia en el bon funcionament d'un lloc web El par\u00e0metre random el que fa \u00e9s repartir les peticions HTTP que arriben al proxy invers de forma completament aleat\u00f2ria entre el grup de servidors que s'hagi definit en el bloc upstream (en el nostre cas nom\u00e9s hi ha dos). Posarem random perqu\u00e8 \u00e9s el m\u00e9s f\u00e0cil per comprovar que tot funciona b\u00e9 en la pr\u00e0ctica, per\u00f2 hi ha diferents formes de repartir la c\u00e0rrega (les peticions HTTP). Ull! \u00c9s importan que nom\u00e9s webserver1 (antic dnsserver) tinga tots els servicis habilitats Webserver2 i proxy-invers nom\u00e9s han de tindre nginx habilitat.","title":"Nginx Proxy Invers"},{"location":"section/P4.4/#comprovacions","text":"Si accediu a vostre lloc web, heu de poder seguir accedint sense problemes. Comproveu donant-li repetidament a F5, que accediu cada vegada a un dels servidors. Se us mostrar\u00e0 el contingut del index.html del servidor corresponent cada vegada. Per a una doble comprovaci\u00f3, utilitzant les eines de desenvolupador, mostreu que la web que se us mostra coincideix amb la cap\u00e7alera que ha afegit el servidor web en la resposta HTTP. Recordatori Recordeu que \u00e9s molt important que per realitzar aquestes comprovacions tingueu marcat el checkbox \u201cDesactivar cach\u00e9\u201d. Si no marqueu aix\u00f2, la p\u00e0gina es guardar\u00e0 en la mem\u00f2ria cach\u00e9 del navegador i no estareu rebent la resposta del servidor sin\u00f3 de la cach\u00e9 del navegador, la qual cosa pot donar lloc a resultats erronis.","title":"Comprovacions"},{"location":"section/P4.4/#comprovacio-del-balanceig-de-carrega-quan-cau-un-servidor","text":"El nostre balancejador de c\u00e0rrega est\u00e0 constantment monitorizando \u201cla salut\u201d dels servidors web. D'aquesta forma, si un deixa de funcionar per qualsevol ra\u00f3, sempre enviar\u00e0 les sol\u00b7licituds als quals quedin \u201cvius\u201d. Anem a comprovar-ho: Per al servici Nginx en el servidor web 1 i comprova, de la mateixa forma que en l'apartat anterior, que totes les sol\u00b7licituds s'envien ara al servidor web 2 Despr\u00e9s d'iniciar de nou Nginx en el servidor web 1, repeteix el proc\u00e9s amb el servidor web 2.","title":"Comprovaci\u00f3 del balanceig de c\u00e0rrega quan cau un servidor"},{"location":"section/P4.4/#questions-finals","text":"","title":"Q\u00fcestions finals"},{"location":"section/P4.4/#avaluacio","text":"Criteri Puntuaci\u00f3 punts punts Comprovaci\u00f3 del correcte funcionament punts Comprovaci\u00f3 del registres del servidor punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Avaluaci\u00f3"},{"location":"section/P4.5/","text":"Practica4.5 - Proxy invers i balanceig de c\u00e0rrega amb SSL en NGINX Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.4 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.3 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Servidor web 2 172.1.X.X Proxy invers 172.1.X.X ... ... Introducci\u00f3 A partir de les pr\u00e0ctiques anteriors hem arribat a un escenari on un proxy invers actua d'intermediari entre dos servidors web Nginx, balancejant la c\u00e0rrega entre ells. Ja vam dir que una important funci\u00f3 que podia tenir un proxy invers era realitzar el xifrat i desxifrat de SSL per utilitzar HTTPS en els servidors web. D'aquesta forma s'alleujava la c\u00e0rrega de treball dels servidors web, ja que \u00e9s una tasca que consumeix recursos. En definitiva, tindr\u00edem un esquema com aquest: Podria arribar-se a pensar que en termes de seguretat no \u00e9s adequat que el tr\u00e0fic de xarxa entre el balanceador de c\u00e0rrega i els servidors web vagi sense xifrar (HTTP). No obstant aix\u00f2, pensant en un cas real, la xarxa privada i el proxy invers/balanceador de c\u00e0rrega, a m\u00e9s d'estar a la mateixa xarxa privada, solen estar administrats per les mateixes persones de la mateixa empresa, per la qual cosa no suposa un perill real que aquest tr\u00e0fic vagi sense xifrar. Podria xifrar-se si fos necessari, per\u00f2 llavors perd sentit que el proxy invers s'encarregui del xifrat SSL para HTTPS, ja que far\u00edem el mateix treball dues vegades. Aix\u00ed les coses, ens quedarem amb l'esquema de la imatge de m\u00e9s amunt per a la pr\u00e0ctica. Certificats HTTPS es basa en l'\u00fas de certificats digitals. Grosso modo, quan entrem en una web via HTTPS, aquesta ens presenta un certificat digital per assegurar que \u00e9s qui diu ser. Com sabem que aquest certificat \u00e9s v\u00e0lid? Hem de consultar a l'Autoritat de Certificaci\u00f3 (CA) que va emetre aquest certificat si \u00e9s v\u00e0lid. Les CA s\u00f3n entitats que emeten certificats i el seu funcionament es basa en la confian\u00e7a. Confiem que els certificats emesos i signats per aquestes entitats s\u00f3n reals i funcionals. Els navegadors web tenen precargadas les Autoritats de Certificaci\u00f3 en les quals confien per defecte a l'hora de navegar per webs HTTPS: Si accedim a una web que el seu certificat no hagi estat em\u00e8s i signat per una d'aquestes entitats, ens saltar\u00e0 el fam\u00f3s av\u00eds: Ja que si el certificat no ha estat em\u00e8s i signat per una CA de confian\u00e7a, pot ser que es tracti d'una web maliciosa que ens suposi un risc de seguretat, com b\u00e9 diu l'av\u00eds. Tasca Partim de la configuraci\u00f3 exacta de la pr\u00e0ctica anterior, que recordem era aquesta: Pel que en aquesta pr\u00e0ctica simplement hem d'afegir la configuraci\u00f3 SSL per al xifrat en el Proxy Invers: Tal com quedar\u00e0 la configuraci\u00f3, des del client encara podr\u00edem accedir als dos servidors web amb HTTP (podeu provar-ho) per\u00f2 \u00e9s alguna cosa que solucionarem en seg\u00fcents temes, configurant un firewall perqu\u00e8 nom\u00e9s la IP del proxy invers pugui accedir per HTTP als servidors web i ning\u00fa m\u00e9s. Creaci\u00f3 del certificat autofirmat Nosaltres no utilitzarem certificats de cap CA de confian\u00e7a, b\u00e0sicament perqu\u00e8: Els nostres servicis no estan publicats en Internet Aquests certificats son de pagament Aix\u00ed doncs, nosaltres crearem els nostres propis certificats i els signarem nosaltres mateixos com si an\u00e9ssim una CA aut\u00e8ntica per poder simular aquest escenari. Warning Aix\u00f2 provocar\u00e0 que quan accedim per HTTPS a nostre lloc web per primera vegada, ens vaig saltar l'av\u00eds de seguretat que es comentava en la introducci\u00f3. En aquest cas no hi haur\u00e0 perill donat que estem 100% segurs de que aquest certificat ho hem em\u00e8s nosaltres per a aquesta pr\u00e0ctica, no hi ha dubtes. Veiem doncs el proc\u00e9s per generar els certificats i les claus associades a ells (privada/p\u00fablica). En primer lloc hem de crear el seg\u00fcent directori: /etc/nginx/ssl/balanceig Podem crear el certificat i les claus de forma simult\u00e0nia amb un \u00fanic comando, on: openssl : aquesta \u00e9s l'eina per l\u00ednia de comandos b\u00e0sica per crear i administrar certificats, claus i altres arxius OpenSSL. req : aquest subcomando s'utilitza per generar una sol\u00b7licitud de certificats i tamb\u00e9 sol\u00b7licituds de signatura de certificats (CSR). -x509 : Aix\u00f2 modifica encara m\u00e9s el subcomando anterior en dir-li a l'eina que volem crear un certificat autofirmat en lloc de generar una sol\u00b7licitud de signatura de certificat, com succeiria normalment. -nodes : Aix\u00f2 li diu a OpenSSL que ometi l'opci\u00f3 d'assegurar el nostre certificat amb contrasenya. Necessitem que Nginx puga llegir l'arxiu sense la intervenci\u00f3 de l'usuari quan s'inicia el servidor. Una contrasenya evitaria que aix\u00f2 pass\u00e9s ja que haur\u00edem de introduir-la a m\u00e0 despr\u00e9s de cada reinici. -days 365 : aquesta opci\u00f3 estableix el temps durant el qual el certificat es considerar\u00e0 v\u00e0lid. Ho configurem pa r a un any. -newkey rsa : 2048 : Aix\u00f2 especifica que volem generar un nou certificat i una nova clau al mateix temps. No vam crear la clau necess\u00e0ria per signar el certificat en un pas anterior, per la qual cosa hem de crear-la juntament amb el certificat. La rsa:2048part li diu que cre\u00ef una clau RSA de 2048 bits de longitud. -keyout : aquest par\u00e0metre li diu a OpenSSL on col\u00b7locar l'arxiu de clau privada generat que estem creant. -out : Aix\u00f2 li diu a OpenSSL on col\u00b7locar el certificat que estem creant. El comando complet seria aix\u00ed: Vos sol\u00b7licitar\u00e0 que introdu\u00efu una s\u00e8rie de par\u00e0metres, com veieu en el requadre vermell de baix de la imatge. Heu d'introduir els mateixos par\u00e0metres que en la imatge excepte en el \u201cOrganizational Unit Name\u201d que veieu en el requadre en groc. Ac\u00ed haureu de posar 2SMR \u2013 SRE - Vostrenom Configuraci\u00f3 SSL en el proxy invers De la pr\u00e0ctica anterior, dins del directori /etc/nginx/sites-available ja heu de tenir l'arxiu de configuraci\u00f3 anomenat \u201cbalanceig\u201d . \u00c9s precisament aqu\u00ed on realitzarem la configuraci\u00f3 perqu\u00e8 l'acc\u00e9s a l'lloc web es realitzi mitjan\u00e7ant SSL (HTTPS). Dins del bloc server {\u2026} heu d'afegir, sense llevar res, les seg\u00fcents l\u00ednies de configuraci\u00f3: On li esteu dient que: Escolti en el port 443 \u2192 Port per defecte d'HTTPS El directori on est\u00e0 el certificat que heu generat anteriorment El directori on est\u00e0 la clau que heu generat anteriorment Els protocols i tipus de xifrats que es poden utilitzar \u2192 Aquestes s\u00f3n les versions de protocols i els tipus de xifrats considerats assegurances a dia d'avui (hi ha molts m\u00e9s per\u00f2 no es consideren assegurances actualment) server_name ja ho ten\u00edeu de la pr\u00e0ctica anterior, no fa mancada tocar-ho L'arxiu on es guarden els logs canvia de nom, ara ser\u00e0 https_access.log. Recordeu que despr\u00e9s de modificar qualsevol configuraci\u00f3 d'un servici, cal reiniciar el servici, en aquest cas Nginx. Comprovacions Si accediu ara a https://balanceig us hauria de saltar un av\u00eds de seguretat a causa que el nostre certificat \u00e9s autofirmat, com coment\u00e0vem anteriorment. Si afegiu una una excepci\u00f3 podreu accedir a l'lloc web i recarregant repetidament la p\u00e0gina amb F5, veureu que el balanceig de c\u00e0rrega es fa correctament accedint mitjan\u00e7ant HTTPS. Per comprovar que les dades del certificat s\u00f3n, efectivament, els vostres podeu comprovar-ho aix\u00ed. Prement en el cadenat de la barra de recerca: Amb m\u00e9s informaci\u00f3: Info Ac\u00ed tamb\u00e9 podreu eliminar l'excepci\u00f3 que heu afegit a la p\u00e0gina de l'advertiment de seguretat, per si necessiteu reiniciar les proves. I finalment, veure certificat: I podrem veure els detalls: Si ara intenteu accedir a http://balanceig , haur\u00edeu de poder accedir? Comproveu-ho i descriviu qu\u00e8 passa i per qu\u00e8. Redirecci\u00f3 for\u00e7osa a HTTPS Perqu\u00e8, indistintament de la forma per la qual accedim a l'lloc web balancejo, sempre es forci a utilitzar HTTPS, necessitarem una configuraci\u00f3 addicional. Necessitem afegir un bloc \u201cserver\u201d addicional i separat de l'altre, a l'arxiu de configuraci\u00f3 de \u201cbalanceig\u201d. Alguna cosa aix\u00ed: Amb aquesta configuraci\u00f3 li estem dient que: Escolti en el port 80 (HTTP) Que el nom al que respondr\u00e0 el servidor/lloc web \u00e9s balanceig Qu\u00e8 guardi els logs d'aquest bloc en aquest directori i amb aquest nom Quan es rep una petici\u00f3 amb les dues condicions anteriors, es retorna un codi HTTP 301: HTTP 301 Moved Permanently (Mogut permanentment en valenci\u00e0) \u00e9s un codi d'estat d'HTTP que indica que el host ha estat capa\u00e7 de comunicar-se amb el servidor per\u00f2 que el recurs sol\u00b7licitat ha estat mogut a una altra adre\u00e7a permanentementeEs molt important configurar les redireccions 301 en els llocs web i per a aix\u00f2 hi ha diferents m\u00e8todes i sintaxis per realitzar la redirecci\u00f3 301. La redirecci\u00f3 301 \u00e9s un codi o comando inserit per un Webmaster que permet redirigir als usuaris i cercadors d'un lloc web d'un lloc a un altre Aclaraci\u00f3 \u00c9s a dir, la qual cosa estem fent \u00e9s que quan es rebi una petici\u00f3 HTTP (port 80) en http://balanceig , es redirigeixi a https://balanceig (HTTPS) Tasca Elimineu de l'altre bloc server{\u2026} la l\u00ednies que facin refer\u00e8ncia a escoltar en el port 80 ( listen 80\u2026 ). Reinicieu el servici Comproveu ara que quan entreu en http://balanceig , autom\u00e0ticament us redirigeix a la versi\u00f3 segura de la web. Comproveu que quan realitzeu una petici\u00f3 en l'arxiu de log http_access.log apareix la redirecci\u00f3 301 i que, de la mateixa manera, apareix una petici\u00f3 GET en https_access.log . Q\u00fcestions finals Avaluaci\u00f3 Criteri Puntuaci\u00f3 punts punts punts punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Practica 4.5 - Proxy invers i balanceig de c\u00e0rrega amb SSL en NGINX"},{"location":"section/P4.5/#practica45-proxy-invers-i-balanceig-de-carrega-amb-ssl-en-nginx","text":"","title":"Practica4.5 - Proxy invers i balanceig de c\u00e0rrega amb SSL en NGINX"},{"location":"section/P4.5/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! La pr\u00e0ctica 4.4 ha d'estar funcionant correctament No comen\u00e7ar la pr\u00e0ctica abans de tenir la 4.3 funcionant i comprovada Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Servidor web 172.1.X.X Servidor web 2 172.1.X.X Proxy invers 172.1.X.X ... ...","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P4.5/#introduccio","text":"A partir de les pr\u00e0ctiques anteriors hem arribat a un escenari on un proxy invers actua d'intermediari entre dos servidors web Nginx, balancejant la c\u00e0rrega entre ells. Ja vam dir que una important funci\u00f3 que podia tenir un proxy invers era realitzar el xifrat i desxifrat de SSL per utilitzar HTTPS en els servidors web. D'aquesta forma s'alleujava la c\u00e0rrega de treball dels servidors web, ja que \u00e9s una tasca que consumeix recursos. En definitiva, tindr\u00edem un esquema com aquest: Podria arribar-se a pensar que en termes de seguretat no \u00e9s adequat que el tr\u00e0fic de xarxa entre el balanceador de c\u00e0rrega i els servidors web vagi sense xifrar (HTTP). No obstant aix\u00f2, pensant en un cas real, la xarxa privada i el proxy invers/balanceador de c\u00e0rrega, a m\u00e9s d'estar a la mateixa xarxa privada, solen estar administrats per les mateixes persones de la mateixa empresa, per la qual cosa no suposa un perill real que aquest tr\u00e0fic vagi sense xifrar. Podria xifrar-se si fos necessari, per\u00f2 llavors perd sentit que el proxy invers s'encarregui del xifrat SSL para HTTPS, ja que far\u00edem el mateix treball dues vegades. Aix\u00ed les coses, ens quedarem amb l'esquema de la imatge de m\u00e9s amunt per a la pr\u00e0ctica.","title":"Introducci\u00f3"},{"location":"section/P4.5/#certificats","text":"HTTPS es basa en l'\u00fas de certificats digitals. Grosso modo, quan entrem en una web via HTTPS, aquesta ens presenta un certificat digital per assegurar que \u00e9s qui diu ser. Com sabem que aquest certificat \u00e9s v\u00e0lid? Hem de consultar a l'Autoritat de Certificaci\u00f3 (CA) que va emetre aquest certificat si \u00e9s v\u00e0lid. Les CA s\u00f3n entitats que emeten certificats i el seu funcionament es basa en la confian\u00e7a. Confiem que els certificats emesos i signats per aquestes entitats s\u00f3n reals i funcionals. Els navegadors web tenen precargadas les Autoritats de Certificaci\u00f3 en les quals confien per defecte a l'hora de navegar per webs HTTPS: Si accedim a una web que el seu certificat no hagi estat em\u00e8s i signat per una d'aquestes entitats, ens saltar\u00e0 el fam\u00f3s av\u00eds: Ja que si el certificat no ha estat em\u00e8s i signat per una CA de confian\u00e7a, pot ser que es tracti d'una web maliciosa que ens suposi un risc de seguretat, com b\u00e9 diu l'av\u00eds.","title":"Certificats"},{"location":"section/P4.5/#tasca","text":"Partim de la configuraci\u00f3 exacta de la pr\u00e0ctica anterior, que recordem era aquesta: Pel que en aquesta pr\u00e0ctica simplement hem d'afegir la configuraci\u00f3 SSL per al xifrat en el Proxy Invers: Tal com quedar\u00e0 la configuraci\u00f3, des del client encara podr\u00edem accedir als dos servidors web amb HTTP (podeu provar-ho) per\u00f2 \u00e9s alguna cosa que solucionarem en seg\u00fcents temes, configurant un firewall perqu\u00e8 nom\u00e9s la IP del proxy invers pugui accedir per HTTP als servidors web i ning\u00fa m\u00e9s.","title":"Tasca"},{"location":"section/P4.5/#creacio-del-certificat-autofirmat","text":"Nosaltres no utilitzarem certificats de cap CA de confian\u00e7a, b\u00e0sicament perqu\u00e8: Els nostres servicis no estan publicats en Internet Aquests certificats son de pagament Aix\u00ed doncs, nosaltres crearem els nostres propis certificats i els signarem nosaltres mateixos com si an\u00e9ssim una CA aut\u00e8ntica per poder simular aquest escenari. Warning Aix\u00f2 provocar\u00e0 que quan accedim per HTTPS a nostre lloc web per primera vegada, ens vaig saltar l'av\u00eds de seguretat que es comentava en la introducci\u00f3. En aquest cas no hi haur\u00e0 perill donat que estem 100% segurs de que aquest certificat ho hem em\u00e8s nosaltres per a aquesta pr\u00e0ctica, no hi ha dubtes. Veiem doncs el proc\u00e9s per generar els certificats i les claus associades a ells (privada/p\u00fablica). En primer lloc hem de crear el seg\u00fcent directori: /etc/nginx/ssl/balanceig Podem crear el certificat i les claus de forma simult\u00e0nia amb un \u00fanic comando, on: openssl : aquesta \u00e9s l'eina per l\u00ednia de comandos b\u00e0sica per crear i administrar certificats, claus i altres arxius OpenSSL. req : aquest subcomando s'utilitza per generar una sol\u00b7licitud de certificats i tamb\u00e9 sol\u00b7licituds de signatura de certificats (CSR). -x509 : Aix\u00f2 modifica encara m\u00e9s el subcomando anterior en dir-li a l'eina que volem crear un certificat autofirmat en lloc de generar una sol\u00b7licitud de signatura de certificat, com succeiria normalment. -nodes : Aix\u00f2 li diu a OpenSSL que ometi l'opci\u00f3 d'assegurar el nostre certificat amb contrasenya. Necessitem que Nginx puga llegir l'arxiu sense la intervenci\u00f3 de l'usuari quan s'inicia el servidor. Una contrasenya evitaria que aix\u00f2 pass\u00e9s ja que haur\u00edem de introduir-la a m\u00e0 despr\u00e9s de cada reinici. -days 365 : aquesta opci\u00f3 estableix el temps durant el qual el certificat es considerar\u00e0 v\u00e0lid. Ho configurem pa r a un any. -newkey rsa : 2048 : Aix\u00f2 especifica que volem generar un nou certificat i una nova clau al mateix temps. No vam crear la clau necess\u00e0ria per signar el certificat en un pas anterior, per la qual cosa hem de crear-la juntament amb el certificat. La rsa:2048part li diu que cre\u00ef una clau RSA de 2048 bits de longitud. -keyout : aquest par\u00e0metre li diu a OpenSSL on col\u00b7locar l'arxiu de clau privada generat que estem creant. -out : Aix\u00f2 li diu a OpenSSL on col\u00b7locar el certificat que estem creant. El comando complet seria aix\u00ed: Vos sol\u00b7licitar\u00e0 que introdu\u00efu una s\u00e8rie de par\u00e0metres, com veieu en el requadre vermell de baix de la imatge. Heu d'introduir els mateixos par\u00e0metres que en la imatge excepte en el \u201cOrganizational Unit Name\u201d que veieu en el requadre en groc. Ac\u00ed haureu de posar 2SMR \u2013 SRE - Vostrenom","title":"Creaci\u00f3 del certificat autofirmat"},{"location":"section/P4.5/#configuracio-ssl-en-el-proxy-invers","text":"De la pr\u00e0ctica anterior, dins del directori /etc/nginx/sites-available ja heu de tenir l'arxiu de configuraci\u00f3 anomenat \u201cbalanceig\u201d . \u00c9s precisament aqu\u00ed on realitzarem la configuraci\u00f3 perqu\u00e8 l'acc\u00e9s a l'lloc web es realitzi mitjan\u00e7ant SSL (HTTPS). Dins del bloc server {\u2026} heu d'afegir, sense llevar res, les seg\u00fcents l\u00ednies de configuraci\u00f3: On li esteu dient que: Escolti en el port 443 \u2192 Port per defecte d'HTTPS El directori on est\u00e0 el certificat que heu generat anteriorment El directori on est\u00e0 la clau que heu generat anteriorment Els protocols i tipus de xifrats que es poden utilitzar \u2192 Aquestes s\u00f3n les versions de protocols i els tipus de xifrats considerats assegurances a dia d'avui (hi ha molts m\u00e9s per\u00f2 no es consideren assegurances actualment) server_name ja ho ten\u00edeu de la pr\u00e0ctica anterior, no fa mancada tocar-ho L'arxiu on es guarden els logs canvia de nom, ara ser\u00e0 https_access.log. Recordeu que despr\u00e9s de modificar qualsevol configuraci\u00f3 d'un servici, cal reiniciar el servici, en aquest cas Nginx.","title":"Configuraci\u00f3 SSL en el proxy invers"},{"location":"section/P4.5/#comprovacions","text":"Si accediu ara a https://balanceig us hauria de saltar un av\u00eds de seguretat a causa que el nostre certificat \u00e9s autofirmat, com coment\u00e0vem anteriorment. Si afegiu una una excepci\u00f3 podreu accedir a l'lloc web i recarregant repetidament la p\u00e0gina amb F5, veureu que el balanceig de c\u00e0rrega es fa correctament accedint mitjan\u00e7ant HTTPS. Per comprovar que les dades del certificat s\u00f3n, efectivament, els vostres podeu comprovar-ho aix\u00ed. Prement en el cadenat de la barra de recerca: Amb m\u00e9s informaci\u00f3: Info Ac\u00ed tamb\u00e9 podreu eliminar l'excepci\u00f3 que heu afegit a la p\u00e0gina de l'advertiment de seguretat, per si necessiteu reiniciar les proves. I finalment, veure certificat: I podrem veure els detalls: Si ara intenteu accedir a http://balanceig , haur\u00edeu de poder accedir? Comproveu-ho i descriviu qu\u00e8 passa i per qu\u00e8.","title":"Comprovacions"},{"location":"section/P4.5/#redireccio-forcosa-a-https","text":"Perqu\u00e8, indistintament de la forma per la qual accedim a l'lloc web balancejo, sempre es forci a utilitzar HTTPS, necessitarem una configuraci\u00f3 addicional. Necessitem afegir un bloc \u201cserver\u201d addicional i separat de l'altre, a l'arxiu de configuraci\u00f3 de \u201cbalanceig\u201d. Alguna cosa aix\u00ed: Amb aquesta configuraci\u00f3 li estem dient que: Escolti en el port 80 (HTTP) Que el nom al que respondr\u00e0 el servidor/lloc web \u00e9s balanceig Qu\u00e8 guardi els logs d'aquest bloc en aquest directori i amb aquest nom Quan es rep una petici\u00f3 amb les dues condicions anteriors, es retorna un codi HTTP 301: HTTP 301 Moved Permanently (Mogut permanentment en valenci\u00e0) \u00e9s un codi d'estat d'HTTP que indica que el host ha estat capa\u00e7 de comunicar-se amb el servidor per\u00f2 que el recurs sol\u00b7licitat ha estat mogut a una altra adre\u00e7a permanentementeEs molt important configurar les redireccions 301 en els llocs web i per a aix\u00f2 hi ha diferents m\u00e8todes i sintaxis per realitzar la redirecci\u00f3 301. La redirecci\u00f3 301 \u00e9s un codi o comando inserit per un Webmaster que permet redirigir als usuaris i cercadors d'un lloc web d'un lloc a un altre Aclaraci\u00f3 \u00c9s a dir, la qual cosa estem fent \u00e9s que quan es rebi una petici\u00f3 HTTP (port 80) en http://balanceig , es redirigeixi a https://balanceig (HTTPS) Tasca Elimineu de l'altre bloc server{\u2026} la l\u00ednies que facin refer\u00e8ncia a escoltar en el port 80 ( listen 80\u2026 ). Reinicieu el servici Comproveu ara que quan entreu en http://balanceig , autom\u00e0ticament us redirigeix a la versi\u00f3 segura de la web. Comproveu que quan realitzeu una petici\u00f3 en l'arxiu de log http_access.log apareix la redirecci\u00f3 301 i que, de la mateixa manera, apareix una petici\u00f3 GET en https_access.log .","title":"Redirecci\u00f3 for\u00e7osa a HTTPS"},{"location":"section/P4.5/#questions-finals","text":"","title":"Q\u00fcestions finals"},{"location":"section/P4.5/#avaluacio","text":"Criteri Puntuaci\u00f3 punts punts punts punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Avaluaci\u00f3"},{"location":"section/P5.1/","text":"Practica 5.1 - Instal\u00b7laci\u00f3 i hardening (bastionat) de servici SSH Requisits abans de comen\u00e7ar la pr\u00e0ctica Atenci\u00f3, molt important abans de comen\u00e7ar! Treballarem sobre l'escenari que ens va quedar al final del tema 4, que si recordeu era un proxy invers i dos servidors web Configurarem el servidor SSH en el proxy invers Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Client SSH 172.1.X.X Servidor SSH 172.1.X.X ... ... Introducci\u00f3 Aprendrem a instal\u00b7lar i a configurar un servici SSH per poder connectar-nos de forma remota. El primer ser\u00e0 configurar una interf\u00edcie addicional en aquest proxy invers. Ser\u00e0 un adaptador de xarxa tipus pont o bridge. Aix\u00f2 ens proporcionar\u00e0 el seg\u00fcent escenari: Quan tot estiga ben configurat, podrem connectar-nos via SSH tant des del client Xubuntu com des de la vostra m\u00e0quina host o f\u00edsica. Aix\u00f2 us proporcionar\u00e0 l'avantatge de poder iniciar el proxy invers amb VirtualBox en format sense pantalla, connectar-vos via SSH i fer les pr\u00e0ctiques directament des del terminal de Lliurex. Aix\u00f2 t\u00e9 avantatges com que deixar\u00e0 copiar i pegar sense problemes. Instal\u00b7laci\u00f3 i configuraci\u00f3 de OpenSSH Instal\u00b7laci\u00f3 Per instal\u00b7lar el nostre servidor SSH no tenim m\u00e9s que: sudo apt install openssh-server Per comprovar l'estat del servici: systemctl status ssh Linux ja ve amb un client SSH preinstal\u00b7lat, per la qual cosa no seria necess\u00e0ria major configuraci\u00f3 en el client. Ja haur\u00edeu de poder connectar-vos de forma remota al proxy invers amb el seg\u00fcent comando: ssh nom_usuari_proxy@IP_proxy Proveu que podeu connectar-vos des del client Xubuntu usant \u00f2bviament la IP de la interf\u00edcie de la xarxa interna del proxy Proveu a connectar-vos per la interf\u00edcie de la LAN del proxy utilitzant el vostre ordinador de classe o de casa (en estar en adaptador pont, estareu a la mateixa xarxa vosaltres i la m\u00e0quina virtual) Per connectar-vos des d'un ordinador amb Windows haureu d'instal\u00b7lar-vos un client SSH com Putty: Client Windows La primera vegada que us connecteu, us apareixer\u00e0 alguna cosa com aix\u00f2: Se'ns est\u00e0 informant que l'equip al que ens estem connectant per SSH podria no ser el nostre o el que pensem que \u00e9s. Per estar 100% segurs, caldria anar al proxy-server, comprovar la seva \u201cpetjada\u201d (fingerprint) que ho identifica i comparar-la amb la qual aqu\u00ed se'ns mostra. At\u00e8s que aix\u00f2 \u00e9s una pr\u00e0ctica acad\u00e8mica, que el nostre escenari \u00e9s molt senzill i podem estar segurs que el proxy-server \u00e9s la nostra m\u00e0quina, simplement li direm \u201cyes\u201d i continuarem la connexi\u00f3. Aquesta acci\u00f3 afegir\u00e0 al proxy-server a l'arxiu known_hosts . Quins arxius de configuraci\u00f3 tinc? /etc/ssh/sshd_config : Arxiu principal de configuraci\u00f3 del servidor SSH (configura el dimoni o servici). /etc/ssh/ssh_config : Arxiu principal de configuraci\u00f3 dels clients SSH. /.ssh/config : Arxiu personal de cada usuari. Cont\u00e9 la configuraci\u00f3 utilitzada pels clients SSH. Permet a l'usuari local utilitzar una configuraci\u00f3 diferent a la definida en l'arxiu /etc/ssh/ssh_config. /.ssh/known_hosts : Arxiu personal de cada usuari. Cont\u00e9 les signatures digitals dels servidors SSH als quals es connecten els clients. Quan aquestes signatures canvien, es poden actualitzar executant el comando ssh-keygen -R, passant el nom de l'amfitri\u00f3 o la IP de l'amfitri\u00f3 com a argument. Aquest comando elimina l'entrada corresponent en l'arxiu /.ssh/known_hosts i, permet afegir de nou a l'amfitri\u00f3 amb una nova signatura digital. /.ssh/authorized_keys : Arxiu personal per a cada usuari. Cont\u00e9 els certificats dels clients SSH, per permetre autenticaci\u00f3 cap a servidors SSH sense requerir contrasenya. Principals directrius de la configuraci\u00f3 Quan parlem de fer hardening d'un servici, ho podr\u00edem traduir com a fortificaci\u00f3 o bastionat. \u00c9s a dir, es configura un servici de tal manera que es protegeix el m\u00e0xim possible de qualsevol fallada o atac a aquest servici. Despr\u00e9s de la instal\u00b7laci\u00f3 procedirem a la configuraci\u00f3 del servidor, per a aix\u00f2, editarem el fitxer de configuraci\u00f3 /etc/ssh/sshd_config . Vegem detalladament les directrius que poden apar\u00e8ixer en aquest arxiu: Directriu Port De forma predeterminada, el servici SSH escolta pel port 22. La directriu per defecte seria: Port 22 Una forma d'elevar la seguretat del servidor SSH, consisteix a canviar el nombre de port predeterminat per un altre que nom\u00e9s l'administrador del sistema conegui. A aquest tipus de t\u00e8cniques se'ls coneix com a seguretat per foscor . Encara que no es considera ni recomanable ni suficient. Els atacants buscaran servidors que estiguin escoltant pel port 22. Canviar de port disminueix considerablement la possibilitat d'una intrusi\u00f3. Directriu ListenAddress De forma predeterminada, el servici SSH escoltar\u00e0 peticions a trav\u00e9s de totes les adrecis IP corresponents a totes les interf\u00edcies de xarxa del sistema. La directriu per defecte seria: ListenAddress 0.0.0.0 Es pot configurar perqu\u00e8 nom\u00e9s escolti per una de les interf\u00edcies. Directriu Protocol Permet indicar qu\u00e8 versi\u00f3 del protocol utilitzar. Ja vam dir que la versi\u00f3 segura avui dia \u00e9s la 2: Protocol 2 Directriu LoginGraceTime En aquesta directriu s'estableix el temps, en segons, durant el qual la pantalla de login estar\u00e0 disponible perqu\u00e8 l'usuari introdueixi el seu nom d'usuari i contrasenya, si no ho fa durant aquest per\u00edode de temps el login es tancar\u00e0, evitant aix\u00ed deixar per temps indeterminat pantalles de login sense que ning\u00fa les usi, o que alg\u00fa est intentant mitjan\u00e7ant un script endevinar un usuari i la seva contrasenya. Si el valor \u00e9s 0, no hi ha l\u00edmit de temps perqu\u00e8 un usuari s'autentiqui, la qual cosa no \u00e9s recomanable ja que d'aquesta forma un atacant podria utilitzar atacs de for\u00e7a bruta o usant m\u00e8todes de diccionari per endevinar la contrasenya, per tant no \u00e9s recomanable deixar aquesta directriu a 0. Directriu PermitRootLogin Probablement sigui la directriu de seguretat m\u00e9s important que podem establir per assegurar el nostre servidor SSH. En els sistemes Unix i Linux es crea per defecte a l'usuari root, amb privilegis de adnimistrador. Molts atacs de for\u00e7a bruta es concentren a atacar a l'usuari root amb l'esperan\u00e7a que tingui una contrasenya feble. Sabent una part de l'equaci\u00f3 (root) solament ser\u00e0 q\u00fcesti\u00f3 de temps perqu\u00e8 alg\u00fa amb paci\u00e8ncia i sort vulneri el sistema. En aquesta directriu deneguem l'acc\u00e9s a l'usuari root i per tant, qualsevol intent d'atac directe a l'usuari root ser\u00e0 in\u00fatil. En denegar l'acc\u00e9s a l'usuari root, cada vegada que necessitem realitzar tasques administratives, accedirem com un usuari normal i una vegada dins, utilitzant algun dels comandos el seu o sudopodrem realitzar aquestes tasques administratives. Per tant, denegant l'acc\u00e9s a l'usuari root, l'atacant haur\u00e0 d'encertar tant el nom d'un usuari del sistema com la seva contrasenya, alguna cosa que disminueix notablement la probabilitat d'una intrusi\u00f3. PermitRootLogin yes/no Directriu StrictModes En aquesta directriu s'estableix que sshd (el servici ssh) revis\u00e9s els modes i permisos dels arxius dels usuaris i el directori $HOME de l'usuari abans d'acceptar la sessi\u00f3. Aix\u00f2 \u00e9s normalment desitjable perqu\u00e8 de vegades alguns usuaris deixen els seus directoris, accidentalment, amb perm\u00eds d'escriptura per a qualsevol. El valor predeterminat \u00e9s yes , per tant, ho deixarem amb el seu valor predeterminat. StrictModes yes/no Directriu MaxAuthTries El valor d'aquesta directriu estableix el m\u00e0xim nombre d'intents d'autenticaci\u00f3 permesos per connexi\u00f3, \u00e9s a dir, la quantitat de vegades que podem equivocar-nos en ingressar l'usuari i/o contrasenya. Una vegada que els intents aconsegueixen la meitat d'aquest valor, les connexions fallides seg\u00fcents seran registrades. Despr\u00e9s del m\u00e0xim nombre d'intents es tancar\u00e0 la connexi\u00f3. \u00c9s possible tornar a intentar-ho, per\u00f2 el l\u00edmit d'intents per vegada evita atacs basats en la persist\u00e8ncia de la connexi\u00f3. MaxAuthTries 5 Directriu MaxStartups El valor d'aquesta directriu estableix el m\u00e0xim nombre de connexions simultaneges de login que permetr\u00e0 el servidor SSH per cada IP que intenti connectar-se. Hi ha atacs molt efectius que divideixen l'atac en una gran quantitat de connexions de login. \u00c9s a dir, l'atacant divideix en una gran quantitat de logins els intents per ingressar, augmentant les seves possibilitats d'endevinar abans a l'usuari i la seva contrasenya. MaxStartups 5 Directriu MaxAuthTries El valor d'aquesta directriu estableix el m\u00e0xim nombre d'intents d'autenticaci\u00f3 permesos per connexi\u00f3, \u00e9s a dir, la quantitat de vegades que podem equivocar-nos en ingressar l'usuari i/o contrasenya. Una vegada que els intents aconsegueixen la meitat d'aquest valor, les connexions fallides seg\u00fcents seran registrades. Despr\u00e9s del m\u00e0xim nombre d'intents es tancar\u00e0 la connexi\u00f3. \u00c9s possible tornar a intentar-ho, per\u00f2 el l\u00edmit d'intents per vegada evita atacs basats en la persist\u00e8ncia de la connexi\u00f3. MaxAuthTries 5 Directriu MaxStartups El valor d'aquesta directriu estableix el m\u00e0xim nombre de connexions simultaneges de login que permetr\u00e0 el servidor SSH per cada IP que intenti connectar-se. Hi ha atacs molt efectius que divideixen l'atac en una gran quantitat de connexions de login. \u00c9s a dir, l'atacant divideix en una gran quantitat de logins els intents per ingressar, augmentant les seves possibilitats d'endevinar abans a l'usuari i la seva contrasenya. MaxStartups 5 Directrius per autenticar amb password La directriu PasswordAuthentication habilita o deshabilita l'autenticaci\u00f3 amb contrasenyes. Per defecte est\u00e0 permesa l'autenticaci\u00f3 amb contrasenya. Si establim el valor no nom\u00e9s es permetr\u00e0 l'acc\u00e9s a trav\u00e9s de signatures digitals . \u00c9s molt important no canviar el valor d'aquesta directriu a no fins a haver instal\u00b7lat la nostra signatura digital. PasswordAuthentication yes/no La directriu PermitEmptyPasswords especifica si es permet l'\u00fas de contrasenyes buides, \u00e9s a dir, autenticar-se sense contrasenya (no recomanable per motius de seguretat). Aquesta directriu \u00e9s v\u00e0lida quan s'usa conjuntament amb PasswordAuthenticacion yes. PermitEmptyPasswords yes/no Directrius per permetre l'\u00fas de X11 La directriu X11Forwarding estableix si es permetr\u00e0 l'execuci\u00f3 remota d'aplicacions gr\u00e0fiques que utilitzin el servidor X11. \u00c9s necessari que el valor estigui establert a yes per poder executar aplicacions gr\u00e0fiques. X11Forwarding yes/no X11DisplayOffset 10 X11UseLocalhost yes/no Directriu AllowUsers Amb aquesta directriu establim que usuaris del sistema poden ingressar via SSH. Solament els usuaris llistats en aquesta directriu podran accedir. AllowUsers raul professor administrador otroprofesor Els usuaris raul, professor, administrador i otroprofesor podran accedir des de qualsevol ordinador, no es valida el host des del qual es connecten. Si es vol m\u00e9s seguretat, \u00e9s possible indicar tamb\u00e9 el host o hosts (des dels quals l'usuari es pot connectar) mitjan\u00e7ant el s\u00edmbol @. Vegem els seg\u00fcents exemples: AllowUsers raul@192.168.10.2 (Solament des de la IP indicada) AllowUsers raul@172.1.1. (Tota la xarxa indicada) AllowUsers raul@.raul.es (Tot el domini indicat) AllowUsers raul@cliXubuntu.raul.es (Solament l'equip del domini indicat) Combinaci\u00f3 de v\u00e0ries: AllowUsers raul@192.168.10.2 professor@172.1.1. administrador@.raul.es otroprofesor Directriu UseDNS Quan un client SSH realitza una connexi\u00f3 cap a un servidor SSH, el servidor intentar\u00e0 resoldre l'adre\u00e7a IP del client. Si el servidor DNS predeterminat del sistema manca d'una zona de resoluci\u00f3 inversa que resolgui un nom per a l'adre\u00e7a IP del client, la connexi\u00f3 es demorar\u00e0 alguns segons m\u00e9s del normal. Podem deshabilitar aquesta directriu per agilitar les connexions SSH en xarxes on es manca de servidors DNS que tinguin zones de reexpedici\u00f3 per resoldre els noms o zones de resoluci\u00f3 inversa per resoldre les adrecis IP dels segments de xarxa local. Ja que nosaltres tenim el nostre DNS on totes els registres de la zona de resoluci\u00f3 directa han de tenir la seva equival\u00e8ncia a la zona de resoluci\u00f3 inversa, ho podem deixar activat. UseDNS yes/no Directriu HostKey Estudiem les seg\u00fcents l\u00ednies: # HostKey for protocol version 1 # HostKey /etc/ssh/ssh_host_key # HostKeys for protocol version 2 # HostKey /etc/ssh/ssh_host_rsa_key # HostKey /etc/ssh/ssh_host_dsa_key # HostKey /etc/ssh/ssh_host_ecdsa_key La directriu HostKey ens indica la ubicaci\u00f3 de les claus p\u00fabliques per al servidor sshd, tant per al protocol SSHv1 i SSHv2 de SSH. Com en el nostre exemple solament usarem el protocol SSHv2, eliminarem (o comentarem) les l\u00ednies corresponents al protocol SSHv1. Si volgu\u00e9ssim usar l'algorismes RSA per a les nostres claus, haur\u00edem de deixar alguna cosa aix\u00ed: # HostKeys for protocol version 2 HostKey /etc/ssh/ssh_host_rsa_key Directriu PrintMotd Aquesta directriu estableix si es presentar\u00e0 o no el missatge del dia (MOTD). El motd de Linux \u00e9s un arxiu que cont\u00e9 un missatge del dia que es mostra a tots els usuaris que es connecten a la m\u00e0quina per terminal. Normalment s'usa per informar als usuaris sobre l'estat del servidor o simplement per donar la benvinguda a la m\u00e0quina. La ruta a l'arxiu \u00e9s /etc/mtod . Es tracta d'un arxiu de text pla el qual podem personalitzar. Cal tenir en compte que si el motd ja est\u00e0 habilitat per als usuaris del sistema, si ho habilitem en /etc/ssh/sshd_config , en iniciar sessi\u00f3 en el servidor SSH, este apareixer\u00e0 duplicat. El motd es mostra despr\u00e9s d'autenticar-nos en el servidor. PrintMotd yes/no Directriu banner Per mitj\u00e0 d'aquesta directriu podem presentar un banner d'acc\u00e9s que ens permetr\u00e0 mostrar un missatge abans de l'autenticaci\u00f3. Ensenyar un cartell d'advertiment exposant temes legals d'un acc\u00e9s no autoritzat. El banner d'acc\u00e9s no \u00e9s m\u00e9s que el contingut d'un fitxer de text pla situat en algun lloc del sistema i que podrem personalitzar al nostre gust. El banner d'acc\u00e9s es presenta abans d'autenticar-nos en el servidor. banner /etc/ssh/ssh_pre-login Directrius de registre d'esdeveniments (logs) El registre d'esdeveniments del servici \u00e9s important aix\u00ed com la ruta on guardar-los, un atacant experimentat intentar\u00e0 netejar els logs per evitar ser atrapat. En aquestes directrius s'especifiquen els par\u00e0metres per al registre d'esdeveniments: SyslogFacility especifica el tipus de registres que generar\u00e0, en aquest cas \u00e9s AUTH, \u00e9s a dir, de les autenticacions que es fan contra el servidor. El par\u00e0metre AUTH \u00e9s el predeterminat. LogLevel amb el valor INFO \u00e9s el valor predeterminat. Altres par\u00e0metres estan especificats a la p\u00e0gina del manual de sshd_config (mansshd_config) , els par\u00e0metres DEBUG2 i DEBUG3 cadascun d'ells especifiquen el nivell m\u00e9s alt de registre. Guardar registres amb el nivell DEBUG viola la privadesa dels usuaris i per tant no \u00e9s recomanable. En el nostre exemple el registre d'esdeveniments quedaria configurat de la seg\u00fcent manera: SyslogFacility AUTH LogLevel INFO Directriu RSAAuthentication Amb aquesta directriu deshabilitem l'autenticaci\u00f3 amb RSA. RSAAuthentication yes/no Directriu PubkeyAuthentication Aquesta directriu especifica l'\u00fas d'autenticaci\u00f3 per mitj\u00e0 de la clau p\u00fablica. PubkeyAuthentication yes/no Directriu AuthorizedKeysFile Aquesta directriu s'usa en conjunt quan s'usa autenticaci\u00f3 per clau p\u00fablica, i especifica on es guarden les claus en el host remot. El valor per defecte \u00e9s /.ssh/authorized_keys aquesta ruta \u00e9s per defecte per al protocol SSHv2 de SSH. AuthorizedKeysFile %h/.ssh/authorized_keys Directriu IgnoreUserKnownHosts Aquesta directriu especifica si s'ignor\u00e9s o no l'\u00fas de l'arxiu /.ssh/known_hosts en el qual s'agreguen les claus dels servidors SSH als quals ens connectem i confiem. Per tant deu estar en no per no ignorar aquest arxiu. IgnoreUserKnownHosts yes/no Directriu AllowTcpForwarding Especifica si es permet fer redireccionamiento de protocols basats en TCP. Permet crear t\u00fanels a connexions de protocols no segurs, enviant la informaci\u00f3 en text pla per un t\u00fanel xifrat. Molt usada en connexions POP3 o IMAP, es recomana deixar-ho per defecte. AllowTcpForwarding yes/no Directriu PrintLastLog Aqu\u00ed s'especifica si es mostrar\u00e0 un missatge mostrant l'adre\u00e7a IP d'on es va conectar l'usuari la ultima vegada. Molt \u00fatil per saber si alg\u00fa m\u00e9s s'est\u00e0 connectant amb un usuari en concret. PrintLastLog yes/no Directriu TCPKeepAlive Ens indica que el servidor sshd enviar\u00e0 missatges de keepalive al client despr\u00e9s que detecta alguna inactivitat. Aquest m\u00e8tode pot ser explotat per t\u00e8cniques de spoofing. TCPKeepAlive yes/no Directriu UsePrivilegeSeparation Significa que despr\u00e9s que la sessi\u00f3 SSH s'ha establert es passessin els privilegis d'aquest proc\u00e9s a l'usuari de qui inici\u00ef la connexi\u00f3, si es deshabilita, el proc\u00e9s estar\u00e0 a nom de root. Molt important per evitar escalada de privilegis. UsePrivilegeSeparation yes/no Directriu ClientAliveInterval Aquesta directriu especifica l'interval de temps en segons en el qual despr\u00e9s que no s'ha rebut cap dada del client, sshd envi\u00e9s un missatge a trav\u00e9s del canal xifrat per requerir una resposta del client, el valor predeterminat \u00e9s 0, el qual significa que no s'envia tal missatge. Aquesta opci\u00f3 nom\u00e9s s'aplica al protocol SSHv2. \u00c9s \u00fatil quan es t\u00e9 una connexi\u00f3 intermitent i es requereix que la sessi\u00f3 estigui oberta sense que es tanqui la sessi\u00f3. ClientAliveInterval 0 Directriu ClientAliveCountMax Ens indica les vegades que el servidor sshd enviar\u00e0 missatges keepalive quan el client est\u00e0 inactiu. Si el client no envia cap resposta, llavors el servidor acab\u00e9s la connexi\u00f3 i per tant la sessi\u00f3. Si tenim connexions intermitents \u00e9s recomanable pujar el numero a aquest valor. Cal tenir en compte que aquesta opci\u00f3 \u00e9s diferent a l'opci\u00f3 TCPKeepAlive, aquests missatges s\u00f3n enviats a trav\u00e9s del canal xifrat, per tant no pot ser explotat per t\u00e8cniques de spoofing com el TCPKeepAlive. ClientAliveCountMax 3 Directriu PidFile Aquesta opcion estableix el nom i ruta de l'arxiu on es guarda l'identificador de proc\u00e9s (pid) de sshd. PidFile /var/run/sshd.pid Directriu Subsystem Aquesta opci\u00f3 el que fa \u00e9s iniciar el servidor sftp-server el qual \u00e9s un substitut per a un servidor FTP, per\u00f2 la comunicaci\u00f3 \u00e9s segura, ja que es fa per un canal xifrat. Subsystem sftp /usr/libexec/sftp-server Directriu PermitBlacklistedKeys Si aquesta directriu s'estableix a yes permetr\u00e0 fer login amb claus en llista negra. PermitBlacklistedKeys yes/no Directriu IgnoreRhosts i RhostsRSAAuthentication Amb aquestes directrius deneguem l'\u00fas de relacions de confian\u00e7a establertes en els fitxers /.rhosts i /.shosts dels usuaris: IgnoreRhosts yes/no RhostsRSAAuthentication yes/no Directriu HostbasedAuthentication Deshabilitar o habilitar autenticaci\u00f3 basada en host. HostbasedAuthentication yes/no Directriu UsePAM Si utilitzem claus no necessitem PAM (M\u00f2duls d'autenticaci\u00f3 Conectables) i permetem a sshd funcionar com un usuari no root. Bastionat/hardening/fortificaci\u00f3 del servici SSH Av\u00eds Totes les comprovacions les heu de fer tant des de l'ordinador amfitri\u00f3, usant la IP de la LAN del servidor, com des del client Xubuntu, usant el nom del DNS. Q\u00fcestions finals Avaluaci\u00f3 Criteri Puntuaci\u00f3 punts punts punts punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Practica 5.1 - Instal\u00b7laci\u00f3 i hardening (bastionat) de servici SSH"},{"location":"section/P5.1/#practica-51-installacio-i-hardening-bastionat-de-servici-ssh","text":"","title":"Practica 5.1 - Instal\u00b7laci\u00f3 i hardening (bastionat) de servici SSH"},{"location":"section/P5.1/#requisits-abans-de-comencar-la-practica","text":"Atenci\u00f3, molt important abans de comen\u00e7ar! Treballarem sobre l'escenari que ens va quedar al final del tema 4, que si recordeu era un proxy invers i dos servidors web Configurarem el servidor SSH en el proxy invers Nota - Descripci\u00f3 de les m\u00e0quines Heu de posar al principi de l'informe de la pr\u00e0ctica aquest apartat, indicant qu\u00e8 m\u00e0quines heu utilitzat en la pr\u00e0ctica i amb quines IPs: M\u00e0quina IP Client SSH 172.1.X.X Servidor SSH 172.1.X.X ... ...","title":"Requisits abans de comen\u00e7ar la pr\u00e0ctica"},{"location":"section/P5.1/#introduccio","text":"Aprendrem a instal\u00b7lar i a configurar un servici SSH per poder connectar-nos de forma remota. El primer ser\u00e0 configurar una interf\u00edcie addicional en aquest proxy invers. Ser\u00e0 un adaptador de xarxa tipus pont o bridge. Aix\u00f2 ens proporcionar\u00e0 el seg\u00fcent escenari: Quan tot estiga ben configurat, podrem connectar-nos via SSH tant des del client Xubuntu com des de la vostra m\u00e0quina host o f\u00edsica. Aix\u00f2 us proporcionar\u00e0 l'avantatge de poder iniciar el proxy invers amb VirtualBox en format sense pantalla, connectar-vos via SSH i fer les pr\u00e0ctiques directament des del terminal de Lliurex. Aix\u00f2 t\u00e9 avantatges com que deixar\u00e0 copiar i pegar sense problemes.","title":"Introducci\u00f3"},{"location":"section/P5.1/#installacio-i-configuracio-de-openssh","text":"","title":"Instal\u00b7laci\u00f3 i configuraci\u00f3 de OpenSSH"},{"location":"section/P5.1/#installacio","text":"Per instal\u00b7lar el nostre servidor SSH no tenim m\u00e9s que: sudo apt install openssh-server Per comprovar l'estat del servici: systemctl status ssh Linux ja ve amb un client SSH preinstal\u00b7lat, per la qual cosa no seria necess\u00e0ria major configuraci\u00f3 en el client. Ja haur\u00edeu de poder connectar-vos de forma remota al proxy invers amb el seg\u00fcent comando: ssh nom_usuari_proxy@IP_proxy Proveu que podeu connectar-vos des del client Xubuntu usant \u00f2bviament la IP de la interf\u00edcie de la xarxa interna del proxy Proveu a connectar-vos per la interf\u00edcie de la LAN del proxy utilitzant el vostre ordinador de classe o de casa (en estar en adaptador pont, estareu a la mateixa xarxa vosaltres i la m\u00e0quina virtual) Per connectar-vos des d'un ordinador amb Windows haureu d'instal\u00b7lar-vos un client SSH com Putty: Client Windows La primera vegada que us connecteu, us apareixer\u00e0 alguna cosa com aix\u00f2: Se'ns est\u00e0 informant que l'equip al que ens estem connectant per SSH podria no ser el nostre o el que pensem que \u00e9s. Per estar 100% segurs, caldria anar al proxy-server, comprovar la seva \u201cpetjada\u201d (fingerprint) que ho identifica i comparar-la amb la qual aqu\u00ed se'ns mostra. At\u00e8s que aix\u00f2 \u00e9s una pr\u00e0ctica acad\u00e8mica, que el nostre escenari \u00e9s molt senzill i podem estar segurs que el proxy-server \u00e9s la nostra m\u00e0quina, simplement li direm \u201cyes\u201d i continuarem la connexi\u00f3. Aquesta acci\u00f3 afegir\u00e0 al proxy-server a l'arxiu known_hosts .","title":"Instal\u00b7laci\u00f3"},{"location":"section/P5.1/#quins-arxius-de-configuracio-tinc","text":"/etc/ssh/sshd_config : Arxiu principal de configuraci\u00f3 del servidor SSH (configura el dimoni o servici). /etc/ssh/ssh_config : Arxiu principal de configuraci\u00f3 dels clients SSH. /.ssh/config : Arxiu personal de cada usuari. Cont\u00e9 la configuraci\u00f3 utilitzada pels clients SSH. Permet a l'usuari local utilitzar una configuraci\u00f3 diferent a la definida en l'arxiu /etc/ssh/ssh_config. /.ssh/known_hosts : Arxiu personal de cada usuari. Cont\u00e9 les signatures digitals dels servidors SSH als quals es connecten els clients. Quan aquestes signatures canvien, es poden actualitzar executant el comando ssh-keygen -R, passant el nom de l'amfitri\u00f3 o la IP de l'amfitri\u00f3 com a argument. Aquest comando elimina l'entrada corresponent en l'arxiu /.ssh/known_hosts i, permet afegir de nou a l'amfitri\u00f3 amb una nova signatura digital. /.ssh/authorized_keys : Arxiu personal per a cada usuari. Cont\u00e9 els certificats dels clients SSH, per permetre autenticaci\u00f3 cap a servidors SSH sense requerir contrasenya.","title":"Quins arxius de configuraci\u00f3 tinc?"},{"location":"section/P5.1/#principals-directrius-de-la-configuracio","text":"Quan parlem de fer hardening d'un servici, ho podr\u00edem traduir com a fortificaci\u00f3 o bastionat. \u00c9s a dir, es configura un servici de tal manera que es protegeix el m\u00e0xim possible de qualsevol fallada o atac a aquest servici. Despr\u00e9s de la instal\u00b7laci\u00f3 procedirem a la configuraci\u00f3 del servidor, per a aix\u00f2, editarem el fitxer de configuraci\u00f3 /etc/ssh/sshd_config . Vegem detalladament les directrius que poden apar\u00e8ixer en aquest arxiu:","title":"Principals directrius de la configuraci\u00f3"},{"location":"section/P5.1/#directriu-port","text":"De forma predeterminada, el servici SSH escolta pel port 22. La directriu per defecte seria: Port 22 Una forma d'elevar la seguretat del servidor SSH, consisteix a canviar el nombre de port predeterminat per un altre que nom\u00e9s l'administrador del sistema conegui. A aquest tipus de t\u00e8cniques se'ls coneix com a seguretat per foscor . Encara que no es considera ni recomanable ni suficient. Els atacants buscaran servidors que estiguin escoltant pel port 22. Canviar de port disminueix considerablement la possibilitat d'una intrusi\u00f3.","title":"Directriu Port"},{"location":"section/P5.1/#directriu-listenaddress","text":"De forma predeterminada, el servici SSH escoltar\u00e0 peticions a trav\u00e9s de totes les adrecis IP corresponents a totes les interf\u00edcies de xarxa del sistema. La directriu per defecte seria: ListenAddress 0.0.0.0 Es pot configurar perqu\u00e8 nom\u00e9s escolti per una de les interf\u00edcies.","title":"Directriu ListenAddress"},{"location":"section/P5.1/#directriu-protocol","text":"Permet indicar qu\u00e8 versi\u00f3 del protocol utilitzar. Ja vam dir que la versi\u00f3 segura avui dia \u00e9s la 2: Protocol 2","title":"Directriu Protocol"},{"location":"section/P5.1/#directriu-logingracetime","text":"En aquesta directriu s'estableix el temps, en segons, durant el qual la pantalla de login estar\u00e0 disponible perqu\u00e8 l'usuari introdueixi el seu nom d'usuari i contrasenya, si no ho fa durant aquest per\u00edode de temps el login es tancar\u00e0, evitant aix\u00ed deixar per temps indeterminat pantalles de login sense que ning\u00fa les usi, o que alg\u00fa est intentant mitjan\u00e7ant un script endevinar un usuari i la seva contrasenya. Si el valor \u00e9s 0, no hi ha l\u00edmit de temps perqu\u00e8 un usuari s'autentiqui, la qual cosa no \u00e9s recomanable ja que d'aquesta forma un atacant podria utilitzar atacs de for\u00e7a bruta o usant m\u00e8todes de diccionari per endevinar la contrasenya, per tant no \u00e9s recomanable deixar aquesta directriu a 0.","title":"Directriu LoginGraceTime"},{"location":"section/P5.1/#directriu-permitrootlogin","text":"Probablement sigui la directriu de seguretat m\u00e9s important que podem establir per assegurar el nostre servidor SSH. En els sistemes Unix i Linux es crea per defecte a l'usuari root, amb privilegis de adnimistrador. Molts atacs de for\u00e7a bruta es concentren a atacar a l'usuari root amb l'esperan\u00e7a que tingui una contrasenya feble. Sabent una part de l'equaci\u00f3 (root) solament ser\u00e0 q\u00fcesti\u00f3 de temps perqu\u00e8 alg\u00fa amb paci\u00e8ncia i sort vulneri el sistema. En aquesta directriu deneguem l'acc\u00e9s a l'usuari root i per tant, qualsevol intent d'atac directe a l'usuari root ser\u00e0 in\u00fatil. En denegar l'acc\u00e9s a l'usuari root, cada vegada que necessitem realitzar tasques administratives, accedirem com un usuari normal i una vegada dins, utilitzant algun dels comandos el seu o sudopodrem realitzar aquestes tasques administratives. Per tant, denegant l'acc\u00e9s a l'usuari root, l'atacant haur\u00e0 d'encertar tant el nom d'un usuari del sistema com la seva contrasenya, alguna cosa que disminueix notablement la probabilitat d'una intrusi\u00f3. PermitRootLogin yes/no","title":"Directriu PermitRootLogin"},{"location":"section/P5.1/#directriu-strictmodes","text":"En aquesta directriu s'estableix que sshd (el servici ssh) revis\u00e9s els modes i permisos dels arxius dels usuaris i el directori $HOME de l'usuari abans d'acceptar la sessi\u00f3. Aix\u00f2 \u00e9s normalment desitjable perqu\u00e8 de vegades alguns usuaris deixen els seus directoris, accidentalment, amb perm\u00eds d'escriptura per a qualsevol. El valor predeterminat \u00e9s yes , per tant, ho deixarem amb el seu valor predeterminat. StrictModes yes/no","title":"Directriu StrictModes"},{"location":"section/P5.1/#directriu-maxauthtries","text":"El valor d'aquesta directriu estableix el m\u00e0xim nombre d'intents d'autenticaci\u00f3 permesos per connexi\u00f3, \u00e9s a dir, la quantitat de vegades que podem equivocar-nos en ingressar l'usuari i/o contrasenya. Una vegada que els intents aconsegueixen la meitat d'aquest valor, les connexions fallides seg\u00fcents seran registrades. Despr\u00e9s del m\u00e0xim nombre d'intents es tancar\u00e0 la connexi\u00f3. \u00c9s possible tornar a intentar-ho, per\u00f2 el l\u00edmit d'intents per vegada evita atacs basats en la persist\u00e8ncia de la connexi\u00f3. MaxAuthTries 5","title":"Directriu MaxAuthTries"},{"location":"section/P5.1/#directriu-maxstartups","text":"El valor d'aquesta directriu estableix el m\u00e0xim nombre de connexions simultaneges de login que permetr\u00e0 el servidor SSH per cada IP que intenti connectar-se. Hi ha atacs molt efectius que divideixen l'atac en una gran quantitat de connexions de login. \u00c9s a dir, l'atacant divideix en una gran quantitat de logins els intents per ingressar, augmentant les seves possibilitats d'endevinar abans a l'usuari i la seva contrasenya. MaxStartups 5","title":"Directriu MaxStartups"},{"location":"section/P5.1/#directriu-maxauthtries_1","text":"El valor d'aquesta directriu estableix el m\u00e0xim nombre d'intents d'autenticaci\u00f3 permesos per connexi\u00f3, \u00e9s a dir, la quantitat de vegades que podem equivocar-nos en ingressar l'usuari i/o contrasenya. Una vegada que els intents aconsegueixen la meitat d'aquest valor, les connexions fallides seg\u00fcents seran registrades. Despr\u00e9s del m\u00e0xim nombre d'intents es tancar\u00e0 la connexi\u00f3. \u00c9s possible tornar a intentar-ho, per\u00f2 el l\u00edmit d'intents per vegada evita atacs basats en la persist\u00e8ncia de la connexi\u00f3. MaxAuthTries 5","title":"Directriu MaxAuthTries"},{"location":"section/P5.1/#directriu-maxstartups_1","text":"El valor d'aquesta directriu estableix el m\u00e0xim nombre de connexions simultaneges de login que permetr\u00e0 el servidor SSH per cada IP que intenti connectar-se. Hi ha atacs molt efectius que divideixen l'atac en una gran quantitat de connexions de login. \u00c9s a dir, l'atacant divideix en una gran quantitat de logins els intents per ingressar, augmentant les seves possibilitats d'endevinar abans a l'usuari i la seva contrasenya. MaxStartups 5","title":"Directriu MaxStartups"},{"location":"section/P5.1/#directrius-per-autenticar-amb-password","text":"La directriu PasswordAuthentication habilita o deshabilita l'autenticaci\u00f3 amb contrasenyes. Per defecte est\u00e0 permesa l'autenticaci\u00f3 amb contrasenya. Si establim el valor no nom\u00e9s es permetr\u00e0 l'acc\u00e9s a trav\u00e9s de signatures digitals . \u00c9s molt important no canviar el valor d'aquesta directriu a no fins a haver instal\u00b7lat la nostra signatura digital. PasswordAuthentication yes/no La directriu PermitEmptyPasswords especifica si es permet l'\u00fas de contrasenyes buides, \u00e9s a dir, autenticar-se sense contrasenya (no recomanable per motius de seguretat). Aquesta directriu \u00e9s v\u00e0lida quan s'usa conjuntament amb PasswordAuthenticacion yes. PermitEmptyPasswords yes/no","title":"Directrius per autenticar amb password"},{"location":"section/P5.1/#directrius-per-permetre-lus-de-x11","text":"La directriu X11Forwarding estableix si es permetr\u00e0 l'execuci\u00f3 remota d'aplicacions gr\u00e0fiques que utilitzin el servidor X11. \u00c9s necessari que el valor estigui establert a yes per poder executar aplicacions gr\u00e0fiques. X11Forwarding yes/no X11DisplayOffset 10 X11UseLocalhost yes/no","title":"Directrius per permetre l'\u00fas de X11"},{"location":"section/P5.1/#directriu-allowusers","text":"Amb aquesta directriu establim que usuaris del sistema poden ingressar via SSH. Solament els usuaris llistats en aquesta directriu podran accedir. AllowUsers raul professor administrador otroprofesor Els usuaris raul, professor, administrador i otroprofesor podran accedir des de qualsevol ordinador, no es valida el host des del qual es connecten. Si es vol m\u00e9s seguretat, \u00e9s possible indicar tamb\u00e9 el host o hosts (des dels quals l'usuari es pot connectar) mitjan\u00e7ant el s\u00edmbol @. Vegem els seg\u00fcents exemples: AllowUsers raul@192.168.10.2 (Solament des de la IP indicada) AllowUsers raul@172.1.1. (Tota la xarxa indicada) AllowUsers raul@.raul.es (Tot el domini indicat) AllowUsers raul@cliXubuntu.raul.es (Solament l'equip del domini indicat) Combinaci\u00f3 de v\u00e0ries: AllowUsers raul@192.168.10.2 professor@172.1.1. administrador@.raul.es otroprofesor","title":"Directriu AllowUsers"},{"location":"section/P5.1/#directriu-usedns","text":"Quan un client SSH realitza una connexi\u00f3 cap a un servidor SSH, el servidor intentar\u00e0 resoldre l'adre\u00e7a IP del client. Si el servidor DNS predeterminat del sistema manca d'una zona de resoluci\u00f3 inversa que resolgui un nom per a l'adre\u00e7a IP del client, la connexi\u00f3 es demorar\u00e0 alguns segons m\u00e9s del normal. Podem deshabilitar aquesta directriu per agilitar les connexions SSH en xarxes on es manca de servidors DNS que tinguin zones de reexpedici\u00f3 per resoldre els noms o zones de resoluci\u00f3 inversa per resoldre les adrecis IP dels segments de xarxa local. Ja que nosaltres tenim el nostre DNS on totes els registres de la zona de resoluci\u00f3 directa han de tenir la seva equival\u00e8ncia a la zona de resoluci\u00f3 inversa, ho podem deixar activat. UseDNS yes/no","title":"Directriu UseDNS"},{"location":"section/P5.1/#directriu-hostkey","text":"Estudiem les seg\u00fcents l\u00ednies: # HostKey for protocol version 1 # HostKey /etc/ssh/ssh_host_key # HostKeys for protocol version 2 # HostKey /etc/ssh/ssh_host_rsa_key # HostKey /etc/ssh/ssh_host_dsa_key # HostKey /etc/ssh/ssh_host_ecdsa_key La directriu HostKey ens indica la ubicaci\u00f3 de les claus p\u00fabliques per al servidor sshd, tant per al protocol SSHv1 i SSHv2 de SSH. Com en el nostre exemple solament usarem el protocol SSHv2, eliminarem (o comentarem) les l\u00ednies corresponents al protocol SSHv1. Si volgu\u00e9ssim usar l'algorismes RSA per a les nostres claus, haur\u00edem de deixar alguna cosa aix\u00ed: # HostKeys for protocol version 2 HostKey /etc/ssh/ssh_host_rsa_key","title":"Directriu HostKey"},{"location":"section/P5.1/#directriu-printmotd","text":"Aquesta directriu estableix si es presentar\u00e0 o no el missatge del dia (MOTD). El motd de Linux \u00e9s un arxiu que cont\u00e9 un missatge del dia que es mostra a tots els usuaris que es connecten a la m\u00e0quina per terminal. Normalment s'usa per informar als usuaris sobre l'estat del servidor o simplement per donar la benvinguda a la m\u00e0quina. La ruta a l'arxiu \u00e9s /etc/mtod . Es tracta d'un arxiu de text pla el qual podem personalitzar. Cal tenir en compte que si el motd ja est\u00e0 habilitat per als usuaris del sistema, si ho habilitem en /etc/ssh/sshd_config , en iniciar sessi\u00f3 en el servidor SSH, este apareixer\u00e0 duplicat. El motd es mostra despr\u00e9s d'autenticar-nos en el servidor. PrintMotd yes/no","title":"Directriu PrintMotd"},{"location":"section/P5.1/#directriu-banner","text":"Per mitj\u00e0 d'aquesta directriu podem presentar un banner d'acc\u00e9s que ens permetr\u00e0 mostrar un missatge abans de l'autenticaci\u00f3. Ensenyar un cartell d'advertiment exposant temes legals d'un acc\u00e9s no autoritzat. El banner d'acc\u00e9s no \u00e9s m\u00e9s que el contingut d'un fitxer de text pla situat en algun lloc del sistema i que podrem personalitzar al nostre gust. El banner d'acc\u00e9s es presenta abans d'autenticar-nos en el servidor. banner /etc/ssh/ssh_pre-login","title":"Directriu banner"},{"location":"section/P5.1/#directrius-de-registre-desdeveniments-logs","text":"El registre d'esdeveniments del servici \u00e9s important aix\u00ed com la ruta on guardar-los, un atacant experimentat intentar\u00e0 netejar els logs per evitar ser atrapat. En aquestes directrius s'especifiquen els par\u00e0metres per al registre d'esdeveniments: SyslogFacility especifica el tipus de registres que generar\u00e0, en aquest cas \u00e9s AUTH, \u00e9s a dir, de les autenticacions que es fan contra el servidor. El par\u00e0metre AUTH \u00e9s el predeterminat. LogLevel amb el valor INFO \u00e9s el valor predeterminat. Altres par\u00e0metres estan especificats a la p\u00e0gina del manual de sshd_config (mansshd_config) , els par\u00e0metres DEBUG2 i DEBUG3 cadascun d'ells especifiquen el nivell m\u00e9s alt de registre. Guardar registres amb el nivell DEBUG viola la privadesa dels usuaris i per tant no \u00e9s recomanable. En el nostre exemple el registre d'esdeveniments quedaria configurat de la seg\u00fcent manera: SyslogFacility AUTH LogLevel INFO","title":"Directrius de registre d'esdeveniments (logs)"},{"location":"section/P5.1/#directriu-rsaauthentication","text":"Amb aquesta directriu deshabilitem l'autenticaci\u00f3 amb RSA. RSAAuthentication yes/no","title":"Directriu RSAAuthentication"},{"location":"section/P5.1/#directriu-pubkeyauthentication","text":"Aquesta directriu especifica l'\u00fas d'autenticaci\u00f3 per mitj\u00e0 de la clau p\u00fablica. PubkeyAuthentication yes/no","title":"Directriu PubkeyAuthentication"},{"location":"section/P5.1/#directriu-authorizedkeysfile","text":"Aquesta directriu s'usa en conjunt quan s'usa autenticaci\u00f3 per clau p\u00fablica, i especifica on es guarden les claus en el host remot. El valor per defecte \u00e9s /.ssh/authorized_keys aquesta ruta \u00e9s per defecte per al protocol SSHv2 de SSH. AuthorizedKeysFile %h/.ssh/authorized_keys","title":"Directriu AuthorizedKeysFile"},{"location":"section/P5.1/#directriu-ignoreuserknownhosts","text":"Aquesta directriu especifica si s'ignor\u00e9s o no l'\u00fas de l'arxiu /.ssh/known_hosts en el qual s'agreguen les claus dels servidors SSH als quals ens connectem i confiem. Per tant deu estar en no per no ignorar aquest arxiu. IgnoreUserKnownHosts yes/no","title":"Directriu IgnoreUserKnownHosts"},{"location":"section/P5.1/#directriu-allowtcpforwarding","text":"Especifica si es permet fer redireccionamiento de protocols basats en TCP. Permet crear t\u00fanels a connexions de protocols no segurs, enviant la informaci\u00f3 en text pla per un t\u00fanel xifrat. Molt usada en connexions POP3 o IMAP, es recomana deixar-ho per defecte. AllowTcpForwarding yes/no","title":"Directriu AllowTcpForwarding"},{"location":"section/P5.1/#directriu-printlastlog","text":"Aqu\u00ed s'especifica si es mostrar\u00e0 un missatge mostrant l'adre\u00e7a IP d'on es va conectar l'usuari la ultima vegada. Molt \u00fatil per saber si alg\u00fa m\u00e9s s'est\u00e0 connectant amb un usuari en concret. PrintLastLog yes/no","title":"Directriu PrintLastLog"},{"location":"section/P5.1/#directriu-tcpkeepalive","text":"Ens indica que el servidor sshd enviar\u00e0 missatges de keepalive al client despr\u00e9s que detecta alguna inactivitat. Aquest m\u00e8tode pot ser explotat per t\u00e8cniques de spoofing. TCPKeepAlive yes/no","title":"Directriu TCPKeepAlive"},{"location":"section/P5.1/#directriu-useprivilegeseparation","text":"Significa que despr\u00e9s que la sessi\u00f3 SSH s'ha establert es passessin els privilegis d'aquest proc\u00e9s a l'usuari de qui inici\u00ef la connexi\u00f3, si es deshabilita, el proc\u00e9s estar\u00e0 a nom de root. Molt important per evitar escalada de privilegis. UsePrivilegeSeparation yes/no","title":"Directriu UsePrivilegeSeparation"},{"location":"section/P5.1/#directriu-clientaliveinterval","text":"Aquesta directriu especifica l'interval de temps en segons en el qual despr\u00e9s que no s'ha rebut cap dada del client, sshd envi\u00e9s un missatge a trav\u00e9s del canal xifrat per requerir una resposta del client, el valor predeterminat \u00e9s 0, el qual significa que no s'envia tal missatge. Aquesta opci\u00f3 nom\u00e9s s'aplica al protocol SSHv2. \u00c9s \u00fatil quan es t\u00e9 una connexi\u00f3 intermitent i es requereix que la sessi\u00f3 estigui oberta sense que es tanqui la sessi\u00f3. ClientAliveInterval 0","title":"Directriu ClientAliveInterval"},{"location":"section/P5.1/#directriu-clientalivecountmax","text":"Ens indica les vegades que el servidor sshd enviar\u00e0 missatges keepalive quan el client est\u00e0 inactiu. Si el client no envia cap resposta, llavors el servidor acab\u00e9s la connexi\u00f3 i per tant la sessi\u00f3. Si tenim connexions intermitents \u00e9s recomanable pujar el numero a aquest valor. Cal tenir en compte que aquesta opci\u00f3 \u00e9s diferent a l'opci\u00f3 TCPKeepAlive, aquests missatges s\u00f3n enviats a trav\u00e9s del canal xifrat, per tant no pot ser explotat per t\u00e8cniques de spoofing com el TCPKeepAlive. ClientAliveCountMax 3","title":"Directriu ClientAliveCountMax"},{"location":"section/P5.1/#directriu-pidfile","text":"Aquesta opcion estableix el nom i ruta de l'arxiu on es guarda l'identificador de proc\u00e9s (pid) de sshd. PidFile /var/run/sshd.pid","title":"Directriu PidFile"},{"location":"section/P5.1/#directriu-subsystem","text":"Aquesta opci\u00f3 el que fa \u00e9s iniciar el servidor sftp-server el qual \u00e9s un substitut per a un servidor FTP, per\u00f2 la comunicaci\u00f3 \u00e9s segura, ja que es fa per un canal xifrat. Subsystem sftp /usr/libexec/sftp-server","title":"Directriu Subsystem"},{"location":"section/P5.1/#directriu-permitblacklistedkeys","text":"Si aquesta directriu s'estableix a yes permetr\u00e0 fer login amb claus en llista negra. PermitBlacklistedKeys yes/no","title":"Directriu PermitBlacklistedKeys"},{"location":"section/P5.1/#directriu-ignorerhosts-i-rhostsrsaauthentication","text":"Amb aquestes directrius deneguem l'\u00fas de relacions de confian\u00e7a establertes en els fitxers /.rhosts i /.shosts dels usuaris: IgnoreRhosts yes/no RhostsRSAAuthentication yes/no","title":"Directriu IgnoreRhosts i RhostsRSAAuthentication"},{"location":"section/P5.1/#directriu-hostbasedauthentication","text":"Deshabilitar o habilitar autenticaci\u00f3 basada en host. HostbasedAuthentication yes/no","title":"Directriu HostbasedAuthentication"},{"location":"section/P5.1/#directriu-usepam","text":"Si utilitzem claus no necessitem PAM (M\u00f2duls d'autenticaci\u00f3 Conectables) i permetem a sshd funcionar com un usuari no root.","title":"Directriu UsePAM"},{"location":"section/P5.1/#bastionathardeningfortificacio-del-servici-ssh","text":"Av\u00eds Totes les comprovacions les heu de fer tant des de l'ordinador amfitri\u00f3, usant la IP de la LAN del servidor, com des del client Xubuntu, usant el nom del DNS.","title":"Bastionat/hardening/fortificaci\u00f3 del servici SSH"},{"location":"section/P5.1/#questions-finals","text":"","title":"Q\u00fcestions finals"},{"location":"section/P5.1/#avaluacio","text":"Criteri Puntuaci\u00f3 punts punts punts punts S'ha tingut cura amb el format del document, utilitzant la plantilla actualitzada i fent \u00fas d'un correcte llenguatge t\u00e8cnic punt S'ha incl\u00f2s la taula amb les IPs de cada m\u00e0quina de la pr\u00e0ctica, tal i com es demana punt","title":"Avaluaci\u00f3"}]}