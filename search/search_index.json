{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"En aquesta web podreu consultar totes les pr\u00e0ctiques d'aquest m\u00f2dul.","title":"Home"},{"location":"section/P1/","text":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa Configuraci\u00f3 de les m\u00e0quines Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un. Ubuntu Server Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna: Xubuntu (client) Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama. Configuraci\u00f3 d'interfaces amb netplan Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quins s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa. Configuraci\u00f3 del enrutament o encaminament Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p Rutes est\u00e0tiques El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d . Toc final ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#practica-1-muntant-larquitectura-de-xarxa","text":"","title":"Pr\u00e0ctica 1 - Muntant l'arquitectura de xarxa"},{"location":"section/P1/#configuracio-de-les-maquines","text":"Atenent al diagrama de xarxa, veiem que el Ubuntu Server ha de tindre dues interfaces de xarxa i el Xubuntu una. Aix\u00f2 es tradueix en que el Ubuntu Server tindr\u00e0 configurats dos adaptadors de xarxa i el Xubuntu un.","title":"Configuraci\u00f3 de les m\u00e0quines"},{"location":"section/P1/#ubuntu-server","text":"Ja que ha de tindre una IP de la mateixa LAN que l'ordinador f\u00edsic on est\u00e0 creada aquesta m\u00e0quina virtual, un dels adaptadors de xarxa ha de ser, sense dubte, adaptador pont o \u201cbridge\u201d: A m\u00e9s, ja que formar\u00e1 una xarxa privada juntament amb l'altra m\u00e0quina virtual, la xarxa formada per aquestes dues m\u00e0quines ser\u00e0 una Xarxa Interna:","title":"Ubuntu Server"},{"location":"section/P1/#xubuntu-client","text":"Si mirem el diagrama de xarxa, Xubuntu \u00fanicament t\u00e9 una interf\u00edcie de xarxa. Aquesta interf\u00edcie est\u00e0 a la xarxa privada que forma juntament amb el Ubuntu Server, ja que tots dos equips estan connectats directament. Aix\u00ed doncs: Ja hem configurat les interf\u00edcies, o el que \u00e9s el mateix, \u00e9s com si hagu\u00e9ssim connectat tots els cables f\u00edsicament per formar l'arquitectura que podeu vore dibuixada en el diagrama.","title":"Xubuntu (client)"},{"location":"section/P1/#configuracio-dinterfaces-amb-netplan","text":"Ara hem de configurar les IPs dins de cada m\u00e0quina virtual. Per a aix\u00f2 utilitzarem el configurador d'interf\u00edcies de xarxa en Linux, \u201cnetplan\u201d. Les interf\u00edcies han de configurar-se en un arxiu de text en llenguatge \u201cyaml\u201d. Aquest arxiu est\u00e0 localitzat en: /etc/netplan Per saber quins s\u00f3n les nostres interf\u00edcies, hem d'utilitzar el comando \u201cip a\u201d Si comprovem el server: Veiem que tenim la interf\u00edcie de loopback que no ens preocupa i dues interf\u00edcies m\u00e9s, enp0s3 i enp0s8. La primera es correspon amb la primera que tenim configurada en la m\u00e0quina, \u00e9s a dir, l'adaptador pont. Aix\u00f2 ho sabem perqu\u00e8 ja t\u00e9 assignada una IP autom\u00e0ticament. La segona, enp0s8, \u00e9s la que es correspon amb la xarxa interna i \u00e9s la que hem de configurar en l'arxiu de netplan de la seg\u00fcent forma: enp0s3 apareix ja en l'arxiu configurada autom\u00e0ticament per DHCP. En roig s'assenyala el que hem d'afegir, la nova interf\u00edcie i la seua IP Atenci\u00f3 Recordeu posar la VOSTRA ip. Recordatori Cura amb les indentacions, els espais i editeu l'arxiu amb sudo o no us deixar\u00e0. Despr\u00e9s de realitzar aquesta configuraci\u00f3, hem d'aplicar-la-hi a la m\u00e0quina, sin\u00f3 no es produiran els canvis. Es poden utilitzar els comandos: sudo netplan try Prova la configuraci\u00f3 abans d'aplicar-la Si li donem a enter apliquem la configuraci\u00f3, si esperem al fet que el comptador arribi a 0, la configuraci\u00f3 no s'aplicar\u00e0. sudo netplan apply Aplica la configuraci\u00f3 directament Atenci\u00f3 Recordeu que \u00e9s MOLT IMPORTANT que despr\u00e9s d'aplicar una configuraci\u00f3 la comprovem. De gens serveix fer canvis i no comprovar que aquestos s'han produ\u00eft. Aix\u00ed doncs, veiem que cada interf\u00edcie est\u00e0 configurada amb la seua IP correctament. En el client Xubuntu el proc\u00e9s seria el mateix i si, despr\u00e9s de comprovar-ho, tot est\u00e0 correcte, podrem fer ping des del Ubuntu Server al Xubuntu i viceversa.","title":"Configuraci\u00f3 d'interfaces amb netplan"},{"location":"section/P1/#configuracio-del-enrutament-o-encaminament","text":"Ara, tots tindreu configurada una de les interf\u00edcies del Ubuntu Server a la LAN de classe. El seg\u00fcent pas va a ser aconseguir que, treballant per parelles, l'ALUMNE 1, des del seu client Xubuntu puga fer ping al Xubuntu de l'ALUMNE 2 Us heu d'adonar que aquest ping ara mateix NO es pot realitzar ja que tots dos Xubuntu estan en xarxes privades diferents i no hi ha forma de que aquestes xarxes es \u201cvegin\u201d. El Ubuntu Server fa de router i per tant un router separa xarxes, de tal forma que ni el Server 1, ni el Xubuntu 1 veuran la xarxa privada de l'Alumne 2 i viceversa. Si recordeu de Xarxes d'\u00c0rea Local, la forma de que un router puga encaminar paquets a xarxes llunyanes era que aquest router \u201caprenguera\u201d aquestes xarxes mitjan\u00e7ant algoritmes d'encaminament. Aquests algoritmes podien ser: Din\u00e0mics: el router aprenia ell a soles, intercanviant informaci\u00f3 amb altres routers Est\u00e0tics: es configuraven les rutes cap a altres xarxes a m\u00e0 Per al cas que ens ocupa, utilitzarem rutes est\u00e0tiques que hem de configurar en el nostre router, en aquest cas el Ubuntu Server. Per q\u00fcestions de seguretat, Linux no pot actuar com a router per defecte, fa falta activar aquesta funcionalitat. Aix\u00ed doncs, anem a activar el que es denomina com a bit de forwarding . Aix\u00f2 ho podem fer mitjan\u00e7ant el seg\u00fcent comando: sysctl -w net.ipv4.ip_forward = 1 No obstant aix\u00f2, en aquest cas el canvi ser\u00e0 temporal i quan es reinici\u00ef el Server, es perdr\u00e0 la configuraci\u00f3. Per a que aquest canvi siga persistent, hem de modificar l'arxiu: /etc/sysctl.conf I buscar la l\u00ednia que posa: # net.ipv4.ip_forward = 0 i eliminar el coixinet inicial i canviar el 0 per un 1: Guardem l'arxiu i activem els canvis amb el comando: sysctl -p","title":"Configuraci\u00f3 del enrutament o encaminament"},{"location":"section/P1/#rutes-estatiques","text":"El comando que hem d'introduir en Linux per configurar una ruta est\u00e0tica \u00e9s: sudo ip route add xarxa via gateway On: Xarxa: la xarxa a la qual volem arribar Ull viu! L'adre\u00e7a de xarxa, no la IP del dispositiu Gateway: el seg\u00fcent salt al que cal manar el paquet per aconseguir la xarxa que volem A m\u00e9s, com el client Xubuntu no coneixer\u00e0 la xarxa a la qual li anem a fer ping, necessita saber per on enviar paquets quan no coneix la xarxa dest\u00ed. Aix\u00f2 es coneix com gateway per defecte o porta d'enlla\u00e7. La porta d'enlla\u00e7 ser\u00e0 el router/Ubuntu Server. Ja hem dit que tota la configuraci\u00f3 de xarxa es fa en l'arxiu que utilitza netplan, aix\u00ed doncs el gateway s'ha de configurar aix\u00ed: On en gateway4 heu de posar la IP del vostre Server. Suposem en el nostre cas que l'ALUMNE 1 t\u00e9 la seg\u00fcent configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.10 enp0s8: 172.1.1.1 Xubuntu enp0s3: 172.1.1.2 I que l'ALUMNE 2 t\u00e9 aquesta configuraci\u00f3: Ubuntu Server enp0s3: 192.168.10.20 enp0s8: 172.1.6.1 Xubuntu enp0s3: 172.1.6.2 A quina interf\u00edcie ha de manar el router de l'ALUMNE 1 el paquet per arribar a la xarxa de l'ALUMNE 2, la 172.1.6.0/24? Si mireu el dibuix us adonareu que el seg\u00fcent salt \u00e9s el router de l'ALUMNE 2. Configureu la ruta est\u00e0tica necess\u00e0ria. Comproveu que la ruta est\u00e0 b\u00e9 mitjan\u00e7ant el comando que mostra les rutes: ip route Despr\u00e9s d'introduir correctament la configuraci\u00f3, comproveu si funciona el ping d'un Xubuntu a un altre. Us adonareu que no funciona. Per qu\u00e8 no? Perqu\u00e8 el paquet sap arribar de Xubuntu1 a Xubuntu2 per\u00f2 no sap tornar \u2192 ALUMNE 2 tamb\u00e9 ha de configurar una ruta est\u00e0tica per poder arribar a la xarxa privada d'ALUMNE 1. Tasca Configureu les rutes est\u00e0tiques en tots dos Servers/routers. Finalment hauries de poder fer ping. Si us equivoqueu ficant les rutes, les podeu eliminar amb el mateix comando per\u00f2 canviant \u201cadd\u201d per \u201cdel\u201d .","title":"Rutes est\u00e0tiques"},{"location":"section/P1/#toc-final","text":"ja que les rutes est\u00e0tiques s'esborraran quan el servidor es reinici\u00ef per qualsevol ra\u00f3, anem a escriure el comando sudo ip route add xarxa via gateway (amb els par\u00e0metres que h\u00e0giu utilitzat vosaltres) en un arxiu de text que es cridar\u00e0: rutes_estatiques.sh I ho aneu a guardar al directori: /etc/network I donar-li permisos d'execuci\u00f3: chmod +x rutes_estatiques.sh Per comprovar que funciona, el comando que heu d'executar \u00e9s: sudo sh rutes_estatiques.sh I comproveu que us ha configurat les rutes. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Toc final"},{"location":"section/P2.1/","text":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP Instal\u00b7laci\u00f3 del servidor DHCP Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server Configuraci\u00f3 del client Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la. Configuraci\u00f3n del servidor DHCP Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.2 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servei DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1. Afegir un client DHCP amb IP reservada Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servei amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/maquinari address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a Ultima comprovaci\u00f3 Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#practica-21-installacio-i-configuracio-de-servidor-dhcp","text":"","title":"Pr\u00e0ctica 2.1 - Instal\u00b7laci\u00f3 i configuraci\u00f3 de servidor DHCP"},{"location":"section/P2.1/#installacio-del-servidor-dhcp","text":"Per instal\u00b7lar el servidor DHCP en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: suo apt-get install isc-dhcp-server","title":"Instal\u00b7laci\u00f3 del servidor DHCP"},{"location":"section/P2.1/#configuracio-del-client","text":"Si recordem de la pr\u00e0ctica 1, el client t\u00e9 ara mateix configurada la IP de forma est\u00e0tica ja que la vam posar a m\u00e0 en l'arxiu localitzat en el directori /etc/netplan . Com el nostre objectiu \u00e9s muntar un servidor DHCP en l'Ubuntu Server que assigni IPs a tots els clients que hi hagi en aquesta xarxa, els clients han d'estar configurats de tal forma que obtinguin aquesta adre\u00e7a per DHCP tamb\u00e9. Aix\u00ed doncs, amb el coixinet comentem les l\u00ednies on li indic\u00e0vem al servidor quin era la IP i el gateway perqu\u00e8 no es tinguin en compte i li indiquem que obtingui aquesta informaci\u00f3 mitjan\u00e7ant el DHCP. Recordatori Recordeu aplicar la configuraci\u00f3 despr\u00e9s de canviar-la.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.1/#configuracion-del-servidor-dhcp","text":"Abans de gens, at\u00e8s que el servidor t\u00e9 dues interf\u00edcies, la de l'adaptador pont (enp0s3) i la de la xarxa interna (enp0s8), hem d'indicar-li en quin d'elles ha d'assignar les IPs. Aix\u00f2 es fa editant l'arxiu: isc-dhcp-server Que podeu trobar en el directori: /etc/default Podem afegir una interf\u00edcie de tipus IPv4 o IPv6. ja que nosaltres estem treballant amb adreces IP d'IPv4, hem d'editar la l\u00ednia assenyalada en roig. Entre cometes posarem el nom de la interf\u00edcie on es van a assignar les IP Consell Recordeu quin era el comando per consultar el nom de les interf\u00edcies Observeu en el diagrama de xarxa quina ser\u00e0 la interf\u00edcie per on s'han d'assignar les IP Ara que ja li hem dit al servidor quin interf\u00edcie ha d'utilitzar, anem a configurar tot el relacionat amb el DHCP. L'arxiu per configurar el servidor DHCP est\u00e0 en el directori: /etc/dhcp I el fitxer es diu: dhcpd.conf Tenint en compte els exemples de configuraci\u00f3 d'aquest arxiu que hem vist en teoria i que podeu consultar en el PDF del tema 2, heu de configurar el servidor amb els seg\u00fcents par\u00e0metres: El rang ha d'anar des de la IP de la interf\u00edcie corresponent n\u00famero 3, fins a la 10. \u00c9s a dir, s'han d'assignar les IPs des de la X.X.X.2 fins a la X.X.X.10. (X.X.X.0 \u00e9s la xarxa de la interf\u00edcie on ha d'estar el DHCP) Heu d'enviar-li tamb\u00e9 la porta d'enlla\u00e7 als clients als quals assigneu la IP Tamb\u00e9 heu d'enviar-li als clients els DNS, que seran dos: 1.1.1.1 i 8.8.8.8 Per a comprovar si la configuraci\u00f3 la teniu b\u00e9, en el terminal podeu utilitza el comando: dhcpd -t Si la teniu b\u00e9, apareixer\u00e0 alguna cosa com aix\u00f2: I si est\u00e0 malament us indicar\u00e0 l'error: (Despr\u00e9s de \u201csubnet\u201d no va \u201cmask) Quan comproveu que la configuraci\u00f3 est\u00e0 b\u00e9, reinicieu el servei DHCP amb el seg\u00fcent comando: sudo systemctl restart isc-dhcp-server I hauria d'assignar-li la IP al client. Warning Com sempre, heu de comprovar que tot est\u00e0 b\u00e9 despr\u00e9s de configurar-lo. Per a veure en el client la IP que us ha assignat el servidor: ip a Recordeu que donat que la primera IP que assigna la IP X.X.X.3, NO podeu tenir la mateixa IP que quan abans la ten\u00edeu est\u00e0tica, que era la X.X.X.2 Per a comprovar si us ha afegit la ruta per defecte, \u00e9s a dir, el gateway: ip route I haur\u00e0 d'apar\u00e8ixer una ruta del tipus: default via porta_de_enlla\u00e7 dev interf\u00edcie ... Si ho teniu tot en ordre, podreu seguir fent ping a un equip client d'un altre company, tal i com vam fer en la pr\u00e0ctica 1.","title":"Configuraci\u00f3n del servidor DHCP"},{"location":"section/P2.1/#afegir-un-client-dhcp-amb-ip-reservada","text":"Per a aquesta part de la pr\u00e0ctica, en Virtualbox heu de clonar la m\u00e0quina client (Xubuntu). Amb la m\u00e0quina apagada \u2192 \u201cM\u00e0quina \u2192 Clonar\u201d. I la iniciem per tenir dos clients a la nostra xarxa interna. A aquesta m\u00e0quina, anem a reservar-li la mateixa IP sempre. Si consulteu l'apartat de \u201cReserves\u201d del tema de teoria, teniu un exemple de com configurar aix\u00f2 en l'arxiu dhcpd.conf Recordeu que aquesta configuraci\u00f3 ha d'estar just sota la qual ja teniu i entre les claus del bloc: subnet x.x.x.x netmask x.x.x.x { La vostra configuraci\u00f3 anterior La configuraci\u00f3 per a la IP reservada \u2190 Aqu\u00ed } La IP fixa ha de ser la n\u00famero 11 \u2192 X.X.X.11 Realitzeu la mateixes comprovacions que en l'apartat anterior (el client t\u00e9 b\u00e9 la IP, el gateway/porta d'enlla\u00e7, pot fer ping al client d'un altre company). Recordeu que despr\u00e9s de canviar la configuraci\u00f3 del servidor DHCP sempre heu de reiniciar el servei amb el comando vist anteriorment: sudo systemctl restart isc-dhcp-server Nota L'adre\u00e7a f\u00edsica/MAC/maquinari address, la podeu consultar en la interf\u00edcie corresponent amb el comando: ip a","title":"Afegir un client DHCP amb IP reservada"},{"location":"section/P2.1/#ultima-comprovacio","text":"Finalment, ja vam dir en la part de teoria que el servidor ha de portar un registre de quin IPs ha assignat i quan, ja que caduquen. Aquest registre es pot consultar en el directori: /var/lib/dhcp En l'arxiu dhcpd.leases (Poden apar\u00e8ixer arxius del tipus dhcpd.leases, que s\u00f3n temporals i heu d'ignorar) Aqu\u00ed podreu veure totes les IP que ha assignat el servidor, a quina hora i quan caduquen, entre altres coses. Adjunteu tamb\u00e9 una captura de pantalla del contingut d'aquest arxiu. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Ultima comprovaci\u00f3"},{"location":"section/P2.2/","text":"Pr\u00e0ctica 2.2 - DHCP Relay Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta. Introducci\u00f3 En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball. Configuraci\u00f3 del client Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir. Configuraci\u00f3 del servidor Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa. Parada del servidor DHCP En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server Instal\u00b7laci\u00f3 del DHCP relay Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta an\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni. Configuraci\u00f3 DHCP Server Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server Comprovaci\u00f3 Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa). Nova comprobaci\u00f3 Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#practica-22-dhcp-relay","text":"Atenci\u00f3, molt important! Per realitzar aquesta pr\u00e0ctica \u00e9s imprescindible que tingueu funcionant correctament l'escenari de la Pr\u00e0ctica 1. Comproveu-ho abans d'iniciar aquesta.","title":"Pr\u00e0ctica 2.2 - DHCP Relay"},{"location":"section/P2.2/#introduccio","text":"En ocasions pot ser que una empresa posseeixi oficines en diferents punts d'Espanya. D'acord amb la l\u00f2gica que hem seguit en la pr\u00e0ctica anterior, podr\u00edem pensar que hem de muntar un servidor DHCP en cadascuna de les LAN de cada oficina que tinguin per Espanya. No obstant aix\u00f2, aquesta opci\u00f3 va totalment en contra del que vam veure en la teoria a prop\u00f2sit dels servidors DHCP, \u00e9s a dir, augmenta la complexitat per mantenir el repartiment i assignaci\u00f3 d'IP ja que perdem la centralitzaci\u00f3 en un nom\u00e9s servidor i arxiu de configuraci\u00f3. Per a solucionar aix\u00f2 sorgeix el DHCP relay, que \u00e9s la situaci\u00f3 on un servidor intermedi fa les vegades de repetidor i envia les peticions DHCP a un servidor remot, que ser\u00e0 el que assigna les IP. Seria el cas de que totes les oficines enviessin les peticions DHCP al servidor localitzat a Elx i fos aquest el que assign\u00e9s les IP de tots els equips de la resta d'oficines d'Espanya. Aix\u00ed nom\u00e9s haur\u00edem de mantindre un \u00fanic servidor DHCP, el d'Elx, facilitant i simplificant en gran mesura el treball.","title":"Introducci\u00f3"},{"location":"section/P2.2/#configuracio-del-client","text":"Els clients no requereixen de cap configuraci\u00f3 addicional. En la Pr\u00e0ctica 2.1 ja els vau configurar perqu\u00e8 adquirissin la IP mitjan\u00e7ant DHCP i aix\u00ed han de seguir.","title":"Configuraci\u00f3 del client"},{"location":"section/P2.2/#configuracio-del-servidor","text":"Si recordem l'escenari de la Pr\u00e0ctica 1: Veiem que aquesta pr\u00e0ctica l'heu de fer per parelles o, en defecte d'aix\u00f2, amb 4 m\u00e0quines virtuals com s'ha explicat en classe. Haureu d'alternar-vos perqu\u00e8 primer un sigui el relay i l'altre el servidor DHCP i despr\u00e9s canvi\u00efn els rols. Aix\u00ed doncs, en el primer cas, el servidor/router de l'Alumne 1 ser\u00e0 el que redirigeixi les peticions DHCP dels seus clients al servidor/router de l'Alumne 2 a trav\u00e9s de la interf\u00edcie de la LAN de classe/casa.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P2.2/#parada-del-servidor-dhcp","text":"En primer lloc \u00e9s imprescindible que l'alumne que vagi a fer de DHCP relay pari el seu servidor DHCP, ja que el que va a fer \u00e9s delegar aquesta responsabilitat en el servidor DHCP del company, redirigint-li les peticions que li arribin. Per a parar-lo: sudo systemctl stop isc-dhcp-server","title":"Parada del servidor DHCP"},{"location":"section/P2.2/#installacio-del-dhcp-relay","text":"Per instal\u00b7lar el servidor DHCP relay en Ubuntu Server, usarem els repositoris oficials. Per aix\u00f2, podrem instal\u00b7lar-ho com qualsevol paquet en Ubuntu: sudo apt install isc-dhcp-relay Per completar la instal\u00b7laci\u00f3, us far\u00e0 3 preguntes amb les quals generar\u00e0 l'arxiu de configuraci\u00f3 que generar\u00e0 en el directori /etc/default amb el nom d'arxiu isc-dhcp-relay : Ac\u00ed vos pregunta quina \u00e9s l'adre\u00e7a IP dest\u00ed a on ha de redirigir les peticions DHCP que reba. Com aneu a redirigir-les per la interf\u00edcie de la LAN cap al server del vostre company, heu d'indicar-li l'adre\u00e7a IP de la interf\u00edcie LAN del server del vostre company. Aqu\u00ed us pregunta en quina interf\u00edcie va a rebre peticions DHCP dels clients. La l\u00f2gica dicta que com nom\u00e9s t\u00e9 clients en la interf\u00edcie de la xarxa interna, aquesta an\u00e9s l'\u00fanica interf\u00edcie que pos\u00e9ssim aqu\u00ed. No obstant aix\u00f2, si fem aix\u00f2, el servidor descartaria les respostes que provenen del servidor del vostre company, ja que arriben per l'altra interf\u00edcie, per la LAN (observeu el dibuix amb deteniment per poder entendre-ho). Aix\u00ed doncs, perqu\u00e8 funcioni correctament tot, heu de posar el nom d'ambdues interf\u00edcies separades per un espai. Finalment us pregunta si voleu executar el programa amb alguna opci\u00f3. Heu d'indicar-li que amb l'opci\u00f3 -D perqu\u00e8 s'executi com a dimoni.","title":"Instal\u00b7laci\u00f3 del DHCP relay"},{"location":"section/P2.2/#configuracio-dhcp-server","text":"Com \u00e9s obvi, el servidor DHCP del vostre company haur\u00e0 de tindre configurat en el seu dhcpd.conf (que ja vam veure on estava en la Pr\u00e0ctica 2) tant el rang d'IP de la seva xarxa com el rang d'IP de la vostra xarxa. \u00c9s a dir, el dhcpd.conf ha de tenir declarades dos subnets, les xarxes internes dels dos alumnes. En canviar la configuraci\u00f3 recordeu que podeu comprovar si est\u00e0 b\u00e9 amb: dhcpd -t I per a que s'aplique la configuraci\u00f3, heu de reiniciar el servei: sudo systemctl restart isc-dhcp-server","title":"Configuraci\u00f3 DHCP Server"},{"location":"section/P2.2/#comprovacio","text":"Forceu al client Xubuntu al fet que reconfigure la seva xarxa perqu\u00e8 comenci a buscar IP per DHCP una altra vegada: sudo netplan apply Ara podreu veure l'estat del DHCP relay escrivint: sudo systemctl status isc-dhcp-relay Veurem com el servei est\u00e0 actiu i funcionant correctament (active (running)) i que est\u00e0 redirigint les peticions de la MAC del vostre client a la IP del servidor del vostre company. I l'estat del servidor DHCP del vostre company amb: sudo systemctl status isc-dhcp-server Ac\u00ed notem que malgrat que el servici DHCP est\u00e0 actiu i funcionant correctament, es produeix un error que ens indica en roig que efectivament alguna cosa est\u00e0 malament. El que est\u00e0 dient aquest error \u00e9s que el servidor DHCP ha detectat que est\u00e0 rebent peticions/missatges DHCP per la interf\u00edcie LAN. No obstant aix\u00f2, en el dhcpd.conf, les \u00faniques xarxes que hi ha configurades s\u00f3n les internes dels dos alumnes, 1 i 2. Com en l'arxiu dhcpd.conf no apareix configurat gens relacionat amb la interf\u00edcie LAN, les peticions DHCP d'aquesta interf\u00edcie s'ignoren, per la qual cosa no est\u00e0 contestant a les peticions del DHCP relay. Per solucionar aix\u00f2, simplement hem de dir-li al servidor DHCP que aquesta interf\u00edcie tamb\u00e9 participar\u00e0 en tot el proc\u00e9s DHCP i que per favor tingui en compte el que li arribe per aquesta interf\u00edcie. Com? En l'arxiu dhcpd.conf heu de fer una nova declaraci\u00f3 d'una subnet, en aquest cas la de la interf\u00edcie LAN. La declaraci\u00f3 estar\u00e0 buida, \u00e9s a dir, nom\u00e9s posareu l'adre\u00e7a de xarxa i la m\u00e0scara, entre les claus no haur\u00e0 contingut perqu\u00e8 \u00f2bviament no es va a assignar cap IP en aquesta interf\u00edcie (aix\u00f2 ja ho fa el router de classe/casa).","title":"Comprovaci\u00f3"},{"location":"section/P2.2/#nova-comprobacio","text":"Si una vegada configurat l'anterior tornem a comprovar l'estat de tots dos serveis, el DHCP relay de l'alumne 1 i el servidor DHCP de l'alumne 2: Veurem que el DHCP relay segueix redirigint les peticions adequadament En el servidor DHCP ara veurem que ja s\u00ed s'estan assignant IP posat que apareixen els missatges DHCP que vam veure en teoria, en la interf\u00edcie de la LAN: Ac\u00ed es pot veure com s'ha assignat la IP 172.1.2.11 a un client d'una altra xarxa interna. Si comproveu el client Xubuntu de l'alumne 1, el que ha configurat el DHCP relay, ara ja tindr\u00e0 IP assignada. Nota Si despr\u00e9s de configurar-ho tot no funciona, comproveu que heu reiniciat els serveis dels quals h\u00e0giu canviat la configuraci\u00f3. A m\u00e9s, feu un sudo netplan apply en el client per for\u00e7ar-li a que torne a intentar buscar IP. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Nova comprobaci\u00f3"},{"location":"section/P3.1/","text":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS Atenci\u00f3, molt important! \u2714 Heu de tindre un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau estar\u00e0 a la nostra xarxa interna de manera que nom\u00e9s necessita una interf\u00edcie, la de la xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Cal desactivar-una de les interf\u00edcies en Virtualbox La que quedi activa, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i ha de tenir configurat en netplan que rebi la IP per DHCP \u2714 Heu de tindre configurat el servidor DHCP perqu\u00e8 assigni una adre\u00e7a IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els serveis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La que quedi activa, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i ha de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original Millora de la configuraci\u00f3 del servidor Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: ping dnsserver ping cliXubuntu Aix\u00ed hauria de funcionar: ping dnsserver.sre.es ping cliXubuntu.sre.es Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\". Configuraci\u00f3 del servidor Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar la veritable configuraci\u00f3, ubicats en el mateix directori. Configuraci\u00f3 named.conf.options \u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0 / 24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client / s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Tamb\u00e9 podria fer-se amb un coixinet per\u00f2 apareixeria ressaltat amb color ja que aquestos comentaris els sol utilitzar l'administrador per a aclarir algun aspecte de la configuraci\u00f3. Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat: Configuraci\u00f3 named.conf.local En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant: Creaci\u00f3 de l'arxiu de zona Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client. Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat. Comprovaci\u00f3 de les configuracions Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat: Comprovaci\u00f3 de les resolucions i de les consultes Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client Tasques a realitzar Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#practica-31-configuracio-dun-servidor-dns","text":"Atenci\u00f3, molt important! \u2714 Heu de tindre un clon de l'Ubuntu Server, perqu\u00e8 faci de servidor DNS esclau \u2714 Aquest servidor esclau estar\u00e0 a la nostra xarxa interna de manera que nom\u00e9s necessita una interf\u00edcie, la de la xarxa interna que rebr\u00e0 la IP per DHCP aix\u00ed que: Cal desactivar-una de les interf\u00edcies en Virtualbox La que quedi activa, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i ha de tenir configurat en netplan que rebi la IP per DHCP \u2714 Heu de tindre configurat el servidor DHCP perqu\u00e8 assigni una adre\u00e7a IP fixa a l'Ubuntu Server. Av\u00eds \u2714 Si ja hav\u00edeu clonat el servidor per fer les pr\u00e0ctiques de tema anterior, podeu reutilitzar-la per\u00f2 recordeu: Aturar els serveis que tingu\u00e9ssiu instal\u00b7lats (isc-dhcp-server, isc-dhcp-relay) Cal desactivar-una de les interf\u00edcies en Virtualbox La que quedi activa, estar\u00e0 configurada per a la mateixa xarxa interna que el server original i ha de tenir configurat en netplan que rebi la IP per DHCP Instal\u00b7lar Bind i els paquets addicionals, tal com vam fer en la pr\u00e0ctica anterior al servidor original","title":"Pr\u00e0ctica 3.1 - Configuraci\u00f3 d'un servidor DNS"},{"location":"section/P3.1/#millora-de-la-configuracio-del-servidor","text":"Si proveu, amb la configuraci\u00f3 de la pr\u00e0ctica anterior cal incloure el subdomini al nom de host per poder fer ping i que el DNS resolgui b\u00e9 les direccions. Aix\u00ed no funciona: ping dnsserver ping cliXubuntu Aix\u00ed hauria de funcionar: ping dnsserver.sre.es ping cliXubuntu.sre.es Podem solucionar aix\u00f2. Hem d'enviar la nostra direcci\u00f3 de domini als hosts per que la afegeixin a la seva IP quan se la assigni el DHCP. Per aix\u00f2 heu d'utilitzar, dins de la declaraci\u00f3 de la vostra subnet a l'arxiu de configuraci\u00f3 de l'DHCP, la directiva \"option domain sre.es\".","title":"Millora de la configuraci\u00f3 del servidor"},{"location":"section/P3.1/#configuracio-del-servidor","text":"Ja que a classe nom\u00e9s utilitzarem IPv4, anem a dir-ho a Bind, en el seu arxiu general de configuraci\u00f3. Aquest fitxer (\"named\") es troba en el directori: /etc/default I per indicar-li que nom\u00e9s faci servir IPv4, hem de modificar la l\u00ednia seg\u00fcent amb el text ressaltat: OPTIONS = \"-u bind -4\" L'arxiu de configuraci\u00f3 principal (named.conf) de Bind est\u00e0 en el directori: /etc/bind Si ho consultem veurem el seg\u00fcent: Aquest fitxer serveix simplement per aglutinar o agrupar els arxius de configuraci\u00f3 que farem servir. Aquests 3 includes fan refer\u00e8ncia als 3 diferents arxius on haurem de realitzar la veritable configuraci\u00f3, ubicats en el mateix directori.","title":"Configuraci\u00f3 del servidor"},{"location":"section/P3.1/#configuracio-namedconfoptions","text":"\u00c9s una bona pr\u00e0ctica que feu sempre una c\u00f2pia de seguretat d'un arxiu de configuraci\u00f3 cada vegada que aneu a realitzar algun canvi:. sudo cp /etc/bind/named.conf.options /etc/bind/named.conf.options.backup Ara editarem l'arxiu named.conf.options i inclourem els seg\u00fcents continguts: Per motius de seguretat, anem a incloure una llista d'acc\u00e9s perqu\u00e8 nom\u00e9s puguin fer consultes recursives a servidor aquells hosts que nosaltres decidim. En el nostre cas, els hosts fiables seran els de la xarxa 172.1.X.0 / 24. Aix\u00ed doncs, just abans del bloc \"options {...}\", al principi de l'arxiu, afegirem alguna cosa aix\u00ed: Si ens fixem el servidor per defecte ja ve configurat per a ser un DNS cach\u00e9. El directori on es cachearan o guardaran les zones \u00e9s: /var/cache/bind Ara hem de configurar els seg\u00fcents aspectes dins de l'bloc \"options {...}\": Que nom\u00e9s es permeten les consultes recursives als hosts que hem decidit en la llista d'acc\u00e9s anterior. No permetre transfer\u00e8ncia de zones a ning\u00fa, de moment. Configurar el servidor perqu\u00e8 escolti consultes DNS al port 53 (per defecte DNS utilitza port 53 UDP) ia la IP de la seva interf\u00edcie de la xarxa privada. Haureu col\u00b7locar la IP de la interf\u00edcie connectada a la xarxa privada de servidor, ja que resoldr\u00e0 les consultes DNS de el client / s d'aquesta xarxa. Permetre les consultes recursives, ja que en el primer punt ja li hem dit que nom\u00e9s puguin fer-les els hosts de l'ACL. A m\u00e9s, comentarem la l\u00ednia que posa \"listen-on-v6 {any; }; \" ja que no anem a respondre a consultes d'IPv6. Per a comentar-la n'hi ha prou amb afegir al principi de la l\u00ednia dues barres (//). Tamb\u00e9 podria fer-se amb un coixinet per\u00f2 apareixeria ressaltat amb color ja que aquestos comentaris els sol utilitzar l'administrador per a aclarir algun aspecte de la configuraci\u00f3. Podem comprovar si la nostra configuraci\u00f3 \u00e9s correcta amb el comando: Si hi ha algun error, ens ho far\u00e0 saber. En cas contrari, ens torna a la l\u00ednia de comandos. Reiniciem el servidor i comprovem el seu estat:","title":"Configuraci\u00f3 named.conf.options"},{"location":"section/P3.1/#configuracio-namedconflocal","text":"En aquest arxiu configurarem aspectes relatius a les nostres zones. Declararem la zona \"sre.es\". Per ara simplement indicarem que el servidor DNS \u00e9s mestre per a aquesta zona i on estar\u00e0 ubicat el fitxer de zona que crearem m\u00e9s endavant:","title":"Configuraci\u00f3 named.conf.local"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona","text":"Crearem l'arxiu de zona de resoluci\u00f3 directa justament en el directori que hem indicat abans i amb el mateix nom que hem indicat abans. El contingut ser\u00e0 una cosa aix\u00ed (procureu respectar el format): Recordeu de teoria que els registres SOA s\u00f3n per a detallar aspectes de la zona autoritativa, els NS per indicar els servidors DNS de la zona i els A les IPs respectives. On apareixen les X heu de posar les vostres IPs privades corresponents, tant del vostre servidor com del vostre client.","title":"Creaci\u00f3 de l'arxiu de zona"},{"location":"section/P3.1/#creacio-de-larxiu-de-zona-pera-a-la-resolucio-inversa","text":"Recordeu que hi ha d'haver dos arxius de zona, un per a la resoluci\u00f3 directa i un altre per a la inversa. Anem doncs a crear l'arxiu de zona inversa. En primer lloc, hem d'afegir les l\u00ednies corresponents a aquesta zona inversa a l'arxiu named.conf.local, igual que hem fet abans amb la zona de resoluci\u00f3 directa: On la X es el tercer byte de la vostra xarxa interna. Y la configuraci\u00f3n de la zona de resoluci\u00f3 inversa: Podem comprovar que la configuraci\u00f3 de les zones es correcta amb el comando adequat.","title":"Creaci\u00f3 de l'arxiu de zona pera a la resoluci\u00f3 inversa"},{"location":"section/P3.1/#comprovacio-de-les-configuracions","text":"Per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 directa: Y per a comprovar la configuraci\u00f3 de la zona de resoluci\u00f3 inversa: Si tot ha anat b\u00e9, retornar\u00e0 OK. En cas de que haja qualsevol error, ens n'informar\u00e0. Reiniciem el servici y comprovem l'estat:","title":"Comprovaci\u00f3 de les configuracions"},{"location":"section/P3.1/#comprovacio-de-les-resolucions-i-de-les-consultes","text":"Podem comprovar des dels clients, amb dig o nslookup les resolucions directes i inverses: Resolucions nom del server Resolucions nom del client","title":"Comprovaci\u00f3 de les resolucions i de les consultes"},{"location":"section/P3.1/#tasques-a-realitzar","text":"Seguint els mateixos passos, introdueix en els arxius de zona al client clonat. Posa-li el nom XubuntuClon i comprova, de la mateixa manera, que tamb\u00e9 es resol b\u00e9 el seu nom i \u00e9s possible fer-li ping per nom. Atenci\u00f3 per a l'informe Documenta tota la pr\u00e0ctica amb les captures de pantalla corresponents de cada configuraci\u00f3 i comprovaci\u00f3.","title":"Tasques a realitzar"}]}